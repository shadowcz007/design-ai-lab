{
  "id": "5e65ddbff2869a809d49751e5eb42be54b6d7555",
  "poster": "data:image/png;base64,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",
  "title": "创意引擎",
  "knowledge": {
    "course": "- 变量\n- 优化ui\n- 基于svg模版的生成\n- 自动从图片提取配色方案\n- 布局-素材自由绑定\n- 固定数量随机生成\n- 计算稀有度&合成大图",
    "readme": "创意引擎",
    "author": "shadow",
    "version": "0.18"
  },
  "code": "const { color } = require(\"jimp\")\n\nvar mainDiv, myCanvas, toolbox, downloadPannel\n\n// 保存坑位\nvar cardElements = {}\n\nvar _CANVAS_WIDTH = Math.min(window.innerWidth * 0.3, 300),\n  _CANVAS_HEIGHT = 300\n\n// svg模版\nvar svgs = []\nwindow.keysList = {}\n\nfunction gui() {\n  window.toast = Lab.base.debounce(() => {\n    if (window.result && window.result.length)\n      Lab.ui.toast(window.result.length)\n  }, 1000)\n\n  // 加载svg库\n  Lab.base\n    .loadFromUrl(\n      'js',\n      'https://cdn.bootcdn.net/ajax/libs/svg.js/3.1.1/svg.min.js'\n    )\n    .then(() => console.log('svg.js done'))\n\n  // mainDiv = Lab.ui.createGroup('container')\n  // Lab.ui.add(mainDiv)\n  // mainDiv.style = 'width: 100%;'\n\n  // mainDiv.innerHTML = `\n  //   <div class=\"ui two column divided grid\">\n  //       <div class=\"stretched row\">\n  //           <div class=\"column\">\n  //               <div class=\"ui segment\" id='myCanvas'></div>\n  //           </div>\n  //           <div class=\"column\" id=\"toolbox\"></div>\n  //       </div>\n  //   </div>\n  //   <div class=\"ui column divided grid\">\n  //       <div class=\"stretched row\">\n  //           <div class=\"column\" id='cards'></div>\n  //       </div>\n  //   </div>\n  //   `\n\n  // 调试界面\n  let toggleDevBtn = Lab.ui.createToggleDevToolsIcon()\n  Lab.ui.add(toggleDevBtn)\n\n  // 设定基础模版\n  let preivewImageForBase = Lab.ui.createImageAndPreview()\n  preivewImageForBase.style.width = '440px'\n  preivewImageForBase.style.height = '440px'\n  let setBaseBtn = Lab.ui.createButton('0 打开基础模版', () => {\n    Lab.ui.loading(0)\n    let data = Lab.ui.openStringDialog(1)\n    if (data) {\n      window.base = data.data\n      drawBase(preivewImageForBase)\n    }\n    setTimeout(() => Lab.ui.loading(100), 100)\n  })\n\n  Lab.ui.add(preivewImageForBase)\n  Lab.ui.add(Lab.ui.createDivider())\n  Lab.ui.add(setBaseBtn)\n  Lab.ui.add(Lab.ui.createDivider())\n\n  let step2Model = Lab.ui.createModel(`设置素材`, '')\n  Lab.ui.add(step2Model)\n  window.step2Model = step2Model\n  //\n  let step2Btn = Lab.ui.createButton('1 设置素材', () => {\n    // Lab.ui.loading(0);\n    step2Model.show()\n  })\n  Lab.ui.add(step2Btn)\n  Lab.ui.add(Lab.ui.createDivider())\n\n  step2Model.add(Lab.ui.createHeader('4', '1/ 素材固定位置'))\n\n  // svg 素材的预览\n  let svgElementPreview = Lab.ui.createGroup()\n\n  // 打开多个svg文件\n  let openBtn = Lab.ui.createButton('打开多个svg文件', () => {\n    Lab.ui.loading(0)\n    svgs = []\n    let datas = Lab.ui.openStringDialog(3)\n    console.log(datas)\n    // 统计变量数量\n    let maskKeys = {}\n    for (const data of datas) {\n      let draw = SVG().addTo(svgElementPreview)\n      draw.__filepath = data.filepath\n      draw.svg(data.data)\n      let parent = draw.children()[0]\n      let styles = parent.attr()\n      draw.width(styles.width)\n      draw.height(styles.height)\n      draw.viewbox(styles.viewBox)\n      draw.node.style.outline = '1px solid gray'\n      draw.node.style.margin = '2px'\n      svgs.push(draw)\n\n      // 预先提取变量\n      let ks = getAllMaskKeys(draw)\n      Array.from(ks, k => {\n        if (maskKeys[k] === undefined) maskKeys[k] = 0\n        maskKeys[k]++\n        // if (!maskKeys.includes(k)) maskKeys.push(k);\n      })\n\n      // 绑定点击事件\n      draw.node.addEventListener('click', e => {\n        if (!window.elementGroup) window.elementGroup = []\n        window.elementGroup.push(\n          Lab.base.getBaseName(draw.__filepath).replace('.svg', '')\n        )\n        console.log(window.elementGroup)\n      })\n    }\n    console.log(maskKeys)\n    // 变量设定- 数量显示\n    paramsInput.setValue(JSON.stringify(maskKeys, null, 2))\n    setTimeout(() => Lab.ui.loading(100), 200)\n  })\n  step2Model.add(openBtn)\n  step2Model.add(Lab.ui.createDivider())\n\n  // 设定哪些变量要提取\n  let paramsInput = Lab.ui.createTextareaInput('变量设定，以 -M 为标记', e => {\n    // console.log(e);\n  })\n\n  step2Model.add(paramsInput)\n  step2Model.add(Lab.ui.createDivider())\n\n  step2Model.add(Lab.ui.createHeader('4', '2/ 素材位置随机'))\n\n  // 配色方案\n  let imgSelectModel = Lab.ui.createImageSelectModel(async base64 => {\n    Lab.clipboard.write(base64, 'base64')\n    let im = Lab.clipboard.read('img')\n    if (im && !im.isEmpty()) {\n      let colors = []\n      im = await Lab.ui.createImage(im.toDataURL())\n      let cFn = new Lab.Color()\n      let colorsPalette = await cFn.getPalette(im, 10)\n      colorsPalette.forEach((c, index) => {\n        c = new Lab.Color(c).rgb().array()\n        colors.push(c)\n      })\n      console.log(colors)\n      window.colorsDiv.innerHTML = ''\n      Array.from(colors, c => {\n        let colorCheckbox = createColor(c)\n        window.colorsDiv.add(colorCheckbox)\n      })\n    }\n    step2Model.show()\n  })\n  let getColorsBtn = Lab.ui.createButton('1 从图片提取主题色', () =>\n    imgSelectModel.show()\n  )\n  step2Model.add(imgSelectModel)\n\n  let colorsDiv = Lab.ui.createGroup()\n  Array.from([[0, 0, 0]], (c, index) => {\n    let colorCheckbox = createColor(c)\n    colorsDiv.add(colorCheckbox)\n  })\n  window.colorsDiv = colorsDiv\n  step2Model.add(getColorsBtn)\n  step2Model.add(Lab.ui.createDivider())\n  step2Model.add(colorsDiv)\n  step2Model.add(Lab.ui.createDivider())\n\n  //  背景设定\n  //   let backgroundToggle = Lab.ui.createToggle({\n  //     changeFn: isChecked => (window.backgroundAutoFill = isChecked),\n  //     name: '开启背景图层',\n  //     label: '开启背景图层'\n  //   })\n  //   step2Model.add(backgroundToggle)\n  //   step2Model.add(Lab.ui.createDivider())\n\n  // 设置素材的权重，权重越高，优先抽取\n  // 设定哪些变量要提取\n  let open2weightBtn = Lab.ui.createButton(\n    '2 打开素材文件夹-设置坑位-素材关系',\n    async () => {\n      let dirname = Lab.ui.getFilePath(2)\n      if (dirname && dirname[0]) {\n        let children = Lab.base.fs.readdirSync(dirname[0])\n        let maskKeys = createMaskKeysFromSvg()\n        let childAsKeys = []\n        for (const child of children) {\n          let childPath = dirname[0] + '/' + child\n          let cStat = Lab.base.fs.statSync(childPath)\n          // 如果是目录，则读取里面的素材图片\n          if (cStat.isDirectory()) {\n            childAsKeys.push(child)\n          }\n        }\n\n        // let baseKey = childAsKeys[0]\n        // for (const key in maskKeys) {\n        //     if (maskKeys[key] === 0) {\n        //         maskKeys[key] = childAsKeys[childAsKeys.length - 1] || baseKey\n        //         childAsKeys.pop()\n        //     }\n        // }\n        // TODO 进一步优化\n        // maskKeys.elements = childAsKeys\n        // 颜色-素材的精确设定\n        maskKeys._colors = {\n          _background: getBackgroundColors(),\n          _base: getBaseColors()\n        };\n        for (const ckey of childAsKeys) {\n          maskKeys._colors[ckey] = maskKeys._colors._base;\n        }\n        console.log('模板id对应重新编号', maskKeys)\n        weightInput.setValue(JSON.stringify(maskKeys, null, 2))\n        drawBase(preivewImageForBase)\n      }\n    }\n  )\n  step2Model.add(open2weightBtn)\n  step2Model.add(Lab.ui.createDivider())\n  let weightInput = Lab.ui.createTextareaInput(\n    `设置素材文件夹和布局的对应关系{'布局1':'文件夹1','布局2':'文件夹2'}`,\n    e => {\n      // console.log(e);\n    }\n  )\n  step2Model.add(weightInput)\n  step2Model.add(Lab.ui.createDivider())\n\n  // 是否开启清空素材 \n  // let isClearAll = Lab.ui.createToggle({\n  //   label: '重新创建素材',\n  //   name: '重新创建素材',\n  //   changeFn: e => {\n  //     window.isCanClearAll = e;\n  //   }\n  // });\n  // step2Model.add(isClearAll)\n  // step2Model.add(Lab.ui.createDivider())\n\n  let sampleWeightInput = Lab.ui.createInput(\n    'range',\n    '采样比例',\n    () => {\n      console.log(sampleWeightInput.getValue())\n      window.sampleWeight = parseFloat(sampleWeightInput.getValue()) / 100\n    }\n  )\n  step2Model.add(sampleWeightInput)\n  step2Model.add(Lab.ui.createDivider())\n\n  // 随机抽取素材\n  let open2Btn = Lab.ui.createButton(\n    '3 打开素材文件夹-以文件夹分类素材',\n    async () => {\n      let dirname = Lab.ui.getFilePath(2)\n      if (dirname && dirname[0]) {\n        let children = Lab.base.fs.readdirSync(dirname[0])\n\n        // 局部储存 key是素材文件夹，value是素材\n        let keysListOne = {}\n\n        // 素材和布局的对应关系\n        let weight = JSON.parse(weightInput.getValue())\n        console.log(weight)\n        // let weightSum = 0\n        // for (let key in weight) {\n        //   weightSum += weight[key]\n        // }\n        // // 总量为10来控制\n        // for (let key in weight) {\n        //   weight[key] = (10 * weight[key]) / weightSum;\n        // };\n\n        //\n        for (const child of children) {\n          let childPath = dirname[0] + '/' + child\n          let cStat = Lab.base.fs.statSync(childPath)\n          // 如果是目录，则读取里面的素材图片\n\n          if (cStat.isDirectory()) {\n            let imgFiles = Lab.base.fs.readdirSync(childPath)\n            let list = []\n            for (const imgFile of imgFiles) {\n              if (imgFile != '.DS_Store') {\n                list.push({\n                  basename: imgFile,\n                  zIndex: 0,\n                  filePath: childPath + '/' + imgFile\n                })\n              }\n            }\n\n            keysListOne[child] = list\n          }\n        }\n        console.log(`完成：`, keysListOne)\n\n        // 全局 \n        // TODO 是否清空\n        if (!window.keysList) window.keysList = {}\n        let maskKeys = initRandomLayout()\n\n        // 颜色变量,素材的对应关系处理\n        let colors = weight._colors;\n        for (const ckey in colors) {\n          colors[ckey] = Array.from(colors[ckey], c => {\n            let rgb = new Lab.Color(c).rgb().array()\n            return [\n              { apply: 'red', params: [rgb[0]] },\n              { apply: 'green', params: [rgb[1]] },\n              { apply: 'blue', params: [rgb[2]] }\n            ]\n          });\n        };\n\n        // console.log(colors)\n        // 随机拆分素材\n        for (const key in maskKeys) {\n          // 素材\n          let items = [...keysListOne[weight[key]]]\n          // 素材抽样\n          if (window.sampleWeight && window.sampleWeight > 0) {\n            // arr = [1, 2, 3, 5, 7, 8, 9];\n            items = Lab.base.shuffle(items);\n            items = Lab.base.chunk(items, items.length * parseFloat(window.sampleWeight)).sort((a, b) => b.length - a.length)[0];\n            console.log('采样', items)\n          }\n          // 去重\n          let idsMap = {}\n\n          for (let i = 0; i < items.length; i++) {\n            // 非常容易出现bug\n            items[i] = { ...items[i] }\n\n            // 读取图片并随机颜色\n            console.log(colors, key, colors[weight[key]])\n            items[i].base64 = await Lab.Image.changeColor(\n              items[i].filePath,\n              Lab.base.shuffle(colors[weight[key]])[0]\n            )\n            // 计算id\n            items[i].id = Lab.base.md5(items[i].base64)\n\n            // 添加随机的操作：角度、缩放、翻转\n\n            let imgBase64 = await Lab.Image.rotate(\n              Lab.Image.base642Buffer(items[i].base64),\n              Math.random() * 15 * (Math.random() > 0.5 ? -1 : 1)\n            )\n\n            // imgBase64 = await Lab.Image.flip(\n            //   Lab.Image.base642Buffer(items[i].base64),\n            //   Math.random() > 0.4,\n            //   false\n            // )\n\n            items[i].base64 = await Lab.Image.scale(\n              Lab.Image.base642Buffer(imgBase64),\n              Lab.base.shuffle([0.9, 0.8, 1.1, 1, 1.2])[0]\n            )\n\n            if (!idsMap[items[i].id]) {\n              idsMap[items[i].id] = 1\n              items[\n                i\n              ].svg = `<g id=\\\"${key}\\\" data-id=\\\"${items[i].id}\\\" data-basename=\\\"${items[i].basename}\\\"><image id=\\\"${items[i].id}\\\" x=\\\"${maskKeys[key].x}\\\" y=\\\"${maskKeys[key].y}\\\" width=\\\"${maskKeys[key].width}\\\" height=\\\"${maskKeys[key].height}\\\" xlink:href=\\\"${items[i].base64}\\\"></image></g>`\n              items[i].draw = SVG()\n              items[i].draw.svg(items[i].svg)\n              // console.log(items[i].draw)\n              items[i].draw.children()[0].transform(maskKeys[key].transform)\n              items[i].svg = items[i].draw.children()[0].svg()\n              console.log(key, maskKeys)\n              Lab.ui.toast(`${i}__${key}_${items.length}`)\n              items[i].key = key\n            } else {\n              // 重复了，需要设null\n              items[i] = null\n            }\n          }\n\n          window.keysList[key] = items.filter(i => i)\n          maskKeys[key] = window.keysList[key].length\n        }\n        paramsInput.setValue(JSON.stringify(maskKeys, null, 2))\n        // TODO 是否要加过滤 ？\n        window.elementRemoveCheck = {}\n        preDataBtn.classList.add('green')\n      }\n    }\n  )\n  step2Model.add(open2Btn)\n  step2Model.add(Lab.ui.createDivider())\n\n  step2Model.add(Lab.ui.createHeader('4', '3/ 素材组合过滤'))\n  let inputElementGroupBtn = Lab.ui.createTextareaInput(\n    `设置素材组合关系 素材1文件名_素材2文件名`,\n    e => {\n      // console.log(e);\n    }\n  )\n  let addGroupBtn = Lab.ui.createButton('添加', () => {\n    inputElementGroupBtn.setValue(\n      inputElementGroupBtn.getValue() + '\\n' + window.elementGroup.join('_')\n    )\n    window.elementGroup = []\n    preDataBtn.classList.remove('green')\n  })\n  step2Model.add(inputElementGroupBtn)\n  step2Model.add(Lab.ui.createDivider())\n  step2Model.add(addGroupBtn)\n  step2Model.add(Lab.ui.createDivider())\n  step2Model.add(svgElementPreview)\n  step2Model.add(Lab.ui.createDivider())\n\n  // 预处理数据\n  step2Model.add(Lab.ui.createHeader('4', '5/ 预处理素材'))\n  let preDataBtn = Lab.ui.createButton('预处理', () => {\n    Lab.ui.loading(0)\n    preDataBtn.classList.remove('green')\n\n    // 预处理素材\n    let text = paramsInput.getValue()\n    if (text) {\n      let json = JSON.parse(text)\n      let keys = Object.keys(json)\n      // let keys = text.split('\\n').filter(f => f);\n      if (keys) {\n        window.keysList = {}\n        for (const key of keys) {\n          window.keysList[key] = []\n        }\n        Array.from(svgs, s => initEngine(s, keys))\n        // 成功遍历完成\n        console.log(window.keysList)\n        window.toast()\n      }\n    }\n    // console.log(paramsInput.getValue())\n\n    // 生成素材过滤条件\n    let keys = {}\n    let sortIndex = 0\n    for (const key in window.keysList) {\n      for (let index = 0; index < window.keysList[key].length; index++) {\n        const element = window.keysList[key][index]\n        keys[element.basename.replace('.svg', '')] = { index, key, sortIndex }\n      }\n      sortIndex++\n    }\n\n    // 过滤\n    window.elementRemoveCheck = {}\n    Array.from(inputElementGroupBtn.getValue().split('\\n'), text => {\n      let ns = text.split('_')\n      let checkAttrs = []\n\n      for (let key in window.keysList) {\n        checkAttrs.push(\n          Array.from(new Array(window.keysList[key].length), (k, i) => {\n            return {\n              key,\n              index: i\n            }\n          })\n        )\n      }\n\n      // 如果不匹配，则清空\n      let isMatch = false;\n\n      for (const n of ns) {\n        // console.log('---',n,keys[n])\n        if (keys[n] && keys[n].sortIndex != undefined) {\n          isMatch = true;\n          checkAttrs[keys[n].sortIndex] = [\n            {\n              index: keys[n].index,\n              key: keys[n].key\n            }\n          ]\n        }\n      };\n\n      if (isMatch === false) checkAttrs = [];\n      // console.log(checkAttrs)\n\n      for (const attr of Lab.base.cartesian(checkAttrs)) {\n        window.elementRemoveCheck[Lab.base.hash(attr)] = attr\n      }\n    })\n\n    // 转化为字典\n    // let elementRemoveMap = {}\n\n    // Array.from(window.elementRemoveCheck, es => {\n    //   let style=Array.from(es, e => {\n    //     return {\n    //       key: e.key,\n    //       index: e.index\n    //     }\n    //   });\n    //   let id=Lab.base.hash(style);\n    //   elementRemoveMap[id]=style;\n    // })\n    // window.elementRemoveCheck = elementRemoveMap\n\n    preDataBtn.classList.add('green')\n    setTimeout(() => Lab.ui.loading(100), 200)\n  })\n  step2Model.add(preDataBtn)\n  step2Model.add(Lab.ui.createDivider())\n\n  // 选择算法\n  // let dkBtn=Lab.ui.createButton('3 笛卡尔全量生成',()=>{\n  //     window.result = createAll();\n  //     window.toast();\n  // });\n  // Lab.ui.add(dkBtn);\n  // Lab.ui.add(Lab.ui.createDivider());\n\n  let createGroup = Lab.ui.createGroup()\n  Lab.ui.add(createGroup)\n  let createHead = Lab.ui.createHeader(4, '3 固定数量随机生成')\n  createGroup.add(createHead)\n  // 输入数量\n  window.createCount = 100\n  let inputCreateCount = Lab.ui.createInput('text', '数量', () => {\n    window.createCount = ~~inputCreateCount.getValue()\n  })\n  inputCreateCount.setValue([window.createCount])\n  createGroup.add(inputCreateCount)\n  createGroup.add(Lab.ui.createDivider())\n  let fixedBtn = Lab.ui.createButton('生成', () => {\n    Lab.ui.loading(0)\n    // window.result = createAllRandom(100);\n    window.toast();\n    create100()\n    setTimeout(() => Lab.ui.loading(100), 200)\n  })\n\n  // Lab.ui.add(Lab.ui.createBaseText('生成100个'))\n  createGroup.add(fixedBtn)\n  Lab.ui.add(Lab.ui.createDivider())\n\n  function create100() {\n    window.result = createAllRandom(window.createCount)\n    if (window.result) {\n      window.resultIndex = 0\n      window.svgsResult = []\n      for (const features of window.result) {\n        let svg = drawSvg(false, window.base, features)\n        window.svgsResult.push(svg)\n      }\n    }\n  }\n\n  let previewModel = Lab.ui.createModel('预览')\n  Lab.ui.add(previewModel)\n  Lab.ui.add(Lab.ui.createDivider())\n\n  let previewModelOpenBtn = Lab.ui.createButton('4 预览', previewModel.show)\n  Lab.ui.add(previewModelOpenBtn)\n  Lab.ui.add(Lab.ui.createDivider())\n\n  //\n  downloadPannel = createDownloadPannel()\n  Lab.ui.add(downloadPannel)\n\n  myCanvas = new Lab.Canvas(_CANVAS_WIDTH, _CANVAS_HEIGHT)\n  myCanvas.onModified = doModified\n  myCanvas.onClick = doClick\n  myCanvas.onRemoved = doRemoved\n  previewModel.add(myCanvas.getElement())\n\n  let cardsDiv = Lab.ui.createGroup('cards')\n  previewModel.add(cardsDiv)\n\n  toolbox = createToolbox()\n  previewModel.add(toolbox)\n\n  let addBtn = Lab.ui.createIcon(\n    'plus',\n    () => {\n      Lab.ui.loading(0)\n      let { card, rect } = createCard(cardsDiv)\n      cardElements[card.id] = {\n        element: card,\n        rect: rect,\n        imgUrls: []\n      }\n      setTimeout(() => Lab.ui.loading(100), 200)\n    },\n    false\n  )\n  addBtn.classList.add('red')\n  previewModel.add(addBtn)\n\n  // addBtn.style = `\n  //   position:fixed;\n  //   right:12px;\n  //   top:240px;\n  //   `\n\n  myCanvas.addRect(\n    {\n      left: 0,\n      top: 0,\n      width: _CANVAS_WIDTH,\n      height: _CANVAS_HEIGHT,\n      stroke: 'black',\n      fill: 'white'\n    },\n    false,\n    true,\n    true\n  )\n  myCanvas.zoomToFitCanvas()\n\n  // 下一个\n  let nextBtn = Lab.ui.createButton('下一个', async () => {\n    myCanvas.reset()\n    if (window.resultIndex >= window.svgsResult.length) window.resultIndex = 0\n    window.currentSvg = window.svgsResult.slice(\n      window.resultIndex,\n      window.resultIndex + 1\n    )[0]\n    let url = Lab.base.str2URL(window.currentSvg, 'image/svg+xml;charset=utf-8')\n    let target = await myCanvas.addSVGFromURL(url)\n    target.name = 'svg'\n    window.targetUrl = url\n    window.resultIndex++\n    // 添加到画布上\n    let cardsDiv = Lab.ui.createGroup('cards')\n    previewModel.add(cardsDiv)\n    let { card, rect } = createCard(cardsDiv)\n    cardElements[card.id] = {\n      element: card,\n      rect: rect,\n      imgs: [\n        {\n          element: target,\n          url: url,\n          type: 'svg'\n        }\n      ]\n    }\n    card.setValue([url])\n    // 缩放表情包\n    updateCanvasImgs(card.id)\n  })\n  previewModel.add(nextBtn)\n\n  let downloadModel = Lab.ui.createModel('下载')\n  let downloadModelBtn = Lab.ui.createButton('5 下载', downloadModel.show)\n  Lab.ui.add(downloadModelBtn)\n\n  // 设置人类可读的编号前缀 APL+0983\n  let setCodeBtn = Lab.ui.createInput('text', '编号前缀', texts => {\n    if (texts && texts.length) {\n      let t = texts[0]\n      t = t.trim()\n      window.__code = t\n    }\n  })\n\n  let setDownloadFilePathBtn = Lab.ui.createButton('设置本地目录', async () => {\n    // 导出本地文件\n    let filepaths = Lab.ui.getFilePath(2)\n    if (filepaths && filepaths[0]) {\n      window.__download_filepath = filepaths[0]\n    }\n  })\n\n  async function download100() {\n    if (!window.__download_filepath) Lab.ui.toast('请设置本地目录')\n    if (window.__download_filepath) {\n      // id map\n      let idsMap = {}\n      let i = 1\n      let fileNames = Lab.base.readdirSync(window.__download_filepath)\n      for (const fileName of fileNames) {\n        // 判断是否是文件夹\n        if (Lab.base.fs.statSync(fileName).isDirectory()) {\n          let children = Lab.base.readdirSync(fileName)\n          // console.log(children)\n          // 取到svg的id命名的原图\n          let id = getId(children)\n          if (id) {\n            idsMap[id] = 1\n          }\n          i++\n        }\n      }\n\n      for (let svg of window.svgsResult) {\n        let s = SVG()\n        s.svg(svg)\n        let id = s.children()[0].attr('data-id')\n\n        if (!idsMap[id]) {\n          let basename = (window.__code || 'A') + i\n\n          // 把编号写入svg并保存\n          s.children()[0].attr('data-number', basename)\n          svg = s.children()[0].svg()\n\n          // 文件夹\n          let dirname0 = window.__download_filepath + '/' + basename\n          Lab.base.mkdir(dirname0)\n\n          Lab.base.saveData(dirname0 + '/' + id + '.svg', svg)\n\n          // 保存原图-用于上链\n          let base64 = await Lab.Image.svg2base64(svg, 'png')\n          Lab.base.saveBase64(base64, dirname0 + '/' + basename + '.png')\n\n          // 增加水印\n          // s.children()[0].add(`<text \n          // x=\"0\" \n          // y=\"${parseInt(\n          //   s\n          //     .children()[0]\n          //     .attr('height')\n          //     .replace('px', '')\n          // ) - 20}\" fill=\"#000\" transform=\"rotate(0 0 0)\" \n          // fill-opacity=\"0.5\" \n          // font-size=\"12\">${new Array(100).fill(basename).join(' _ ')}</text>`)\n\n          // // 保存预览图\n          // svg = s.children()[0].svg()\n          // base64 = await Lab.Image.svg2base64(svg, 'png')\n          // Lab.base.saveBase64(\n          //   base64,\n          //   dirname0 + '/' + basename + '_preview.png'\n          // )\n\n          await updatePreviewImage(s, basename, dirname0 + '/' + basename + '_preview.png')\n\n          i++\n          Lab.ui.toast(`${i}_${window.svgsResult.length}`)\n        }\n      }\n    }\n  }\n  // console.log(setCodeBtn)\n  let downAllBtn = Lab.ui.createButton('下载到本地', async () => {\n    window.__code = setCodeBtn.getValue()\n    await download100()\n  })\n\n  let down10000Btn = Lab.ui.createButton('1w下载到本地', async () => {\n    for (let index = 0; index < 100; index++) {\n      create100()\n      await download100()\n      Lab.ui.toast(index)\n      await Lab.base.sleep(1500)\n    }\n  })\n\n  // 导出图片，方便删除不好的\n  let selectFromImage = Lab.ui.createButton('从文件夹导出图片', async () => {\n    let filepaths = Lab.ui.getFilePath(0)\n    if (!window.__code) window.__code = setCodeBtn.getValue();\n    let code = window.__code\n    let children = Lab.base.readdirSync(filepaths[0])\n    let dirname = Lab.base.getDirName(filepaths[0])\n    let newDir = dirname + '/forSelect_' + (new Date()).getTime();\n    Lab.base.mkdir(newDir);\n    for (let index = 0; index < children.length; index++) {\n      let child = children[index]\n      let nCodeId = code + (index + 1)\n      // let b = Lab.base.getBaseName(child);\n      // 定位图片文件\n      let imgFiles = Lab.base.readdirSync(child)\n      let img = getOneImageFromChildren(imgFiles)\n      // 拷贝文件至新的文件夹\n      Lab.base.copyFileSync(img, newDir + '/' + nCodeId + '.png')\n      Lab.ui.toast(nCodeId)\n    }\n  });\n\n  // 根据选择的图片，从目录中提取新的源文件\n  let selectFromSvgBtn = Lab.ui.createButton('根据选择的图片文件夹，挑选原图', async () => {\n    let filepaths = Lab.ui.getFilePath(2)\n    if (filepaths && filepaths[0]) {\n      let imgFiles = Lab.base.readdirSync(filepaths[0]);\n\n      let baseNames = {};\n      for (const file of imgFiles) {\n        let baseName = Lab.base.getBaseName(file).replace('.png', '');\n        baseNames[baseName] = 1;\n      }\n      console.log(baseNames);\n      if (!window.__download_filepath) Lab.ui.toast('请设置成果目录')\n      if (window.__download_filepath) {\n        let targetResultFp = Lab.base.getDirName(window.__download_filepath) + '/挑选结果';\n        Lab.base.mkdir(targetResultFp)\n        let resFiles = Lab.base.readdirSync(window.__download_filepath);\n        for (const res of resFiles) {\n          let b = Lab.base.getBaseName(res);\n          if (baseNames[b]) {\n            Lab.ui.toast(b)\n            Lab.base.copyDirSync(res, targetResultFp + '/' + b)\n          }\n        }\n      }\n    }\n  });\n\n  // 重新编号\n  let reNameFiles = Lab.ui.createButton('重新编号', async () => {\n    let filepaths = Lab.ui.getFilePath(0)\n    if (!window.__code) window.__code = setCodeBtn.getValue();\n    let code = window.__code\n    let children = Lab.base.readdirSync(filepaths[0])\n\n    for (let index = 0; index < children.length; index++) {\n      let child = children[index]\n      let nCodeId = code + (index + 1)\n      // let b = Lab.base.getBaseName(child);\n      let dirname = Lab.base.getDirName(child)\n      // 重命名文件\n      let imgFiles = Lab.base.readdirSync(child)\n      reNameFilesByNewCode(imgFiles, nCodeId);\n\n      // svg图片\n      let svgFile = getSvgFile(imgFiles);\n      let svgStr = Lab.base.readFileSync(svgFile)\n      let s = SVG()\n      s.svg(svgStr)\n\n      await updatePreviewImage(s, nCodeId, child + '/' + nCodeId + '_preview.png');\n      // 重命名文件夹\n      Lab.base.renameSync(child, dirname + '/' + nCodeId)\n      Lab.ui.toast(nCodeId)\n    }\n  })\n  // 合成全景图\n  let allPicsBtn = Lab.ui.createButton('合成大图&稀有度', async () => {\n    // id map\n    let idsMap = {}\n    let i = 1\n\n    let filepaths = Lab.ui.getFilePath(0)\n    let num = 20\n    let w = (2 * 2048) / num\n    let h\n    let imgs = []\n\n    // 统计\n    let counts = {}\n\n    // 稀有度\n    if (!window.keysList || (window.keysList && Object.keys(window.keysList).length === 0)) createKeysListFromResult(filepaths);\n    // 计算每个图的稀有属性值，并保存为.md文件\n    let filesRare = {}\n\n    for (const fileName of filepaths) {\n      let children = Lab.base.readdirSync(fileName)\n\n      let id = getId(children)\n\n      let basenameCode = Lab.base.getBaseName(fileName)\n\n      idsMap[id] = 1\n      filesRare[basenameCode] = { fileName }\n\n      let column = Math.ceil(i / num)\n      if (!imgs[column]) imgs[column] = []\n\n      // 图片\n      let imgFile = getOneImageFromChildren(children)\n      let svgFile = getSvgFile(children)\n\n      if (imgFile) {\n        // 用于合成png大图\n        // console.log(imgFile)\n        let im = await Lab.Image.createImage(imgFile)\n        im.fileName = basenameCode\n        h = w / (im.naturalWidth / im.naturalHeight)\n        //   let c = Lab.Image.createCanvasFromImage(im, w, h)\n        //   let ctx = c.getContext('2d')\n        //   ctx.fillStyle = 'black'\n        //   ctx.fillRect(0, h - 44, w, 44)\n        //   ctx.font = '20px Georgia'\n        //   ctx.textBaseline = 'bottom'\n        //   ctx.textAlign = 'right'\n        //   ctx.fillStyle = 'white'\n        //   ctx.fillText(Lab.base.getBaseName(fileName), w - 8, h - 8)\n        imgs[column].push(im)\n      }\n\n      if (svgFile && window.keysList) {\n        // 用于计算各个元素出现的概率\n        let attrs = {}\n        // console.log(window.keysList) 需要预处理调用成功\n        // console.log(child)\n        let svgStr = Lab.base.readFileSync(svgFile)\n        let draw = SVG()\n        draw.svg(svgStr)\n        for (var k in window.keysList) {\n          let r = draw.findOne('#' + k)\n          if (r) {\n            let id = r.attr('data-id')\n            let obj = window.keysList[k].filter(v => v.id === id)[0]\n            // console.log(k,id);\n            if (obj) {\n              if (!counts[k]) counts[k] = {}\n\n              if (!counts[k][obj.basename]) {\n                let base64 = await Lab.Image.svg2base64(obj.draw.svg(), 'png')\n                counts[k][obj.basename] = {\n                  base64,\n                  count: 0\n                }\n              }\n              counts[k][obj.basename].count++\n              attrs[obj.basename] = 1\n            }\n          }\n        }\n        filesRare[basenameCode].attrs = attrs\n      }\n      i++\n    }\n\n    // Lab.clipboard.write(canvas.toDataURL(),'base64')\n\n    // window.counts=counts;\n    // 统计元素稀有度\n    let ks = []\n    let maxWidth = 0,\n      maxHeight = 0,\n      size = 200\n\n    for (var k in window.keysList) {\n      ks.push({\n        value: window.keysList[k].length,\n        key: k\n      })\n    }\n    ks = ks.sort((a, b) => b.value - a.value)\n    ks = Array.from(ks, k => k.key)\n    for (let index = 0; index < ks.length; index++) {\n      const k = ks[index]\n      // counts[k]\n      let elements = []\n      for (let basename in counts[k]) {\n        let im = await Lab.Image.createImage(counts[k][basename].base64)\n        // let canvasImage = Lab.Image.createCanvasFromImage(im);\n        // let canvas=Lab.ui.createCanvas(canvasImage.width,canvasImage.height+156,'','',true);\n\n        let canvas = Lab.Image.createCanvasFromImage(im)\n\n        let ctx = canvas.getContext('2d')\n        // ctx.drawImage(canvasImage,0,0,canvasImage.width,canvasImage.height,0,0,canvasImage.width,canvasImage.height);\n\n        // console.log(canvas.height)\n        // 绘制数量到图上\n        ctx.fillStyle = 'black'\n        ctx.fillRect(0, canvas.height - 48, canvas.width, 48)\n        ctx.font = '38px Georgia'\n        ctx.textBaseline = 'bottom'\n        ctx.textAlign = 'right'\n        ctx.fillStyle = 'white'\n\n        // 稀有度\n        let rare = (\n          (100 * counts[k][basename].count) /\n          filepaths.length\n        ).toFixed(2)\n\n        // console.log(rare,counts[k][basename],filepaths.length)\n\n        ctx.fillText(\n          basename.replace(/\\..*/gi, '') + '_' + rare + '%',\n          canvas.width - 8,\n          canvas.height - 8\n        )\n\n        elements.push({\n          basename,\n          value: counts[k][basename].count,\n          rare,\n          canvas\n        })\n      }\n      elements = elements.sort((a, b) => b.value - a.value)\n      maxWidth = Math.max(elements.length * size + 40, maxWidth) + 20\n      ks[index] = {\n        key: k,\n        elements\n      }\n      if (elements.length == 0) ks[index] = null\n    }\n    ks = ks.filter(k => k)\n    maxHeight = ks.length * (size + 20) + 40\n    // console.log(ks,maxWidth,maxHeight)\n\n    // 绘制大图\n    let canvasElements = Lab.Image.createCanvas(maxWidth, maxHeight),\n      ctxElements = canvasElements.getContext('2d')\n\n    for (let k of ks) {\n      let y = size * 1.2 * ks.indexOf(k)\n      if (y + size > canvasElements.height)\n        canvasElements.height = y + 40 + size\n    }\n\n    ctxElements.strokeStyle = 'black'\n    ctxElements.lineWidth = 2\n    ctxElements.font = '14px Georgia'\n    ctxElements.textBaseline = 'top'\n    ctxElements.textAlign = 'left'\n    ctxElements.fillStyle = 'black'\n\n    // 计算每个文件的稀有度\n    window._RARE = {}\n    Array.from(ks, r => {\n      let key = r.key\n      Array.from(r.elements, e => {\n        window._RARE[e.basename] = { key, rare: Number(e.rare) }\n      })\n    })\n\n    window._filesRare = filesRare\n    for (let k of ks) {\n      let y = size * 1.2 * ks.indexOf(k)\n      ctxElements.fillText(k.key, 10, 10 + y)\n      for (let e of k.elements) {\n        let x = k.elements.indexOf(e) * size,\n          xs = (1 + k.elements.indexOf(e)) * 10\n        ctxElements.drawImage(\n          e.canvas,\n          0,\n          0,\n          e.canvas.width,\n          e.canvas.height,\n          x + xs,\n          y + 30,\n          size,\n          size\n        )\n        ctxElements.strokeRect(x + xs, y + 30, size, size)\n      }\n    }\n\n    Lab.ui.saveBase64Dialog(canvasElements.toDataURL(), '保存', '稀有度')\n    // let url=canvasElements.toDataURL();\n    // Lab.ui.add(Lab.ui.createImageAndDownload(url));\n\n    // 绘制-所有文件的大图合集\n    imgs = imgs.filter(i => i)\n\n    // 稀有度的总文件\n    let raresText = {}\n    for (let index = 0; index < imgs.length; index++) {\n      const ims = imgs[index]\n      for (let j = 0; j < ims.length; j++) {\n        const im = ims[j]\n        // 在这里加入稀有度的数据\n        //TODO 优化 ，把稀有度剥离开来，计算\n        let rare1 = [],\n          rareStr = ''\n        for (let key in _filesRare[im.fileName].attrs) {\n          rare1.push(_RARE[key].rare * 0.001)\n          rareStr += '_' + _RARE[key].key + '_' + _RARE[key].rare + '%'\n        }\n\n        // rare1 = (Lab.base.sumArray(rare1) * 100).toFixed(2);\n        rare1 = (Lab.base.medianArray(rare1) * 100).toFixed(2)\n\n        raresText[im.fileName] = {\n          code: im.fileName,\n          rare: parseFloat(rare1),\n          attrs: rareStr\n        }\n      }\n    }\n    console.log(raresText)\n    window._raresText = raresText\n    Lab.ui.saveJsonDialog(raresText)\n\n    // 绘制大图\n    let canvas = Lab.Image.createCanvas(w * num, h * imgs.length)\n    let ctx = canvas.getContext('2d')\n    // console.log(imgs)\n    for (let index = 0; index < imgs.length; index++) {\n      const ims = imgs[index]\n      for (let j = 0; j < ims.length; j++) {\n        const im = ims[j]\n        let c = Lab.Image.createCanvasFromImage(im, w, h)\n\n        // let canvasImage = Lab.Image.createCanvasFromImage(im);\n        // let c=Lab.ui.createCanvas(canvasImage.width,canvasImage.height+56,'','',true);\n\n        let cx = c.getContext('2d')\n        // cx.drawImage(canvasImage,0,0,canvasImage.width,canvasImage.height,0,0,canvasImage.width,canvasImage.height);\n\n        cx.fillStyle = 'rgba(0,0,0,0.9)'\n        cx.fillRect(0, h - 16, w, 16)\n        cx.font = '10px Georgia'\n        cx.textBaseline = 'bottom'\n        cx.textAlign = 'right'\n        cx.fillStyle = 'white'\n\n        let rare = raresText[im.fileName].rare\n\n        cx.fillText(im.fileName + '_' + rare, w - 3, h - 3)\n        ctx.drawImage(c, j * w, index * h, w, h)\n      }\n    }\n    Lab.ui.saveBase64Dialog(canvas.toDataURL(), '保存', '大图')\n  })\n\n  downloadModel.add(setCodeBtn)\n  downloadModel.add(setDownloadFilePathBtn)\n  downloadModel.add(Lab.ui.createDivider())\n  downloadModel.add(downAllBtn)\n  downloadModel.add(down10000Btn)\n  downloadModel.add(Lab.ui.createDivider())\n  downloadModel.add(selectFromImage)\n  downloadModel.add(selectFromSvgBtn)\n  downloadModel.add(reNameFiles)\n  downloadModel.add(Lab.ui.createDivider())\n  downloadModel.add(allPicsBtn)\n}\n\nfunction createKeysListFromResult(filepaths) {\n  window.keysList = {};\n  var baseNames = {};\n  for (const fileName of filepaths) {\n    let children = Lab.base.readdirSync(fileName)\n    let svgFile = getSvgFile(children)\n    let svg = Lab.base.readFileSync(svgFile);\n    let s = SVG();\n    s.svg(svg);\n    let gs = s.find('g');\n    for (let g of gs) {\n      let basename = g.attr('data-basename');\n      let key = g.attr('id');\n      let id = g.attr('data-id')\n      if (basename) {\n        baseNames[id] = basename;\n        if (!window.keysList[key]) window.keysList[key] = [];\n        window.keysList[key].push({\n          basename, draw: (() => {\n            let gsvg = SVG();\n            gsvg.svg(g.svg());\n            var styles = s.children()[0].attr()\n            gsvg.width(styles.width)\n            gsvg.height(styles.height)\n            gsvg.viewbox(styles.viewBox)\n            return gsvg\n          })(), id\n        })\n      }\n    }\n    // console.log(gs);\n  }\n}\n\n// 创建色块\nfunction createColor(color) {\n  let colorCheckbox = Lab.ui.createGroup()\n  colorCheckbox.style = `display: flex;\n    margin:4px;\n    align-items: center;`\n  let checkbox = Lab.ui.createButton('前景', () => {\n    colorCheckbox.classList.toggle('background')\n    if (colorCheckbox.classList.contains('background')) {\n      checkbox.style.backgroundColor = inc.getValue()\n      checkbox.innerText = '背景'\n    } else {\n      checkbox.style.backgroundColor = '#EEEEEE'\n      checkbox.innerText = '前景'\n    }\n  });\n  let removeBtn = Lab.ui.createIcon('clear', () => {\n    colorCheckbox.remove();\n  })\n  let inc = Lab.ui.createInput('color')\n  inc.style = `margin-right: 18px;`\n  let c = color || '#000000'\n  c = new Lab.Color(c).hex()\n  inc.setDefaultValue([c])\n  colorCheckbox.setValue = v => inc.setValue(c)\n  colorCheckbox.getValue = v => inc.getValue()\n  colorCheckbox.isBackground = () =>\n    colorCheckbox.classList.contains('background')\n  colorCheckbox.add(inc)\n  colorCheckbox.add(checkbox)\n  colorCheckbox.add(removeBtn);\n  return colorCheckbox\n}\n\n// 调整内容\nfunction updateCanvasImgs(id) {\n  let { rect, imgs } = cardElements[id]\n  for (const img of imgs) {\n    if (img.type === 'svg') {\n      img.element.left = rect.left\n      img.element.top = rect.top\n      img.element.scaleToHeight(rect.getScaledHeight())\n      img.element.scaleToWidth(rect.getScaledWidth())\n      myCanvas.render()\n    }\n  }\n}\n\n// 从svg文件名获取id\nfunction getId(children = []) {\n  let svgFile = getSvgFile(children)\n  if (svgFile) {\n    let id = Lab.base.getBaseName(svgFile).replace(/\\..*/gi, '')\n    return id\n  }\n}\n\n// 获取svg文件\nfunction getSvgFile(children = []) {\n  return children.filter(f => f.match('.svg'))[0]\n}\n\n// 从文件夹里取到图片\nfunction getOneImageFromChildren(children = []) {\n  return children.filter(f => f.match('.png') && !f.match('_preview'))[0]\n}\n// 获取预览图\nfunction getPreviewImageFromChildren(children = []) {\n  return children.filter(f => f.match('.png') && f.match('_preview'))[0]\n}\n\nfunction reNameFilesByNewCode(imgFiles, newCode) {\n  //svg data-number\n  let imgFile = getOneImageFromChildren(imgFiles)\n  let previewImgFile = getPreviewImageFromChildren(imgFiles)\n  // console.log(svgFile, imgFile, previewImgFile)\n  let dirname = Lab.base.getDirName(imgFile)\n\n  Lab.base.renameSync(imgFile, dirname + '/' + newCode + '.png')\n  Lab.base.renameSync(previewImgFile, dirname + '/' + newCode + '_preview.png')\n  updateSvgDataNumber(imgFiles, newCode)\n}\n\n// 重新生成水印图\nasync function updatePreviewImage(s, basename, filepath) {\n  // let s = SVG()\n  // s.svg(svg)\n\n  // 增加水印\n  s.children()[0].add(`<text \n  x=\"0\" \n  y=\"${parseInt(\n    s\n      .children()[0]\n      .attr('height')\n      .replace('px', '')\n  ) - 20}\" fill=\"#000\" transform=\"rotate(0 0 0)\" \n  fill-opacity=\"0.5\" \n  font-size=\"12\">${new Array(100).fill(basename).join(' _ ')}</text>`)\n  // 保存预览图\n  svg = s.children()[0].svg()\n  let base64 = await Lab.Image.svg2base64(svg, 'png')\n  Lab.base.saveBase64(\n    base64,\n    filepath\n  )\n}\n\nfunction updateSvgDataNumber(imgFiles, newCode) {\n  let svgFile = getSvgFile(imgFiles)\n  let s = SVG()\n  s.svg(Lab.base.readFileSync(svgFile))\n  s.children()[0].attr('data-number', newCode)\n\n  Lab.base.writeFileSync(svgFile, s.children()[0].svg())\n}\n\nfunction initSvgForRandomLayout() {\n  var draw = SVG()\n  draw.svg(window.base)\n  var parent = draw.children()[0]\n  var styles = parent.attr()\n  draw.width(styles.width)\n  draw.height(styles.height)\n  draw.viewbox(styles.viewBox)\n  // 根目录，文件名也是base\n  var gs = draw.findOne('#base').find('g')\n  return { draw, gs }\n}\n\n// 需要重新编号，以避免重复的坑位，导致素材无法填充\nfunction createMaskKeysFromSvg() {\n  let { draw, gs } = initSvgForRandomLayout()\n  let maskKeys = {}\n  for (let index = 0; index < gs.length; index++) {\n\n    maskKeys[`M-${index}`] = gs[index].id()\n    gs[index].id(`M-${index}`)\n    // maskKeys[gs[index].id()] = 0\n  }\n  window.base = draw.children()[0].svg()\n  return maskKeys\n}\n\nfunction initRandomLayout() {\n  let { gs } = initSvgForRandomLayout()\n  let maskKeys = {}\n  for (let index = 0; index < gs.length; index++) {\n    // gs[index].id(`M-${index}`)\n    maskKeys[gs[index].id()] = {\n      x: gs[index].x(),\n      y: gs[index].y(),\n      width: gs[index].width(),\n      height: gs[index].height(),\n      transform: gs[index].transform()\n    }\n  }\n  return maskKeys\n}\n\nfunction drawBase(preImg) {\n  var draw = SVG()\n  draw.svg(window.base)\n  var parent = draw.children()[0]\n  var styles = parent.attr()\n  draw.width('120px')\n  draw.height('120px')\n  draw.viewbox(styles.viewBox)\n  let gs = Array.from(draw.find('g'), g => g)\n  gs[0].attr('stroke', 'red')\n  Array.from(gs, g =>\n    g.add(`<text \n          x=\"2\" \n          y=\"14\" fill=\"#000\" transform=\"rotate(0 0 0)\" \n          fill-opacity=\"0.8\" \n          font-size=\"14\">${g.id()}</text>`)\n  )\n  Array.from(draw.find('g'), g => g.attr('fill-opacity', 0.4))\n  preImg.setValue([Lab.base.str2URL(draw.svg(), 'image/svg+xml;charset=utf-8')])\n}\n\nfunction drawSvg(addTo, baseData, features) {\n  let draw = SVG()\n  if (addTo) draw.addTo(addTo)\n  // const clickAddImg = function() {\n  //     console.log(this)\n  //     myCanvas.addImg(this.node)\n  // }\n  // draw.on('click', clickAddImg);\n\n  draw.svg(baseData)\n  let parent = draw.children()[0]\n  let styles = parent.attr()\n  draw.width(styles.width)\n  draw.height(styles.height)\n  draw.viewbox(styles.viewBox)\n  // window.draw=draw;\n  // 更改组件\n  let id = ''\n  for (const r of features) {\n    // 组件svg\n    let element = window.keysList[r.key][r.index]\n    draw.findOne('#' + r.key).svg(element.svg, true)\n    // 拼id\n    id = id + '_' + element.id\n    // TODO 調整圖層順序\n    console.log(element.zIndex)\n  }\n\n  // 背景自动上色,随机选取\n  let backgroundColors = getBackgroundColors();\n  if (backgroundColors && backgroundColors.length > 0) {\n    // let colors = Array.from(window.colorsDiv.children, c =>\n    //   new Lab.Color(c.getValue()).hex()\n    // )\n    let color = Lab.base.shuffle(backgroundColors)[0]\n    id = id + '_' + color\n    // 定位到模版的base组件上\n    draw\n      .findOne('#base')\n      .add(\n        `<rect id=\"backgroundAutoFill\" fill=\"${color}\" width=\"${styles.width}\" height=\"${styles.height}\"></rect>`,\n        1\n      )\n  }\n\n  // 唯一id\n  id = Lab.base.md5(id)\n  draw.attr('data-id', id)\n  // 编号\n  draw.attr('data-number', '编号')\n  return draw.svg()\n}\n\nfunction getInputColors(isBackground = true) {\n  let colors = Array.from(window.colorsDiv.children, c => {\n    return {\n      isBackground: c.isBackground(),\n      color: new Lab.Color(c.getValue()).hex()\n    }\n  }).filter(t => t.isBackground === isBackground);\n  colors = Array.from(colors, c => c.color)\n  return colors\n}\n\nfunction getBackgroundColors() {\n  return getInputColors(true)\n}\n\nfunction getBaseColors() {\n  return getInputColors(false)\n}\n\nfunction createDownloadPannel() {\n  let m = Lab.ui.createModel('下载')\n\n  let runBtn = Lab.ui.createButton('下载svg图', () => {\n    // console.log(size)\n    if (window.downloadURL) {\n      let s = SVG()\n      s.svg(window.currentSvg)\n      let id = s.children()[0].attr('data-id')\n      Lab.ui.createDownlad(window.downloadURL, id)\n      downloadPannel.hide()\n    }\n  })\n  m.add(runBtn)\n  let downloadPngBtn = Lab.ui.createButton('下载png图片', () => {\n    // console.log(size)\n    let s = SVG()\n    s.svg(window.currentSvg)\n    let id = s.children()[0].attr('data-id')\n    // TODO bug\n    for (const obj of myCanvas.getObjects()) {\n      if (obj.name === 'svg') Lab.ui.createDownlad(obj.toDataURL(), id)\n    }\n    downloadPannel.hide()\n  })\n  m.add(downloadPngBtn)\n  let copyPngBtn = Lab.ui.createButton('拷贝png图片', () => {\n    // console.log(size)\n    for (const obj of myCanvas.getObjects()) {\n      if (obj.name === 'svg') Lab.clipboard.write(obj.toDataURL(), 'base64')\n    }\n    downloadPannel.hide()\n  })\n  m.add(copyPngBtn)\n  return m\n}\n\n// 图片集\nfunction createCard(row) {\n  let id = new Date().getTime() + '' + parseInt(Math.random() * 1000)\n\n  let card = Lab.ui.createGroup('card')\n  card.style.width = 'min-content'\n  card.style.margin = '12px'\n  card.addEventListener('click', e => {\n    setActiveObject(id)\n    toolbox.update()\n  })\n  card.id = id\n  row.add(card)\n\n  let text = `图片集 ${1 + Object.keys(cardElements).length}`\n  let t = Lab.ui.createBaseText(text)\n  card.add(t)\n  t.style.margin = '1em'\n\n  // img\n  let imgBtn = Lab.ui.createInput(\n    'imgs',\n    text,\n    imgs => {\n      Lab.ui.loading(0)\n      console.log(id, imgs)\n      if (cardElements[id]) cardElements[id].imgUrls = imgs\n      setTimeout(() => Lab.ui.loading(100), 3000)\n    },\n    true,\n    false\n  )\n  card.add(imgBtn)\n\n  // btns 功能区\n  let btnsDiv = Lab.ui.createGroup('column')\n  btnsDiv.style.display = 'flex'\n  let downloadBtn = Lab.ui.createIcon('download', () => {\n    //  console.log(imgBtn.getValue())\n    window.downloadURL = imgBtn.getValue()\n    if (downloadPannel) downloadPannel.show()\n  })\n  btnsDiv.add(downloadBtn)\n\n  card.add(btnsDiv)\n\n  // 占位框\n  let rect = myCanvas.addRect(\n    {\n      left: parseInt(_CANVAS_WIDTH / 2) - 100,\n      top: parseInt(_CANVAS_HEIGHT / 2) - 100,\n      width: 100,\n      height: 100,\n      // stroke: 'red',\n      strokeWidth: 0,\n      fill: 'rgba(255,0,0,0.1)'\n    },\n    true,\n    true,\n    true\n  )\n  // myCanvas.zoomToFitCanvas()\n  rect.name = 'artboard'\n  rect.id = id\n\n  // 选项框\n  let ins = Lab.ui.createInput(\n    'select',\n    '',\n    e => {\n      console.log(e, rect, imgBtn)\n      if (e === 'img') {\n        window.rect = rect\n        window.imgBtn = imgBtn\n      }\n    },\n    true,\n    false\n  )\n  ins.appendOptions([\n    {\n      value: 'img',\n      text: '图片'\n    },\n    {\n      value: 'emoji',\n      text: '表情'\n    },\n    {\n      value: 'color',\n      text: '色块'\n    }\n  ])\n  card.add(ins)\n  ins.init()\n  ins.style.marginLeft = '12px'\n  card.setValue = imgBtn.setValue\n  return { card, rect }\n}\n\nfunction createToolbox() {\n  let inPos = Lab.ui.createInputForPosition(pos => {\n    // console.log(pos)\n    let [x, y, w, h] = pos\n\n    let rect = myCanvas.getActiveObject()\n    rect.scaleToWidth(w)\n    rect.scaleToHeight(h)\n\n    rect.left = x\n    rect.top = y\n    // console.log(z);\n\n    rect.width = w / rect.scaleX\n    rect.height = h / rect.scaleX\n\n    myCanvas.render()\n  })\n  inPos.update = () => {\n    let rect = myCanvas.getActiveObject()\n    inPos.setValue([\n      rect.left,\n      rect.top,\n      rect.getScaledWidth(),\n      rect.getScaledHeight()\n    ])\n    updateCanvasImgs(rect.id)\n  }\n  return inPos\n}\n\nfunction doModified(e, data) {\n  // console.log(e, data)\n  // e.target.id;\n  if (e.target.id && cardElements[e.target.id]) {\n    toolbox.update()\n  }\n}\n\nfunction doClick(e) {\n  // console.log(e.target.id)\n  if (e.target && e.target.id && cardElements[e.target.id]) {\n    let card = cardElements[e.target.id]\n    // console.log(card, e.target.id)\n    card.element.classList.add('red')\n    // 更新rect信息到toolbox\n    toolbox.update()\n  } else {\n    for (const id in cardElements) {\n      cardElements[id].element.classList.remove('red')\n    }\n  }\n}\n\nfunction doRemoved(e) {\n  if (e.target.id && cardElements[e.target.id]) {\n    cardElements[e.target.id].element.remove()\n    delete cardElements[e.target.id]\n  }\n}\n\n// 激活\nfunction setActiveObject(id) {\n  for (const id in cardElements) {\n    cardElements[id].element.classList.remove('red')\n  }\n  if (cardElements[id]) {\n    let c = cardElements[id]\n    myCanvas.setActiveObject(c.rect)\n    c.element.classList.add('red')\n  }\n}\n\nfunction travel(children = []) {\n  // let isDone = true;\n  let list = []\n  for (let c of children) {\n    // console.log(c.node.id);\n    // if (doFun) doFun(c)\n    // if (c.children().length > 0) {\n    //     isDone = false;\n    //     travel(c.children(), doFun, successFun);\n    // };\n    list.push(c)\n    if (c.children().length > 0) {\n      list = [...list, ...travel(c.children())]\n    }\n  }\n  return list\n  // bug\n  // console.log(isDone)\n  // if (successFun && isDone) {\n  //     successFun();\n  // }\n}\n\n// step 1 打开所有的模版\n// step 2 设定变量，预处理，提取变量对应的svg\n// step 3 导出数据\n\n// 得到变量，用-M标记的变量\nfunction getAllMaskKeys(draw) {\n  let maskKeys = []\n  let children = travel(draw.children())\n  // console.log(children)\n  // 遍历过程中的数据处理\n  for (const child of children) {\n    if (\n      child.node.id &&\n      child.node.id.trim() &&\n      child.node.id.match('-M') &&\n      !maskKeys.includes(child.node.id)\n    ) {\n      maskKeys.push(child.node.id)\n    }\n  }\n  // 成功遍历完成\n  return maskKeys\n}\n\n// 初始化\n// keyList=['face','eyes','mouse','ears']\n// window.face=[];\n// window.eyes=[];\n// window.mouse=[];\n// window.ears=[];\nfunction initEngine(draw, keys = []) {\n  // 文件名\n  let basename = Lab.base.getBaseName(draw.__filepath)\n  let children = travel(draw.children())\n  for (const child of children) {\n    // 遍历过程中的数据处理\n\n    if (keys.includes(child.node.id) && window.keysList[child.node.id]) {\n      let id = Lab.base.md5(basename)\n      //  寫上id\n      child.attr('data-id', id)\n      child.attr('data-basename', basename)\n      let svg = child.svg()\n      let isNew = true\n      for (const n of window.keysList[child.node.id]) {\n        if (n.id === id) isNew = false\n      }\n      if (isNew) {\n        window.keysList[child.node.id].push({\n          id,\n          svg,\n          basename,\n          draw,\n          zIndex: keys.indexOf(child.node.id)\n        })\n        let index = window.keysList[child.node.id].length - 1\n        draw.node.addEventListener('click', e => {\n          window.keysList[child.node.id][index].draw.node.style.opacity += 0.05\n          window.keysList[child.node.id][index].zIndex++\n          if (window.keysList[child.node.id][index].draw.node.style.opacity > 1)\n            window.keysList[child.node.id][index].zIndex = 0\n          console.log(window.keysList[child.node.id][index])\n        })\n      }\n    }\n  }\n}\n\n// 笛卡尔生成全集\nfunction createAll() {\n  let data = []\n  for (const key in window.keysList) {\n    data.push(\n      Array.from(window.keysList[key], (d, i) => {\n        return {\n          key: key,\n          index: i\n        }\n      })\n    )\n  }\n  let ds = Lab.base.cartesian(data)\n  // ds=Lab.base.chunk(ds,6);\n  return ds\n}\n\n// 笛卡尔积太大，改用随机生成，重复一定的数量\n// 增加权重,稀有款分数越高\nfunction createAllRandom(count = 100) {\n  if (!window.elementRemoveCheck) return\n  let data = []\n  for (const key in window.keysList) {\n    data.push(\n      Array.from(window.keysList[key], (d, i) => {\n        return {\n          key: key,\n          index: i\n        }\n      })\n    )\n  }\n  // 去重 & 去除掉 需要过滤掉素材组合\n  let ds = []\n  let dsMap = {}\n  for (let index = 0; index < count * 2.5; index++) {\n    let style = []\n    for (const d of data) {\n      let s = Lab.base.shuffle([...d])[0]\n      style.push(s)\n    }\n    let id = Lab.base.hash(style)\n    if (window.elementRemoveCheck[id]) {\n      console.log('需要过滤', style)\n      dsMap[id] = 1\n    }\n    if (!dsMap[id]) {\n      ds.push(style)\n      dsMap[id] = 1\n    }\n  }\n  // 按照稀有度排序,越稀有越靠后 - 对应的文件名编号越大\n  ds = ds.sort((a, b) => {\n    return (\n      Lab.base.sumArray(Array.from(a, i => i.index)) -\n      Lab.base.sumArray(Array.from(b, i => i.index))\n    )\n  })\n  // 配置稀有度\n  let score = [0, 0.8, 0.19, 0.009, 0.001]\n  let newData = []\n  for (let index = 0; index < score.length; index++) {\n    let nd = ds.slice(\n      score[index] * ds.length,\n      score[index] * ds.length + score[index + 1] * ds.length\n    )\n    nd.length\n      ? (newData = [\n        ...newData,\n        ...Lab.base.shuffle([...nd]).slice(0, 1 + count * score[index + 1])\n      ])\n      : null\n  }\n\n  // 去重\n  let res = []\n  let newDataMap = {}\n  for (const d of newData) {\n    let id = Lab.base.hash(d)\n    if (!newDataMap[id]) {\n      res.push(d)\n      newDataMap[id] = 1\n    }\n  }\n\n  res = Lab.base.shuffle([...res]).slice(0, count)\n\n  return res\n}\n\nfunction average(nums) {\n  return nums.reduce((a, b) => a + b) / nums.length\n}\n\nfunction sum(nums) {\n  return nums.reduce((a, b) => a + b)\n}\n",
  "code_length": 369,
  "size": [
    695,
    572
  ],
  "extname": "designlabplugin",
  "version": "0.18",
  "package_version": "0.1.2",
  "package_id": "0d66cc538861f304b963c2dda25d323740ca8d29",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.0.20",
    "@ffprobe-installer/ffprobe": "^1.1.0",
    "@fortawesome/fontawesome-free": "^5.15.3",
    "@hapi/hapi": "^20.1.2",
    "@kilokilo/three-bmfont-text": "^3.1.0",
    "@mediapipe/camera_utils": "^0.3.1632432234",
    "@mediapipe/drawing_utils": "^0.3.1620248257",
    "@mediapipe/holistic": "^0.5.1635989137",
    "@node-rs/jieba": "^1.3.1",
    "@paddlejs-models/humanseg": "0.0.5",
    "@pixiv/three-vrm": "^0.6.7",
    "@tensorflow-models/body-pix": "^2.1.0",
    "@tensorflow-models/deeplab": "^0.2.1",
    "@tensorflow-models/face-landmarks-detection": "0.0.1",
    "@tensorflow-models/knn-classifier": "^1.2.2",
    "@tensorflow-models/mobilenet": "^2.1.0",
    "@tensorflow-models/posenet": "^2.2.2",
    "@tensorflow/tfjs": "^3.3.0",
    "@tensorflow/tfjs-backend-wasm": "^3.3.0",
    "about-window": "^1.14.0",
    "animejs": "^3.2.1",
    "babylonjs": "^4.2.0",
    "babylonjs-gui": "^4.2.0",
    "babylonjs-loaders": "^4.2.0",
    "color": "^3.1.3",
    "copy-dir": "^1.3.0",
    "dat.gui": "^0.7.7",
    "debounce": "^1.2.1",
    "electron-json-storage": "^4.4.0",
    "electron-squirrel-startup": "^1.0.0",
    "emoji-picker-element": "^1.6.0",
    "emoji-regex": "^9.2.2",
    "espree": "^7.3.1",
    "exceljs": "^4.2.1",
    "face-api.js": "^0.22.2",
    "fluent-ffmpeg": "^2.1.2",
    "fomantic-ui": "^2.8.7",
    "gif.js": "^0.2.0",
    "gifuct-js": "^2.1.1",
    "horajs": "^0.1.3",
    "idb-kv-store": "^4.5.0",
    "internal-ip": "^6.2.0",
    "jimp": "^0.16.1",
    "kalidokit": "^1.0.5",
    "lowdb": "^1.0.0",
    "make-cert": "^1.2.0",
    "marked": "^1.2.9",
    "md5": "^2.3.0",
    "mime-types": "^2.1.34",
    "mkcert": "^1.5.0",
    "ml": "^6.0.0",
    "natural": "^5.0.3",
    "ngraph.path": "^1.3.1",
    "nouislider": "^14.7.0",
    "object-hash": "^2.1.1",
    "open-simplex-noise": "^2.5.0",
    "opencvjs-dist": "^4.4.0",
    "osc-js": "^2.1.2",
    "pdfjs-dist": "^2.6.347",
    "peer": "^0.6.1",
    "peerjs": "^1.3.2",
    "pixelit": "https://github.com/giventofly/pixelit.git",
    "qrcode": "^1.5.0",
    "recordrtc": "^5.6.2",
    "regl": "^2.1.0",
    "smartcrop": "^2.0.3",
    "socket.io": "^4.0.0",
    "socket.io-client": "^4.0.0",
    "three": "^0.134.0",
    "timeago.js": "^4.0.2",
    "unsplash-js": "^7.0.12",
    "wordcloud": "^1.2.2",
    "yoga-layout-wasm": "^1.9.3-alpha.7",
    "zdog": "^1.1.2"
  },
  "author": "shadow",
  "create_time": 1643892633034
}