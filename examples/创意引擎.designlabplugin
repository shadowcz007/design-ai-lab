{
  "id": "c40efef44ce2ab0cd95d82475873fddc96ad5e74",
  "poster": "data:image/png;base64,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",
  "title": "创意引擎",
  "knowledge": {
    "course": "- 变量\n- 优化ui\n- 基于svg模版的生成\n- ",
    "readme": "创意引擎",
    "author": "shadow",
    "version": "0.4.0"
  },
  "code": "var mainDiv, myCanvas, toolbox;\n\n// 保存坑位\nvar cardElements = {};\n\nvar _CANVAS_WIDTH = Math.min(window.innerWidth * 0.3, 300),\n    _CANVAS_HEIGHT = 300;\n\n\n// svg模版\nvar svgs = [];\n\nfunction gui() {\n\n    window.toast=Lab.base.debounce(()=>{\n        if(window.result&&window.result.length) Lab.ui.toast(window.result.length);\n    },1000);\n\n    // 加载svg库\n    Lab.base.loadFromUrl('js', 'https://cdn.bootcdn.net/ajax/libs/svg.js/3.1.1/svg.min.js');\n\n    mainDiv = Lab.ui.createGroup('container');\n    Lab.ui.add(mainDiv);\n    mainDiv.style = 'width: 100%;';\n\n    mainDiv.innerHTML = `\n    <div class=\"ui two column divided grid\">\n        <div class=\"stretched row\">\n            <div class=\"column\">\n                <div class=\"ui segment\" id='myCanvas'></div>\n            </div>\n            <div class=\"column\" id=\"toolbox\"></div>\n        </div>\n    </div>\n    <div class=\"ui column divided grid\">\n        <div class=\"stretched row\">\n            <div class=\"column\" id='cards'></div>\n        </div>\n    </div>\n    `;\n\n\n    myCanvas = new Lab.Canvas(_CANVAS_WIDTH, _CANVAS_HEIGHT);\n    myCanvas.onModified = doModified;\n    myCanvas.onClick = doClick;\n    myCanvas.onRemoved = doRemoved;\n    mainDiv.querySelector('#myCanvas').appendChild(myCanvas.getElement())\n\n\n    let cardsDiv = Lab.ui.createGroup('cards');\n    mainDiv.querySelector('#cards').appendChild(cardsDiv);\n\n    toolbox = createToolbox();\n    mainDiv.querySelector('#toolbox').appendChild(toolbox);\n\n\n    let addBtn = Lab.ui.createIcon('plus', () => {\n        Lab.ui.loading(0);\n        let { card, rect } = createCard(cardsDiv);\n        cardElements[card.id] = {\n            element: card,\n            rect: rect,\n            imgUrls: []\n        };\n        setTimeout(() => Lab.ui.loading(100), 200);\n    });\n    addBtn.classList.add('red');\n    addBtn.style = `\n    position:fixed;\n    right:12px;\n    top:240px;\n    `;\n\n\n\n    myCanvas.addRect({\n            left: 0,\n            top: 0,\n            width: _CANVAS_WIDTH,\n            height: _CANVAS_HEIGHT,\n            stroke: 'black',\n            fill: 'white'\n        },\n        false, true, true)\n    myCanvas.zoomToFitCanvas();\n\n    \n    // 打开多个svg文件\n    let openBtn = Lab.ui.createButton('1 打开多个svg文件', () => {\n        Lab.ui.loading(0);\n        let datas = Lab.ui.openStringDialog(3);\n        console.log(datas);\n        let maskKeys = [];\n        for (const data of datas) {\n            let draw = SVG().addTo('body');\n            draw.__filepath = data.filepath;\n            draw.svg(data.data);\n            let parent = draw.children()[0];\n            let styles = parent.attr();\n            draw.width(styles.width);\n            draw.height(styles.height);\n            draw.viewbox(styles.viewBox);\n            svgs.push(draw);\n            // 预先提取变量\n            getAllMaskKeys(draw, ks => {\n                Array.from(ks, k => {\n                    if (!maskKeys.includes(k)) maskKeys.push(k);\n                });\n                paramsInput.setValue(maskKeys.join('\\n'));\n            });\n        };\n        setTimeout(() => Lab.ui.loading(100), 200);\n    });\n    Lab.ui.add(openBtn);\n    Lab.ui.add(Lab.ui.createDivider());\n\n\n    // 设定哪些变量要提取\n    let paramsInput = Lab.ui.createTextareaInput('变量设定', e => {\n        // console.log(e);\n    });\n\n    Lab.ui.add(paramsInput);\n    Lab.ui.add(Lab.ui.createDivider());\n\n    // 预处理数据\n    let preDataBtn = Lab.ui.createButton('2 预处理', () => {\n        Lab.ui.loading(0);\n        let text = paramsInput.getValue();\n        if (text) {\n            let keys = text.split('\\n').filter(f => f);\n            if (keys) {\n                window.keysList = {};\n                for (const key of keys) {\n                    window.keysList[key] = [];\n                };\n                Array.from(svgs, s => initEngine(s, keys));\n            }\n        }\n        // console.log(paramsInput.getValue())\n        // \n        setTimeout(() => Lab.ui.loading(100), 200);\n    });\n    Lab.ui.add(preDataBtn);\n    Lab.ui.add(Lab.ui.createDivider());\n\n    \n\n    // 打开基础模版，生成全部集合\n    let createBtn = Lab.ui.createButton('3 打开基础模版，随机生成', () => {\n        Lab.ui.loading(0);\n        let data = Lab.ui.openStringDialog(1);\n        if (window.result && data) {\n            window.base=data.data;\n            window.resultIndex=0;\n            // 100个存出来\n            // let datas = [...Lab.base.shuffle(result)].slice(0, 100);\n            let datas = [...Lab.base.shuffle(result)].slice(0, 10);\n            // let filepaths = Lab.ui.getFilePath(2);\n            for (const features of datas) {\n                if(features) drawSvg('body',window.base,features);\n                // 导出本地文件\n                // let svg = parent.svg();\n                // let id = Lab.base.md5(svg);\n                // if (filepaths && filepaths[0]) {\n                //     Lab.base.saveData(filepaths[0] + '/' + id + '.svg', svg);\n                // }\n            }\n        }\n\n        setTimeout(() => Lab.ui.loading(100), 200);\n    });\n    Lab.ui.add(createBtn);\n    Lab.ui.add(Lab.ui.createDivider());\n\n    // 下一个\n    let nextBtn = Lab.ui.createButton('下一个', async () => {\n        myCanvas.reset();\n        if(window.resultIndex>=window.result.length) window.resultIndex=0;\n        let features=result.slice(window.resultIndex,window.resultIndex+1)[0];\n        let svg=drawSvg(false,window.base,features);\n        let url=Lab.base.str2URL(svg,\"image/svg+xml;charset=utf-8\");\n        let target=await myCanvas.addSVGFromURL(url);\n        window.targetUrl=url;\n        window.resultIndex++;\n        // 添加到画布上\n        let cardsDiv = Lab.ui.createGroup('cards');\n        mainDiv.querySelector('#cards').appendChild(cardsDiv);\n        let { card, rect } = createCard(cardsDiv);\n        cardElements[card.id] = {\n            element: card,\n            rect: rect,\n            imgs: [\n                {\n                    element:target,\n                    url:url,\n                    type:'svg'\n                }\n            ]\n        };\n        card.setValue([url]);\n        // 缩放表情包\n        updateCanvasImgs(card.id);\n        \n    });\n    Lab.ui.add(nextBtn);\n    Lab.ui.add(Lab.ui.createDivider());\n\n    // 拷贝\n    let copyBtn = Lab.ui.createButton('拷贝', () => {\n        let base64=myCanvas.toDataURL();\n        Lab.clipboard.write(base64,'base64');\n    });\n    Lab.ui.add(copyBtn);\n};\n\n// 调整内容\nfunction updateCanvasImgs(id){\n    let {rect,imgs}=cardElements[id];\n        for (const img of imgs) {\n            if(img.type==='svg'){\n                img.element.left=rect.left;\n                img.element.top=rect.top;\n                img.element.scaleToHeight(rect.getScaledHeight());\n                img.element.scaleToWidth(rect.getScaledWidth());\n                myCanvas.render();\n            }\n        };\n}\n\nfunction drawSvg(addTo,baseData,features){\n    let draw = SVG();\n    if(addTo) draw.addTo(addTo);\n    // const clickAddImg = function() {\n    //     console.log(this)\n    //     myCanvas.addImg(this.node)\n    // }\n    // draw.on('click', clickAddImg);\n    \n    draw.svg(baseData);\n    let parent = draw.children()[0];\n    let styles = parent.attr();\n    draw.width(styles.width);\n    draw.height(styles.height);\n    draw.viewbox(styles.viewBox);\n    // window.draw=draw;\n    // 更改组件\n    for (const r of features) {\n        // 组件svg\n        let element = window.keysList[r.key][r.index];\n        draw.findOne('#' + r.key).svg(element.svg, true);\n    }\n    return draw.svg();\n}\n\nfunction createCard(row) {\n    let id = (new Date()).getTime() + '' + parseInt(Math.random() * 1000);\n\n    let card = Lab.ui.createGroup('card');\n    card.style.width = 'min-content';\n    card.addEventListener('click', e => {\n        setActiveObject(id);\n        toolbox.update();\n    });\n    card.id = id;\n    row.add(card);\n\n    let text = `图片集 ${1 + Object.keys(cardElements).length}`;\n    let t = Lab.ui.createBaseText(text);\n    card.add(t);\n    t.style.margin = '1em';\n\n    // img\n    let imgBtn = Lab.ui.createInput('imgs', text, (imgs) => {\n        Lab.ui.loading(0);\n        console.log(id, imgs)\n        if (cardElements[id]) cardElements[id].imgUrls = imgs;\n        setTimeout(() => Lab.ui.loading(100), 3000);\n    }, true, false);\n    card.add(imgBtn);\n\n    // emoji\n    let emojiDiv = Lab.ui.createGroup('column');\n    emojiDiv.style.display = 'flex';\n    let emojiBtn = Lab.ui.createIcon('plus', () => {\n        let e = Lab.ui.createBaseText(Lab.base.shuffle(Lab.emoji.order())[0]);\n        emojiDiv.add(e);\n    });\n    emojiDiv.add(emojiBtn);\n\n    card.add(emojiDiv);\n\n    // color\n    let colorDiv = Lab.ui.createGroup('column');\n    let colorBtn = Lab.ui.createIcon('plus', () => {\n        let e = Lab.ui.createInput('color', text + colorDiv.children.length, (color) => {});\n        colorDiv.add(e);\n    });\n    colorDiv.add(colorBtn);\n\n    card.add(colorDiv);\n\n    // 占位框\n    let rect = myCanvas.addRect({\n        left: parseInt(_CANVAS_WIDTH / 2) - 100,\n        top: parseInt(_CANVAS_HEIGHT / 2) - 100,\n        width: 100,\n        height: 100,\n        // stroke: 'red',\n        strokeWidth: 0,\n        fill: 'rgba(255,0,0,0.1)'\n    }, true, true, true)\n    // myCanvas.zoomToFitCanvas()\n    rect.id = id;\n\n\n    // 选项框\n    let ins = Lab.ui.createInput('select', '', e => {\n        console.log(e,rect,imgBtn);\n        if(e==='img'){\n            window.rect=rect;\n            window.imgBtn=imgBtn;\n        }\n    }, true, false);\n    ins.appendOptions([{\n        value: 'img',\n        text: '图片'\n    }, {\n        value: 'emoji',\n        text: '表情'\n    }, {\n        value: 'color',\n        text: '色块'\n    }]);\n    card.add(ins);\n    ins.init();\n    ins.style.marginLeft = '12px';\n    card.setValue=imgBtn.setValue;\n    return { card, rect }\n}\n\nfunction createToolbox() {\n    let inPos = Lab.ui.createInputForPosition((pos) => {\n        // console.log(pos)\n        let [x, y, w, h] = pos;\n\n        let rect = myCanvas.getActiveObject();\n        rect.scaleToWidth(w);\n        rect.scaleToHeight(h);\n\n        rect.left = x;\n        rect.top = y;\n        // console.log(z);\n\n        rect.width = w / rect.scaleX;\n        rect.height = h / rect.scaleX;\n\n        myCanvas.render();\n    });\n    inPos.update = () => {\n        let rect = myCanvas.getActiveObject();\n        inPos.setValue([rect.left, rect.top, rect.getScaledWidth(), rect.getScaledHeight()]);\n        updateCanvasImgs(rect.id);\n    }\n    return inPos;\n}\n\n\nfunction doModified(e, data) {\n    // console.log(e, data)\n    // e.target.id;\n    if (e.target.id && cardElements[e.target.id]) {\n        toolbox.update();\n    }\n\n}\n\nfunction doClick(e) {\n    // console.log(e.target.id)\n    if (e.target&&e.target.id && cardElements[e.target.id]) {\n        let card = cardElements[e.target.id];\n        // console.log(card, e.target.id)\n        card.element.classList.add('red');\n        // 更新rect信息到toolbox\n        toolbox.update();\n    } else {\n        for (const id in cardElements) {\n            cardElements[id].element.classList.remove('red');\n        };\n    }\n}\n\nfunction doRemoved(e) {\n    if (e.target.id && cardElements[e.target.id]) {\n        cardElements[e.target.id].element.remove();\n        delete cardElements[e.target.id];\n    };\n}\n\n// 激活\nfunction setActiveObject(id) {\n    for (const id in cardElements) {\n        cardElements[id].element.classList.remove('red');\n    };\n    if (cardElements[id]) {\n        let c = cardElements[id];\n        myCanvas.setActiveObject(c.rect);\n        c.element.classList.add('red');\n    };\n}\n\nfunction travel(children = [], doFun, successFun) {\n    let isDone = false;\n    for (let c of children) {\n        // console.log(c.node.id);\n        if (doFun) doFun(c)\n        if (c.children().length > 0) {\n            isDone = false;\n            travel(c.children(), doFun, successFun);\n        } else {\n            isDone = true;\n        };\n    };\n    if (successFun && isDone) {\n        successFun();\n    }\n};\n\n// step 1 打开所有的模版\n// step 2 设定变量，预处理，提取变量对应的svg\n// step 3 导出数据\n\n\n// 得到变量，用-M标记的变量\nfunction getAllMaskKeys(draw, cb) {\n    let maskKeys = [];\n    travel(draw.children(), child => {\n        // 遍历过程中的数据处理\n        if (child.node.id && child.node.id.trim() && child.node.id.match('-M') && !maskKeys.includes(child.node.id)) {\n            maskKeys.push(child.node.id);\n        };\n\n    }, () => {\n        // 成功遍历完成\n        if (cb) cb(maskKeys);\n    });\n}\n\n// 初始化\n// keyList=['face','eyes','mouse','ears']\n// window.face=[];\n// window.eyes=[];\n// window.mouse=[];\n// window.ears=[];\nfunction initEngine(draw, keys = []) {\n    // 文件名\n    let basename = Lab.base.getBaseName(draw.__filepath);\n\n    travel(draw.children(), child => {\n        // 遍历过程中的数据处理\n        if (keys.includes(child.node.id) && window.keysList[child.node.id]) {\n            let svg = child.svg(),\n                id = Lab.base.md5(svg);\n            let isNew = true;\n            for (const n of window.keysList[child.node.id]) {\n                if (n.id === id) isNew = false;\n            };\n            if (isNew) {\n                window.keysList[child.node.id].push({\n                    id,\n                    svg,\n                    basename\n                });\n            }\n        }\n    }, () => {\n        // 成功遍历完成\n        let count = 0,\n            target = 0;\n        for (const key in window.keysList) {\n            count += window.keysList[key].length;\n            target += svgs.length;\n        };\n        if (target && count) {\n            window.result = createAll();\n            window.toast();\n            console.log('succes', count / target, window.keysList, window.result);\n        };\n    });\n};\n\n\n// 笛卡尔生成全集\nfunction createAll() {\n    let data = [];\n    for (const key in window.keysList) {\n        data.push(Array.from(window.keysList[key], (d, i) => {\n            return {\n                key: key,\n                index: i\n            }\n        }));\n    }\n    return Lab.base.cartesian(data);\n}",
  "code_length": 127,
  "size": [
    855,
    767
  ],
  "extname": "designlabplugin",
  "version": "0.4.0",
  "package_version": "0.1.2",
  "package_id": "18a1c11af0f9a03eaa24917b0a92eff5dc567fe4",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.0.20",
    "@ffprobe-installer/ffprobe": "^1.1.0",
    "@fortawesome/fontawesome-free": "^5.15.3",
    "@hapi/hapi": "^20.1.2",
    "@node-rs/jieba": "^1.3.1",
    "@paddlejs-models/humanseg": "0.0.5",
    "@tensorflow-models/body-pix": "^2.1.0",
    "@tensorflow-models/deeplab": "^0.2.1",
    "@tensorflow-models/face-landmarks-detection": "0.0.1",
    "@tensorflow-models/knn-classifier": "^1.2.2",
    "@tensorflow-models/mobilenet": "^2.1.0",
    "@tensorflow-models/posenet": "^2.2.2",
    "@tensorflow/tfjs": "^3.3.0",
    "@tensorflow/tfjs-backend-wasm": "^3.3.0",
    "about-window": "^1.14.0",
    "animejs": "^3.2.1",
    "color": "^3.1.3",
    "debounce": "^1.2.1",
    "electron-json-storage": "^4.4.0",
    "electron-squirrel-startup": "^1.0.0",
    "emoji-picker-element": "^1.6.0",
    "emoji-regex": "^9.2.2",
    "espree": "^7.3.1",
    "exceljs": "^4.2.1",
    "face-api.js": "^0.22.2",
    "fluent-ffmpeg": "^2.1.2",
    "fomantic-ui": "^2.8.7",
    "gif.js": "^0.2.0",
    "gifuct-js": "^2.1.1",
    "horajs": "^0.1.3",
    "idb-kv-store": "^4.5.0",
    "internal-ip": "^6.2.0",
    "jimp": "^0.16.1",
    "lowdb": "^1.0.0",
    "make-cert": "^1.2.0",
    "marked": "^1.2.9",
    "md5": "^2.3.0",
    "mime-types": "^2.1.30",
    "mkcert": "^1.4.0",
    "ml": "^6.0.0",
    "natural": "^5.0.3",
    "ngraph.path": "^1.3.1",
    "nouislider": "^14.7.0",
    "object-hash": "^2.1.1",
    "opencvjs-dist": "^4.4.0",
    "osc-js": "^2.1.2",
    "pdfjs-dist": "^2.6.347",
    "peer": "^0.6.1",
    "peerjs": "^1.3.2",
    "pixelit": "https://github.com/giventofly/pixelit.git",
    "recordrtc": "^5.6.2",
    "regl": "^2.1.0",
    "smartcrop": "^2.0.3",
    "socket.io": "^4.0.0",
    "socket.io-client": "^4.0.0",
    "timeago.js": "^4.0.2",
    "unsplash-js": "^7.0.12",
    "wordcloud": "^1.2.2",
    "yoga-layout-wasm": "^1.9.3-alpha.7",
    "zdog": "^1.1.2"
  },
  "author": "shadow",
  "create_time": 1635329335325
}