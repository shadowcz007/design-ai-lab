{
  "id": "818a950508b849882dc9755ace3fdcd6feed894b",
  "poster": "data:image/png;base64,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",
  "title": "文本动图合成",
  "knowledge": {
    "course": "合成各种动图版的文字",
    "readme": "文本动图合成",
    "author": "shadow",
    "version": "0.5.3"
  },
  "code": "//Hello AI world!\n\nvar isDev = true;\nvar idSelect, targetText;\nvar allParaments = [{\n        id: 0,\n        label: '放大缩小',\n        color:'gray',\n        duration: 2000,\n        maxFontSize: 88,\n        from: {\n            fontSize: 44\n        },\n        to: {\n            fontSize: [44, 88, 44],\n        },\n        frameFun: (ctx, data) => {\n            // let t='😭';\n            let textCanvas = Lab.ui.createTextCanvas2(targetText, {\n                fontSize: data.fontSize\n            });\n            if (isDev) console.log(data);\n            //Lab.ui.add(textCanvas);\n            // textCanvas.style.outline='1px solid red'\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            ctx.fillStyle = 'white';\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n            let w = textCanvas.width,\n                h = textCanvas.height,\n                x = parseInt((ctx.canvas.width - w) * 0.5),\n                y = parseInt((ctx.canvas.height - h) * 0.5);\n            ctx.drawImage(\n                textCanvas,\n                0,\n                0,\n                textCanvas.width,\n                textCanvas.height,\n                x,\n                y,\n                w,\n                h);\n        }\n    },\n    {\n        id: 1,\n        label: '逐字输入',\n        color:'gray',\n        easing:'linear',\n        duration: t => t.length *60000/250,\n        endDelay: 0,\n        maxFontSize: 44,\n        from: {\n            x: 0,\n            fontSize: 44\n        },\n        to: {\n            x: [0, 100],\n            fontSize: 44\n        },\n        frameFun: (ctx, data) => {\n            if (isDev) console.log(data);\n            let tx = Array.from(targetText, t => t);\n            tx = tx.slice(0, Math.round(0.01 * data.x * tx.length));\n            // console.log(data.x, tx)\n\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            ctx.fillStyle = 'white';\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            if (tx.length > 0) {\n                let textCanvas = Lab.ui.createTextCanvas2(tx.join(\"\"), {\n                    fontSize: data.fontSize\n                });\n                let w = textCanvas.width,\n                    h = textCanvas.height,\n                    x = 0,\n                    y = 0;\n                ctx.drawImage(\n                    textCanvas,\n                    0,\n                    0,\n                    textCanvas.width,\n                    textCanvas.height,\n                    x,\n                    y,\n                    w,\n                    h);\n                ctx.fillStyle = 'black';\n                Math.random() > 0.5 ? ctx.fillRect(w + 16, 10, 6, h - 20) : null;\n            }\n\n        }\n    },\n    {\n        id: 2,\n        label: '弹幕款',\n        color:'gray',\n        duration: t => t.length *200,\n        endDelay: 600,\n        easing:'linear',\n        maxFontSize: 44,\n        from: {\n            x: -110,\n            fontSize: 44\n        },\n        to: {\n            x: 110,\n            fontSize: 44\n        },\n        frameFun: (ctx, data) => {\n            if (isDev) console.log(data);\n           \n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            ctx.fillStyle = 'white';\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            if (targetText) {\n                let textCanvas = Lab.ui.createTextCanvas2(targetText, {\n                    fontSize: data.fontSize\n                });\n                let w = textCanvas.width,\n                    h = textCanvas.height,\n                    x = -data.x*0.01*w,\n                    y = 0;\n                ctx.drawImage(\n                    textCanvas,\n                    0,\n                    0,\n                    textCanvas.width,\n                    textCanvas.height,\n                    x,\n                    y,\n                    w,\n                    h);\n                ctx.fillStyle = 'black';\n                // Math.random() > 0.5 ? ctx.fillRect(w + 16, 10, 6, h - 20) : null;\n            }\n\n        }\n    },\n    {\n        id: 3,\n        label: '左右摇摆',\n        color:'gray',\n        duration: 5000,\n        endDelay: 500,\n        easing:'easeInOutCirc',\n        maxFontSize: 44,\n        from: {\n            x: -50,\n            fontSize: 44\n        },  \n        to: {\n            x: [-50,50,50,-50],\n            fontSize: 44\n        },\n        frameFun: (ctx, data) => {\n            if (isDev) console.log(data);\n           \n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            ctx.fillStyle = 'white';\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            if (targetText) {\n                let textCanvas = Lab.ui.createTextCanvas2(targetText, {\n                    fontSize: data.fontSize\n                });\n                let ww=textCanvas.width;\n                let w = parseInt(ww*0.5),\n                    h = parseInt(textCanvas.height*0.5),\n                    x = ww*0.5-w*0.5+data.x*0.01*w,\n                    y = (textCanvas.height-h)*0.5;\n                ctx.drawImage(\n                    textCanvas,\n                    0,\n                    0,\n                    textCanvas.width,\n                    textCanvas.height,\n                    x,\n                    y,\n                    w,\n                    h);\n                ctx.fillStyle = 'black';\n                // Math.random() > 0.5 ? ctx.fillRect(w + 16, 10, 6, h - 20) : null;\n            }\n\n        }\n    }\n];\n\nvar previewCanvas,animeData;\n\nfunction gui() {\n    let div = Lab.ui.createGroup();\n    Lab.ui.add(div);\n\n    div.add(Lab.ui.createDivider());\n\n    let h = Lab.ui.createHeader(1, '文本生成动画');\n    div.add(h);\n    div.add(Lab.ui.createDivider());\n\n    let inputText = Lab.ui.createInput('text', '输入文本',()=>{\n        animeData=null;\n    });\n    \n    div.add(inputText);\n    div.add(Lab.ui.createDivider());\n\n    let tagsDiv = Lab.ui.createGroup();\n    div.add(tagsDiv);\n\n    let tags = Lab.ui.createTags(allParaments);\n    tagsDiv.add(tags);\n    div.add(Lab.ui.createDivider());\n    Array.from(tags.children, c => {\n            c.addEventListener('click', e => {\n                // console.log(e.target)\n                let dom=e.target;\n                if(e.target.querySelector('.label')) dom=e.target.querySelector('.label');\n                Array.from(tags.querySelectorAll('.label'),b=>{\n                    b.classList.remove('red');\n                });\n                dom.classList.remove('gray');\n                dom.classList.add('red');\n                idSelect = parseInt(dom.getAttribute('data-id'));\n            });\n        })\n        // console.log(tags)\n\n    previewCanvas=Lab.ui.createCanvas(300,300,'','',true);\n    previewCanvas.style=`width:100%;\n        outline: 1px solid #757575;`;\n    div.add(previewCanvas);\n    div.add(Lab.ui.createDivider());\n\n    let runBtn=Lab.ui.createButton('运行',()=>{\n          let text= inputText.getValue();\n          doRun(text);\n    })\n    div.add(runBtn);\n    div.add(Lab.ui.createDivider());\n\n     let runBtn2=Lab.ui.createButton('合成',()=>{\n          let text= inputText.getValue();\n          doRun(text,true);\n    })\n    div.add(runBtn2);\n    div.add(Lab.ui.createDivider());\n};\n\n// 运行合成\nfunction doRun(text,isResult=false){\n     if (text&&text.length && idSelect != undefined) {\n            targetText = text;\n            let p = {...allParaments[parseInt(idSelect)] };\n            if (typeof(p.duration) !== 'number') p.duration = p.duration(text);\n            // TODO 校验\n            // for (const key in p.to) {\n            //     if (!p.from[key]) - 1;\n            // }\n            // console.log(p)\n            if (p) run(text, p.maxFontSize, p.from, p.to, p.frameFun, p.duration, p.endDelay || 0,p.easing,isResult);\n        }\n}\n\nfunction getInitBound(text, maxFontSize) {\n    let textCanvas = Lab.ui.createTextCanvas2(text, {\n        fontSize: maxFontSize\n    });\n    return [textCanvas.width, textCanvas.height]\n}\n\nasync function run(text, maxFontSize, from, to, frameFun, duration, endDelay,easing,isResult=false) {\n    // console.log(maxFontSize, from, to,duration)\n    const saveGifResult=async url=>{\n        let im = Lab.ui.createImageAndDownload(url);\n        let size=await Lab.base.getSize(url);\n        Lab.ui.toast(size.toFixed(2)+'M');\n        Lab.ui.add(im);\n        im.init();\n        // 保存\n        let {id,name}= Lab.base.getAppId();\n        let s=new Lab.Store();\n        if(id) s.set(id,{\n            id,name,data:url\n        });\n    };\n\n    Lab.ui.loading(0);\n    let g = new Lab.GIF(1);\n    let wh=getInitBound(text, maxFontSize);\n    \n    if(isResult&&animeData){\n        let url=await g.createFromAnimeData(...wh,duration,animeData, frameFun);\n        saveGifResult(url);\n    }else if(isResult&&!animeData){\n        let url = await g.createFromCtx(...wh, {\n            duration: duration,\n            delay:0,\n            endDelay: endDelay,\n            round: 2,\n            easing: easing||'easeInOutCirc'\n        }, from, to, frameFun,isResult?null:previewCanvas);\n        saveGifResult(url);\n    }else if(!isResult){\n        animeData = await g.createFromCtx(...wh, {\n            duration: duration,\n            delay:0,\n            endDelay: endDelay,\n            round: 2,\n            easing: easing||'easeInOutCirc'\n        }, from, to, frameFun,isResult?null:previewCanvas);\n        // animeData=[...url];\n    };\n\n    Lab.ui.loading(100);\n};\n\n",
  "code_length": 43,
  "size": [
    417,
    640
  ],
  "extname": "designlabplugin",
  "version": "0.5.3",
  "package_version": "0.1.2",
  "package_id": "6b414523d593157c7846fc8919d13db12ee0f635",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.0.20",
    "@ffprobe-installer/ffprobe": "^1.1.0",
    "@fortawesome/fontawesome-free": "^5.15.3",
    "@hapi/hapi": "^20.1.2",
    "@node-rs/jieba": "^1.2.0",
    "@paddlejs-models/humanseg": "0.0.5",
    "@tensorflow-models/body-pix": "^2.1.0",
    "@tensorflow-models/deeplab": "^0.2.1",
    "@tensorflow-models/face-landmarks-detection": "0.0.1",
    "@tensorflow-models/knn-classifier": "^1.2.2",
    "@tensorflow-models/mobilenet": "^2.1.0",
    "@tensorflow-models/posenet": "^2.2.2",
    "@tensorflow/tfjs": "^3.3.0",
    "@tensorflow/tfjs-backend-wasm": "^3.3.0",
    "about-window": "^1.14.0",
    "animejs": "^3.2.1",
    "color": "^3.1.3",
    "electron-json-storage": "^4.4.0",
    "electron-squirrel-startup": "^1.0.0",
    "emoji-picker-element": "^1.6.0",
    "emoji-regex": "^9.2.2",
    "espree": "^7.3.1",
    "exceljs": "^4.2.1",
    "face-api.js": "^0.22.2",
    "fluent-ffmpeg": "^2.1.2",
    "fomantic-ui": "^2.8.7",
    "gif.js": "^0.2.0",
    "gifuct-js": "^2.1.1",
    "horajs": "^0.1.3",
    "idb-kv-store": "^4.5.0",
    "internal-ip": "^6.2.0",
    "jimp": "^0.16.1",
    "lowdb": "^1.0.0",
    "make-cert": "^1.2.0",
    "marked": "^1.2.9",
    "md5": "^2.3.0",
    "mime-types": "^2.1.30",
    "mkcert": "^1.4.0",
    "ml": "^6.0.0",
    "natural": "^5.0.3",
    "ngraph.path": "^1.3.1",
    "nouislider": "^14.7.0",
    "object-hash": "^2.1.1",
    "opencvjs-dist": "^4.4.0",
    "osc-js": "^2.1.2",
    "pdfjs-dist": "^2.6.347",
    "peer": "^0.6.1",
    "peerjs": "^1.3.2",
    "pixelit": "https://github.com/giventofly/pixelit.git",
    "recordrtc": "^5.6.2",
    "regl": "^2.1.0",
    "smartcrop": "^2.0.3",
    "socket.io": "^4.0.0",
    "socket.io-client": "^4.0.0",
    "timeago.js": "^4.0.2",
    "unsplash-js": "^7.0.12",
    "wordcloud": "^1.2.2",
    "yoga-layout-wasm": "^1.9.3-alpha.7",
    "zdog": "^1.1.2"
  },
  "author": "shadow",
  "create_time": 1631611720812
}