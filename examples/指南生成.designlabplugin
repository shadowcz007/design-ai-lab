{
  "id": "2907a7daa672b5c54556663a83b86616433582f5",
  "poster": "data:image/png;base64,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",
  "title": "æŒ‡å—ç”Ÿæˆ",
  "knowledge": {
    "course": "ç”¨äºŽå¯¹è¯å¼ç½‘é¡µæŽ’ç‰ˆ\n- æ–°å¢žç¾¤èŠæ ·å¼\n\n",
    "readme": "æŒ‡å—ç”Ÿæˆ",
    "author": "shadow",
    "version": "0.10"
  },
  "code": "// ç¼“å­˜key\nvar _STORE_KEY = 'mix-book'\n\nvar dataset = {}\nvar db = new Lab.Store(_STORE_KEY)\n\n// é»˜è®¤çš„å›¾è°±label\nvar _GRAPHE_LABEL = -1\nvar _GRAPHE_LAYOUT = 'circular'\nvar _GRAPHE_COLORS = ['#003366', '#006699', '#4cabce', '#e5323e']\n// æŒ‰æŽ¨èè¿˜æ˜¯æ¥æºå½’ç±»\nvar _GRAPHE_C_BY_L = true\n\n// é…è‰²æ–¹æ¡ˆ\nvar colors = {\n  font: 'rgb(181, 181, 181)',\n  background: '#fff8ee',\n  highlight: ['rgb(255, 192, 56)', 'rgb(181, 181, 181)']\n}\n\n// ç»´æŠ¤å½•å…¥è¿‡äººç‰©ã€å¯¹ç™½\nvar metaHuman = {}\nvar metaHumanStore = new Lab.Store('metaHuman')\nvar metaHumanAvatarsStore = new Lab.Store('metaHumanAvatars')\n\nvar mainDiv, rightDiv, cards, tag, selectModel, myChart\n\n// äººç‰©è¾“å…¥\nvar metaHumanDiv\nvar appDiv\n\nfunction gui () {\n  // åŠ è½½echartåº“\n  loadEcharts()\n\n  mainDiv = Lab.ui.createGroup('container')\n  mainDiv.style = `display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    background: #eee;\n    margin: 0;`\n\n  Lab.ui.add(mainDiv)\n\n  let leftDiv = Lab.ui.createGroup('container')\n  rightDiv = Lab.ui.createGroup('container')\n  leftDiv.style = `margin: 0;\n    padding: 1em;\n    width: 50vw;\n    overflow-y: scroll;`\n  rightDiv.style = `height: 90vh;\n    width: 48vw;\n    position: fixed;\n    top:0;\n    right: 0;\n    padding: 0 16px;\n    margin: 1em;\n    background: white;\n    overflow-y: scroll;`\n  mainDiv.add(leftDiv)\n  mainDiv.add(rightDiv)\n\n  loadAppStore().then(_appDiv => {\n    appDiv = _appDiv\n    // ä»Žapp\n    leftDiv.add(appDiv)\n    leftDiv.add(Lab.ui.createDivider())\n\n    // æ ¹æ®urlèŽ·å–æ–‡ç« \n    let spiderDiv = createSpiderInput()\n    leftDiv.add(spiderDiv)\n    leftDiv.add(Lab.ui.createDivider())\n\n    // äººç‰©\n    metaHumanDiv = createMetaHumanInput()\n    leftDiv.add(metaHumanDiv)\n    leftDiv.add(Lab.ui.createDivider())\n    leftDiv.add(createResultBtns())\n\n    //\n    metaHumanStore.getJson().then(async res => {\n      let avatars = await metaHumanAvatarsStore.getJson()\n      if (res) metaHuman = { ...res }\n      for (const id in metaHuman) {\n        let img = avatars[metaHuman[id].avatarId] || {}\n        metaHuman[id].avatar = img.base64\n      }\n      // console.log(metaHuman,metaHumanDiv.update)\n      metaHumanDiv.updateCount(Object.keys(metaHuman).length)\n    })\n  })\n\n  // rightDiv.add(createResultPannel(rightDiv));\n\n  // // æŒ‰ç…§æŽ¨èå…³ç³»èŽ·å–æ›´å¤š\n  // let moreBtn = Lab.ui.createButton('ç›¸å…³æŽ¨è', moreRelate, false);\n  // mainDiv.add(moreBtn);\n\n  // // ç”Ÿæˆæ–‡ç«  æ¨¡æ€æ¡†\n  // selectModel = Lab.ui.createModel(\"\");\n  // Lab.ui.add(selectModel);\n\n  // let allSelectBtn = Lab.ui.createButton('å…¨éƒ¨å–æ¶ˆ/å¢žåŠ ', toggleSelectForCreate, false);\n  // selectModel.add(allSelectBtn, 'header');\n\n  // let nextBtn = Lab.ui.createButton('ä¸‹ä¸€æ­¥', nextForCreate, false);\n  // selectModel.add(nextBtn, 'header');\n\n  // let runBtn = Lab.ui.createButton('ç”Ÿæˆ', runForCreate, false);\n  // selectModel.add(runBtn, 'header');\n\n  // // è®¾ç½®å›¾è°±çš„é¢œè‰²\n  // let colorsSetBtn = Lab.ui.createButton('é¢œè‰²è®¾ç½®', setColorsForGraph, false);\n  // mainDiv.add(colorsSetBtn);\n\n  // // é‡è®¾å›¾è°±é¢œè‰²\n  // let colorsResetBtn = Lab.ui.createButton('é¢œè‰²é‡è®¾', resetColorsForGraph, false);\n  // mainDiv.add(colorsResetBtn);\n\n  // // ç”Ÿæˆå›¾è°±\n  // let copyGraphBtn = Lab.ui.createButton('ç”Ÿæˆå›¾è°±', runCreateGraph, false);\n  // mainDiv.add(copyGraphBtn);\n\n  // // æ¸…ç©ºæ•°æ®\n  // let clearBtn = Lab.ui.createButton('æ¸…ç©º', clearDataset, false);\n  // mainDiv.add(clearBtn);\n\n  // // é€‰æ‹©åŽç”Ÿæˆ\n  // let selectBtn = Lab.ui.createButton('é€‰æ‹©åŽç”Ÿæˆ', selectForCreate, false);\n  // mainDiv.add(selectBtn);\n\n  // // ç”Ÿæˆç½®é¡¶logo\n  // let createLogo1Btn = Lab.ui.createButton('ç”Ÿæˆç½®é¡¶logo1', () => createOneImageLayout(1), false);\n  // mainDiv.add(createLogo1Btn);\n  // // ç”Ÿæˆç½®é¡¶logo\n  // let createLogo2Btn = Lab.ui.createButton('ç”Ÿæˆç½®é¡¶logo2', () => createOneImageLayout(2), false);\n  // mainDiv.add(createLogo2Btn);\n\n  // // ç”Ÿæˆå•å›¾\n  // let createOneImageLayoutBtn = Lab.ui.createButton('ç”Ÿæˆå•å›¾', () => createOneImageLayout(0), false);\n  // mainDiv.add(createOneImageLayoutBtn);\n\n  // cards = Lab.ui.createGroup('column');\n  // cards.style.width = '320px';\n  // mainDiv.add(cards);\n\n  // åŠ è½½ç¼“å­˜\n  initDatasetFromStore()\n}\n\nfunction initDatasetFromStore () {\n  db.get('dataset').then(r => {\n    if (r) dataset = r\n    tag = Lab.ui.createTag(`æ”¶é›† ${Object.keys(dataset).length}`)\n    tag.style = `\n        position:fixed;\n        top:12px;\n        right:12px;`\n    mainDiv.add(tag)\n    tag.addEventListener('click', async () => {\n      if (Object.keys(dataset).length > 0) {\n        Lab.ui.saveJsonDialog(dataset, 'ä¸‹è½½æ•°æ®')\n      } else {\n        let json = Lab.ui.openJsonDialog()\n        if (Object.keys(json).length > 0) {\n          dataset = json\n          db.set('dataset', dataset)\n          tag.innerText = `æ”¶é›† ${Object.keys(dataset).length}`\n        }\n      }\n      // let tagModel=Lab.ui.createModel();\n      // let downloadBtn = Lab.ui.createButton('ä¸‹è½½æ•°æ®', () => {\n      //     dataset = {};\n      //     db.set('dataset', {});\n      //     cards.innerHTML = '';\n      //     tag.innerText = `æ”¶é›† ${Object.keys(dataset).length}`;\n      // }, false);\n      // mainDiv.add(downloadBtn);\n    })\n  })\n  db.get('_GRAPHE_COLORS').then(r => {\n    if (r) _GRAPHE_COLORS = r\n  })\n}\n\nfunction loadEcharts () {\n  let script = document.createElement('script')\n  script.type = 'text/javascript'\n  script.src = 'https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js'\n  Lab.ui.add(script)\n}\n\nfunction pasteAndSpider () {\n  let url = Lab.clipboard.read()\n  if (url.match('https')) {\n    spider(url, 0)\n  }\n}\n\nfunction spider (url, mainIndex = 0) {\n  let webview = Lab.ui.createWebview(url, false)\n  webview.style = `\n            position:fixed;\n            z-index:9999;\n            top:0;\n            left:0;\n            display:inline-flex;\n            width:1020px;\n            height:2800px;\n            `\n  mainDiv.add(webview)\n  if (typeof mainIndex == 'number')\n    webview.setAttribute('main-index', mainIndex)\n  // console.log(webview.getAttribute('main-index'))\n  // webview.addEventListener('page-title-updated', doData);\n  // webview.addEventListener('dom-ready', console.log);\n  // webview.addEventListener('load-commit', console.log);\n  webview.addEventListener('did-finish-load', doData)\n  // webview.addEventListener('did-frame-finish-load', console.log);\n  // webview.addEventListener('console-message', console.log);\n  // webview.addEventListener('update-target-url', doData);\n}\n\n// æ‰©å……ä¸€å±‚ç›¸å…³æŽ¨è\nfunction moreRelate () {\n  for (const id in dataset) {\n    let d = dataset[id]\n    if (!d.isMore) {\n      for (const r of d.relate) {\n        spider(r.url, d.mainIndex + 1)\n      }\n      d.isMore = true\n    }\n  }\n}\n\n//\nfunction toggleSelectForCreate () {\n  let labels = Array.from(selectModel.querySelectorAll('.label'), d => d)\n  if (\n    Array.from(labels, b => b.classList.contains('red')).filter(f => f).length >\n    0\n  ) {\n    Array.from(labels, r => r.classList.remove('red'))\n  } else {\n    Array.from(labels, r => r.classList.add('red'))\n  }\n}\n\nfunction nextForCreate (viewModel) {\n  // let ids = Array.from(selectModel.querySelectorAll('.label.red'), d => d.getAttribute('data-id'));\n  let datas = []\n  for (let id in dataset) {\n    // if (ids.includes(id)) datas.push(dataset[id]);\n    datas.push(dataset[id])\n  }\n  datas = datas.sort((a, b) => b.mainIndex)\n  return checkImgForCreate(datas, viewModel)\n}\n\nasync function runForCreate () {\n  // selectModel.hide();\n  Lab.ui.loading(0)\n  let selectRes = Array.from(selectModel.querySelectorAll('img'), im => {\n    return {\n      url: im.src,\n      id: im.getAttribute('data-id'),\n      type: im.getAttribute('data-type')\n    }\n  })\n  let imgs = {}\n  Array.from(selectRes, im => {\n    if (!imgs[im.id]) imgs[im.id] = []\n    imgs[im.id].push({ url: im.url, type: im.type })\n  })\n\n  for (let id in imgs) {\n    let data = { ...dataset[id] }\n    data.imgs = imgs[id]\n    imgs[id] = data\n  }\n\n  cards.innerHTML = ''\n  await createCard(imgs)\n  // Lab.clipboard.write(cards.innerHTML,'html');\n  setTimeout(() => Lab.ui.loading(100), 500)\n}\n\n// ç”Ÿæˆä¹‹å‰ å®¡æ ¸å›¾ç‰‡\nfunction checkImgForCreate (datas, viewModel) {\n  const createTagByType = (_type, viewModel) => {\n    let t = Lab.ui.createTag(_type, 'gray')\n    t.addEventListener('click', e => {\n      if (viewModel) viewModel.hide()\n      let data = t.getAttribute('data')\n      if (data) {\n        data = JSON.parse(data)\n        console.log(data)\n        metaHumanDiv.update({\n          name: data.title,\n          avatar: data.imgurl,\n          dialogue: data.text\n        })\n      }\n    })\n    return t\n  }\n\n  let div = Lab.ui.createGroup()\n  for (const data of datas) {\n    let d = { ...data }\n    let card = Lab.ui.createGroup('card')\n    let t = createTagByType(d.type, viewModel)\n    card.add(t)\n    t.setAttribute(\n      'data',\n      JSON.stringify({\n        // imgurl:im.url,\n        title: d.title,\n        text: d.text || ''\n      })\n    )\n\n    let title = Lab.ui.createHeader(4, d.title)\n    // title.style.fontSize = '2em';\n    card.add(title)\n    let txt = Lab.ui.createBaseText(d.text)\n    card.add(txt)\n\n    card.style = `outline:1px solid #eee;padding:12px`\n    // console.log(d)\n\n    if (!d.imgs) d.imgs = []\n    d.imgs = [{ url: d.image }, ...d.imgs]\n    // let mImg = await Lab.ui.createImage(d.image);\n    // mImg.setAttribute('data-id', d.id);\n    // card.add(mImg);\n    d.imgs = Array.from(\n      d.imgs,\n      im => (im = { ...im, score: im.type == 'gif' ? 1 : 0 })\n    ).sort((a, b) => b.score - a.score)\n    d.imgs = d.imgs.filter(f => f.url)\n\n    Array.from(d.imgs, async im => {\n      let row = Lab.ui.createGroup('row')\n      row.style = `margin: 24px 0;outline:1px solid #eee`\n      if (im.url) {\n        im.url = await getImgBase64(im.url)\n\n        let t = createTagByType('IMG', viewModel)\n        row.add(t)\n        t.setAttribute(\n          'data',\n          JSON.stringify({\n            imgurl: im.url,\n            text: im.text || ''\n          })\n        )\n\n        let img = await Lab.ui.createImage(im.url)\n        if (d.id) img.setAttribute('data-id', d.id)\n        img.setAttribute('data-type', im.type)\n        img.className = 'ui card'\n        img.addEventListener('mouseover', e => img.classList.add('raised'))\n        img.addEventListener('mouseout', e => img.classList.remove('raised'))\n        // img.addEventListener('click', e => img.remove());\n        let text = Lab.ui.createBaseText(im.text || '')\n        row.add(img)\n        row.add(text)\n        card.add(row)\n      }\n    })\n    div.add(card)\n  }\n  return div\n}\n\nasync function createCard (ds) {\n  let index = 1\n  for (const id in ds) {\n    let data = ds[id]\n    createCardByHtml(await createCardHtml(index, data))\n    index++\n  }\n}\n\nfunction createCardByHtml (html) {\n  let card = Lab.ui.createGroup('card')\n  // cards.add(card);\n  let htmlDiv = Lab.ui.createGroup('card')\n  card.add(htmlDiv)\n  htmlDiv.innerHTML = '<br>' + html + '<br>'\n  htmlDiv.setAttribute('contenteditable', true)\n\n  rightDiv.add(card)\n  // TODO å˜é‡è§£æž\n  // è§„èŒƒ\n  //variableParse(card, htmlDiv);\n\n  // let copyBtn = Lab.ui.createButton('æ‹·è´', e => {\n  //     // console.log(htmlDiv)\n  //     let metaHumanObj = {\n  //         avatar: htmlDiv.querySelector('.meta-human-avatar').src,\n  //         name: htmlDiv.querySelector('.meta-human-name').innerText,\n  //         dialogue: htmlDiv.querySelector('.meta-human-dialogue').innerText\n  //     };\n  //     let id = Lab.base.md5(metaHumanObj.name);\n  //     let isNew = false;\n  //     if (!metaHuman[id]) {\n  //         metaHuman[id] = {\n  //             id,\n  //             name: metaHumanObj.name,\n  //             avatar: metaHumanObj.avatar,\n  //             dialogues: []\n  //         };\n  //         isNew = true;\n  //     };\n\n  //     if (!metaHuman[id].dialogues.includes(metaHumanObj.dialogue)) {\n  //         metaHuman[id].dialogues.push(metaHumanObj.dialogue);\n  //         isNew = true;\n  //     };\n  //     if (isNew) {\n  //         metaHumanStore.set(id, metaHuman[id]);\n  //     }\n  //     Lab.clipboard.write(htmlDiv.innerHTML, 'html');\n  // }, false);\n  // card.add(copyBtn);\n}\n\n// TODO å˜é‡è§£æž\n// è§„èŒƒ\nfunction variableParse (container, div) {\n  // console.log(div)\n  let vs = div.querySelectorAll('.mix-variable')\n  for (const v of vs) {\n    let value = v.getAttribute('variable-attribute')\n    if (value) {\n      if (value === 'src') {\n        let inputUrl = Lab.ui.createInput('img', '', async ds => {\n          let t = ds[0]\n          if (t) {\n            v.src = await Lab.Image.getNativeImageFromWebview2(t)\n            inputUrl.setPlaceholder([v.src])\n          }\n        })\n        inputUrl.setPlaceholder([v.src])\n        container.add(inputUrl)\n      } else if (value === 'innerText') {\n        let inputText = Lab.ui.createInput('text', v.innerText, ds => {\n          let t = ds[0] || ''\n          v.innerText = t\n        })\n        container.add(inputText)\n      }\n    }\n  }\n}\n\nasync function doData (e) {\n  // console.log(e)\n  let webview = e.target\n  webview.zoomFactor = 0.1\n  await Lab.base.sleep(500)\n  window.scrollTo(0, 999999999999)\n  await Lab.base.sleep(3000)\n  let code = ''\n  console.log(webview.src)\n  // è®¾ç½®urlçš„æ¥æº\n  if (webview.src.match('mp.weixin.qq.com')) {\n    code = `\n        var ks=Array.from(document.head.querySelectorAll('meta'),m=>{\n            return {property:m.getAttribute('property'),content:m.getAttribute('content')}\n        }).filter(f=>f.property==='og:title'||f.property==='og:description'||f.property==='og:image');\n        \n        var kd={\n            type:'weixin',\n            url:document.URL,\n            author:document.querySelector('#js_name').innerText.trim(),\n            text:document.querySelector('#js_content').innerText\n        };\n        Array.from(ks,k=>{\n            kd[k.property.replace('og:','')]=k.content\n        });\n\n        kd.imgs=Array.from(document.querySelectorAll('#js_content img'),img=>{\n            var obj;\n            console.log(img,img.complete)\n            if(img.parentElement.nextElementSibling){\n        \n            let tx=img.parentElement.nextElementSibling.innerText.trim();\n        \n            let dtype=img.getAttribute('data-type'),url=img.src;\n            let width=img.naturalWidth,height=img.naturalHeight;\n        \n            url.match('https')&&width!=height&&width>100?obj={url,text:tx,type:dtype,\n        width,height}:null;\n            \n            }\n            return obj;\n        }).filter(f=>f);\n\n        kd.relate=Array.from(document.querySelectorAll('.js_related_main a'),a=>{\n\n            let im=a.querySelector('.weui-media-box__ft').style.backgroundImage.replace('url(\"','').replace('\")',''),\n                title= a.querySelector('.weui_ellipsis_mod_inner').innerText,\n                author=a.querySelector('.relate_profile_nickname').innerText,\n                url=a.getAttribute('data-url');\n        \n            return{imurl:im,title,author,url};\n        });\n\n        kd;`\n  } else if (webview.src.match('producthunt.com')) {\n    code = `var ks = Array.from(document.head.querySelectorAll('meta'), m => {\n            return { property: m.getAttribute('property'), content: m.getAttribute('content') }\n        }).filter(f => f.property === 'og:title' || f.property === 'og:description' || f.property === 'og:image');\n\n        var exts;\n        try{exts=JSON.parse(Array.from(document.querySelectorAll('script'),s=>s.type=='application/ld+json'?s.innerText:'').filter(f=>f)[0])[0];}catch{};\n\n        var kd = {\n            type: 'producthunt',\n            url: document.URL,\n            applicationCategory:exts?.applicationCategory,\n            exts\n        };\n        Array.from(ks, k => {\n            kd[k.property.replace('og:', '')] = k.content\n        });\n        if(exts) kd.title=exts.name;\n        // kd.image = document.querySelector('.lazyload-wrapper source').src.replace(/\\\\?.*/ig, '');\n        if(exts) kd.image=exts.image;\n\n        kd.imgs = Array.from(document.querySelectorAll('.lazyload-wrapper img'), w => {\n            return { url: w.alt }\n        }).filter(f => f.url.match('http'));\n        kd.relate = Array.from(document.querySelectorAll('a'), a => {\n            return {\n                type: a.getAttribute('data-test'),\n                url: a.href, \n                imurl: (a.querySelector('video source') || a.querySelector('img'))?.src,\n                title: a.querySelectorAll('span')[0]?.innerText\n            }\n        }).filter(f => f.type === 'related-post');\n        kd;`\n  } else if (webview.src.match('baike.baidu.com')) {\n    code = `var text=document.querySelector('.lemma-summary').innerText;\n        var title=document.querySelector('h1').innerText;\n        var info=document.querySelector('.basic-info').innerText.split('\\\\n');\n        var res={title,text,info,type:'baike',url:document.URL};\n        res;`\n  }\n\n  let res = await webview.executeJavaScript(code)\n  console.log(res)\n  // for (const r of res) {\n  //     r.base64=await Lab.Image.getNativeImageFromWebview(r.url);\n  // };\n  if (res && webview.getAttribute('main-index'))\n    res.mainIndex = ~~webview.getAttribute('main-index')\n  if (res) {\n    res.id = Lab.base.hash({\n      title: res.title,\n      description: res.description,\n      image: res.image\n    })\n    // if (!dataset[res.id]) dataset[res.id] = res;\n    res.tags = extractArticalFeature(res)\n    dataset[res.id] = res\n    // console.log(res)\n    db.set('dataset', dataset)\n    tag.innerText = `æ”¶é›† ${Object.keys(dataset).length}`\n\n    // æ›´æ–°å›¾è°±\n    // let data = await createGraph();\n    // displayGraph(data);\n  }\n  webview.remove()\n  return res\n}\n\nasync function createCardHtml (index, cardData) {\n  let html = ''\n  let data = { ...cardData }\n\n  if (data.image) data.image = await getImgBase64(data.image)\n\n  if (data.type == 'weixin')\n    html = createHead(index, data.title, data.image, data.description)\n  if (data.type == 'producthunt')\n    html = oneImageLayout2(data.title, data.image, data.description)\n\n  let imgs = []\n  for (const im of data.imgs) {\n    let base64 = await getImgBase64(im.url)\n    // console.log(im)\n    if (im.type === 'gif') {\n      html += await createContent([base64])\n    } else {\n      imgs.push(base64)\n    }\n  }\n  html += await createContent(imgs)\n  // card.innerHTML=html;\n  // html+=createCopyHTMLBtn();\n  return html\n}\n\nfunction createCopyHTMLBtn () {}\n\nfunction createHead (index, title, image, description) {\n  return `<section class=\"_design-ai-lab\" data-tools=\"mixlabæ— ç•Œç¤¾åŒº\">\n    <section style=\"margin: 1em auto;\">\n        <section style=\"display: flex;align-items: center;justify-content: center;align-items: flex-end;\">\n            <section style=\"box-sizing:border-box;margin-left: 10px;width: 100%;\" data-width=\"45%\">\n                <section style=\"text-align: left;height: 2em;\">\n                    <section class=\"autonum\" style=\"box-sizing:border-box;font-size: 20px;color: #fff;text-align: center;background-image: linear-gradient(to bottom, ${colors.highlight[0]} ,${colors.highlight[1]});display: inline-block;width: 35px;height: 28px;line-height: 28px;\">\n                        <strong style='width: 100%;display: block;'>${index}</strong>\n                    </section>\n                </section>\n                <section style=\"margin-left: 10px;margin-top: -15px;\">\n                    <section data-autoskip=\"1\" class=\"mix-brush\" style=\"text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:14px;background: ${colors.background};padding:1.3em 1em 1em 1em;color: ${colors.font};\">\n                        <p>\n                            <strong>${title}</strong>\n                        </p>\n                        <p>${description}\n                        </p>\n                    </section>\n                    \n                </section>\n            </section>\n            \n        </section>\n    </section></section>\n`\n}\n\nasync function createContent (imgs = []) {\n  if (imgs.length == 1) return oneImageLayout(imgs[0])\n  if (imgs.length >= 3) return await threeImageLayout(imgs)\n  if (imgs.length < 3) return ''\n}\n\nasync function threeImageLayout (imgs) {\n  console.log(imgs)\n  let ratios = [1.1555555555555554, 1.1555555555555554, 1.3737864077669903]\n  let newImages = []\n  for (let index = 0; index < imgs.length; index++) {\n    let im = imgs[index]\n    let img = await Lab.ui.createImage(im)\n    let canvas = await Lab.Image.smartCrop(\n      img,\n      400,\n      parseInt(400 / ratios[index])\n    )\n    newImages.push(canvas.toDataURL())\n  }\n  imgs = newImages\n\n  return `<section class=\"_design-ai-lab\" data-tools=\"mixlabæ— ç•Œç¤¾åŒº\">\n    <section style=\"margin: 10px 2em;text-align: right;\">\n        <section style=\"display: flex;justify-content: center;align-items: flex-end;\">\n            <section style=\"display: flex;flex-direction: column;flex: 1;\">\n                <section style=\"display: flex;justify-content: flex-start;\">\n                    <section class=\"mix-brush\" data-brushtype=\"text\" style=\"font-size: 13px;letter-spacing: 1.5px;padding: 4px 1em;color: ${colors.font};display: inline-block;writing-mode: vertical-lr ;\">\n                        ENJOY\n                    </section>\n                </section>\n                <section style=\"display: flex;justify-content: center;align-items: center;margin-top: 1em;\">\n                    <section style=\"box-sizing:border-box;width: 100%;margin-right: 20px;\" data-width=\"100%\">\n                        <img style=\"box-sizing:border-box;width: 100%;display: block;\" src=\"${imgs[0]}\" data-ratio=\"1.1555555555555554\" data-w=\"135\" data-width=\"100%\"/>\n                    </section>\n                    <section style=\"box-sizing:border-box;width: 100%;margin-right: 10px;\" data-width=\"100%\">\n                        <img style=\"box-sizing:border-box;width: 100%;display: block;\" src=\"${imgs[1]}\" data-ratio=\"1.1555555555555554\" data-w=\"135\" hm_fix=\"325:318\" data-width=\"100%\"/>\n                    </section>\n                </section>\n                <section style=\"display: flex;justify-content: flex-start;margin-top: 1em;\">\n                    <section style=\"box-sizing:border-box;width: 10%;height: 4px;background:${colors.highlight[0]};\" data-width=\"10%\"></section>\n                </section>\n            </section>\n            <section style=\"box-sizing:border-box;width: 40%;\" data-width=\"40%\">\n                <section class=\"assistant\" style=\"display: flex;justify-content: flex-end;\">\n                    <section style=\"box-sizing:border-box;width: 10%;height: 4px;background:${colors.highlight[1]};\" data-width=\"10%\"></section>\n                </section>\n                <section style=\"box-sizing:border-box;width: 100%;margin-top: 20px;\" data-width=\"100%\">\n                    <img style=\"box-sizing:border-box;width: 100%;display: block;\" src=\"${imgs[2]}\" data-ratio=\"1.3737864077669903\" data-w=\"206\" data-width=\"100%\"/>\n                </section>\n            </section>\n        </section>\n    </section>\n</section>\n`\n}\n\nfunction talkMore (img, texts = []) {\n  // let im= await Lab.ui.createImage(img);\n  // let c=new Lab.Color();\n  // let color=(await c.getColor(im))||[0,0,0];\n  // console.log(texts)\n  let isLeft = false\n  let res = []\n  for (const text of texts) {\n    if (isLeft) {\n      res.push(`<section class=\"mix-editor\" style='margin:4px 0;'>\n            <section style=\"display: flex;\">\n                <section style=\"display: flex;\n                width: 70%;\n                justify-content: flex-start;\">\n                    ${\n                      texts.indexOf(text) >= texts.length - 2\n                        ? `<p style='font-size:10px;color:rgb(212 212 212)'>#</p>`\n                        : ''\n                    }\n                    <section\n                        style=\"border-radius: 44px; background-color:rgb(239 239 239); padding: 10px 18px; display: inline-block; color: rgb(17, 17, 17);  margin-left: 25px; box-sizing: border-box;\">\n                        <p style=\"margin: 0px;clear: none !important;font-size: 14px;font-weight: 300;\" class='mix-variable meta-human-dialogue' variable-attribute='innerText'>${text}</p>\n                    </section>\n                </section>\n            </section>\n        </section>`)\n      isLeft = false\n    } else {\n      res.push(`<section class=\"mix-editor\" style='margin:4px 0;'>\n                <section style=\"display: flex;justify-content: flex-end;\">\n                    <section style=\"display: flex;\n                    width: 70%;\n                    justify-content: flex-end;\">\n                        <section\n                            style=\"border-radius: 44px; background-color:rgb(212 212 212); padding: 10px 18px; display: inline-block; color: rgb(17, 17, 17);margin-right: 25px; box-sizing: border-box;\">\n                            <p style=\"margin: 0px;clear: none !important;font-size: 14px;font-weight: 300;\" class='mix-variable meta-human-dialogue' variable-attribute='innerText'>${text}</p>\n                        </section>\n                        ${\n                          texts.indexOf(text) === 0\n                            ? `<p style='font-size:10px;color:rgb(212 212 212)'>#</p>`\n                            : ''\n                        }\n                    </section>\n                </section>\n            </section>`)\n      isLeft = true\n    }\n  }\n  console.log(res)\n  return res.join('')\n}\n\nfunction oneImageLayout2 (title, imgurl, description, isLeft = true) {\n  let oImg = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAeCAYAAABE4bxTAAADA0lEQVRYR8XXX0hTURwH8O/vbrubFQmBL2IvuZmC4EMP/YEebFtCUO/VSxBRUA89BCG5p0TIwB6C8qGHFf2hQEsKI92cUOhDpkFJ7s6sQASfpDJxu39+cTZXmvtz73bN87Kxnfs9n3vO72znElbaoKK2kYNfBWrlt9nPNuOV/oKSJ4joPkA9umGEWna7pzYVFIuxU69R4wB2AdAJ6AFwze+Tx/8n7M8MiUEjSuosCN2rAQwegCFdD9Q5o0TEG41bA+pPsFuGNgNwdY6BPxHhVpJd94746MdGwdaAxCDRROoiAzcKDLgIxkMQhQM+16jdsHWg2Bf26JqqANhZbDACpgAKS5r2uLmh4mux/ma+XwdK11IidRrAHTMB2T4MvCNQj6TrvYfqPWJzlNRygsSOM2rUCQYaS0oFJon4qcHUG/TJE1YycoIyO04NgnjASlievjMAXjJ40FiSIy1N9KtQZl6QuGgwofYR+JgNqGxEiog7/V53KF9mQVA0sVzLkD4AqLAR9Y1Bp4I+13CuzIKgTIGrrQB32AgSUQ8cSde55kZa/De3KGhsjF3fK9XxMgo8570wUyhY52q3DMrUUmofAW8AOGycqQUGrgR98u3VmUVnKNs5Op28ykxtNoIA0ByD21ejTIPE0i1UqqME7LEXhQVm6lre5uw6Wk1LpkHppVOSDUQ0BmCLzSiAEJYMdFsCZXZd8iQgDnL2N3HUsQxaKfKbBFywm0QMkWu9PfnI8g63GgNwwPrVea+YB9HxkkAisj/BVS6oIwR4bUERdwa87sslgwQiNr3sNVgaYaCqLBQhAjLOB2o9SlkggRhSUnsNwlAZO08hGJf8Ps9zkVc2KF3kcTVAEvdZR9EsMYf8dXI4O8O2gNI/B3H1ICR+AWC7yeVTQOgIeOW7Jf11mBkkklD3Azyyvi/NApggGJNgirOTx/Wf8udchzXbZihdT/FUkyHhvXjPwDQIEQIPG5r2+nD91jkzN2UrSDwcMHCGmHrh0J+JXWMGsZFL1urQtEflPBL9BktnFDZhBW8qAAAAAElFTkSuQmCC`\n  // console.log(description)\n  description = description.replace(/\\n/gi, '<br>')\n  if (isLeft) {\n    return `<section class=\"mix-editor\" style='margin: 2em 0;'>\n        <section style=\"display: flex;\">\n            <section style=\"display: inline-block;width: 56px;\">\n                <section\n                    style=\"width: 48px;height: 48px;overflow: hidden;border-radius: 50%;margin: 0px auto;text-align: center;box-sizing: border-box;\">\n                    <img src=\"${imgurl}\" style=\"width: 50px; height: auto; max-width: 100%;\" class='mix-variable meta-human-avatar' variable-attribute='src'></section>\n                <p style=\"margin: 5px auto;color:#333;text-align:center;font-size: 10px;font-weight: 800;\" class='mix-variable meta-human-name' variable-attribute='innerText'>${title}</p>\n            </section>\n            <section style=\"display: inline-block;\">\n                <section\n                    style=\"border-radius: 25px; background-color:rgb(239 239 239); padding: 15px; display: inline-block; color: rgb(17, 17, 17); margin-top: 13px; margin-left: 25px; box-sizing: border-box;\">\n                    <p style=\"margin: 0px;clear: none !important;font-size: 14px;font-weight: 300;\" class='mix-variable meta-human-dialogue' variable-attribute='innerText'>${description}</p>\n                </section>\n            </section>\n        </section>\n    </section>`\n  } else {\n    return `<section class=\"mix-editor\" style='margin: 2em 0;'>\n        <section style=\"display: flex;justify-content: flex-end;\">\n\n            <section style=\"display: inline-block;\">\n                <section\n                    style=\"border-radius: 25px; background-color:rgb(188, 219, 250); padding: 15px; display: inline-block; color: rgb(17, 17, 17); margin-top: 13px; margin-right: 25px; box-sizing: border-box;\">\n                    <p style=\"margin: 0px;clear: none !important;font-size: 14px;font-weight: 300;\" class='mix-variable meta-human-dialogue' variable-attribute='innerText'>${description}</p>\n                </section>\n            </section>\n\n            <section style=\"display: inline-block;width: 56px;\">\n                <section\n                    style=\"width: 48px;height: 48px;overflow: hidden;border-radius: 50%;margin: 0px auto;text-align: center;box-sizing: border-box;\">\n                    <img src=\"${imgurl}\" style=\"width: 50px; height: auto; max-width: 100%;\" class='mix-variable meta-human-avatar' variable-attribute='src'></section>\n                <p style=\"margin: 5px auto;color:#333;text-align:center;font-size: 10px;font-weight: 800;\" class='mix-variable meta-human-name' variable-attribute='innerText'>${title}</p>\n            </section>\n            \n        </section>\n    </section>`\n  }\n}\n\nasync function oneImageLayout (name, img, dialogue) {\n  let dt = new Date()\n  let im = await Lab.ui.createImage(img)\n  let c = new Lab.Color()\n  let color = (await c.getColor(im)) || [0, 0, 0]\n  // console.log(color)\n  return `<section class=\"mix-editor\">\n    <section class=\"\"\n        style=\"border: 1px dotted ${colors.highlight[1]}; \n        margin: 0 11px; \n        padding: 14px 19px 22px 18px; \n        box-sizing: border-box !important;\">\n        <section style=\"display: flex; flex-direction: column;\">\n            <section style=\"display: flex; justify-content: space-between;\">\n                <section>\n                    <p\n                        style=\"color:rgb(${color.join(\n                          ','\n                        )}); font-size: 16px; font-weight: bold; line-height: 16px; font-family: 'æ€æºé»‘ä½“'; letter-spacing: 1px; margin: 0\">\n                        ${name}</p>\n                </section>\n                <section>\n                    <p\n                        style=\"color: ${\n                          colors.highlight[1]\n                        }; font-size: 10px; line-height: 14px; font-family: 'æ€æºé»‘ä½“'; letter-spacing: 1px; margin: 0\">\n                        ${dt.getFullYear()}.${dt.getMonth() +\n    1}.${dt.getDate()}</p>\n                </section>\n            </section>\n            <section style=\"margin-top: 9px;\">\n                <p\n                    style=\"color: ${\n                      colors.highlight[1]\n                    }; font-size: 14px; line-height: 14px; font-family: 'æ€æºé»‘ä½“'; letter-spacing: 1px; margin: 0\">\n                    I LOVE TO TRAVEL</p>\n            </section>\n            <section style=\"margin-top: 13px;\"><img\n                    style=\"max-width: 100%; width: 100%; display: block; height: auto;\"\n                    src=\"${img}\"\n                    alt=\"\"></section>\n            <section\n                style=\"width: 61px;height: 6px;background-color: ${\n                  colors.background\n                };text-align: right;align-self: flex-end;margin-top: 7px;\">\n            </section>\n            <section style=\"display: flex;justify-content: space-between;align-items: center;margin-top: 17px;\">\n                 <p tyle=\"color: ${colors.highlight[1]}; \n                 font-size: 12px; line-height: 14px; \n                 font-family: 'æ€æºé»‘ä½“'; \n                 letter-spacing: 1px; \n                 margin: 0\">\n                            ${dialogue}</p>\n            </section>\n        </section>\n    </section>\n</section>`\n}\n\nasync function setColorsForGraph () {\n  cards.innerHTML = ''\n  let data = await createGraph()\n\n  _GRAPHE_COLORS = Array.from(\n    data.categories,\n    (c, i) => _GRAPHE_COLORS[i % _GRAPHE_COLORS.length]\n  )\n\n  data.categories.forEach((c, index) => {\n    let cg = Lab.ui.createGroup('row')\n    cg.style = `display: flex;\n            justify-content: space-between;`\n\n    let text = `${c} - ${data.categoriesCount[c]}`\n\n    let cIn = Lab.ui.createInput(\n      'color',\n      text,\n      newColors => {\n        _GRAPHE_COLORS[index] = newColors[0]\n        db.set('_GRAPHE_COLORS', _GRAPHE_COLORS)\n      },\n      true,\n      false\n    )\n    cIn.setDefaultValue([_GRAPHE_COLORS[index]])\n    cg.add(Lab.ui.createBaseText(text))\n    cg.add(cIn)\n    cards.add(cg)\n  })\n}\n\nasync function resetColorsForGraph () {\n  cards.innerHTML = ''\n  let data = await createGraph()\n  _GRAPHE_COLORS = [\n    '#5470c6',\n    '#91cc75',\n    '#fac858',\n    '#ee6666',\n    '#73c0de',\n    '#3ba272',\n    '#fc8452',\n    '#9a60b4',\n    '#ea7ccc'\n  ]\n  _GRAPHE_COLORS = Array.from(\n    data.categories,\n    (c, i) => _GRAPHE_COLORS[i % _GRAPHE_COLORS.length]\n  )\n\n  data.categories.forEach((c, index) => {\n    let cg = Lab.ui.createGroup('row')\n    cg.style = `display: flex;\n            justify-content: space-between;`\n\n    let text = `${c} - ${data.categoriesCount[c]}`\n\n    let cIn = Lab.ui.createInput(\n      'color',\n      text,\n      newColors => {\n        _GRAPHE_COLORS[index] = newColors[0]\n        db.set('_GRAPHE_COLORS', _GRAPHE_COLORS)\n      },\n      true,\n      false\n    )\n    cIn.setDefaultValue([_GRAPHE_COLORS[index]])\n    cg.add(Lab.ui.createBaseText(text))\n    cg.add(cIn)\n    cards.add(cg)\n  })\n}\n\nasync function runCreateGraph () {\n  Lab.ui.loading(0)\n  if (!myChart) initGraph()\n  resetGraph()\n  let data = await createGraph()\n  displayGraph(data)\n  // Lab.clipboard.write(JSON.stringify(data));\n  displayTags(data.tags)\n  setTimeout(() => Lab.ui.loading(100), 500)\n}\n\nasync function createGraph () {\n  var links = [],\n    nodes = [],\n    tags = {},\n    categories = [],\n    categoriesCount = {},\n    // æŽ¨èæ¬¡åº\n    levels = []\n\n  let datasetNew = { ...dataset }\n\n  // categoriesç”¨æ¥åˆ†ç±»çš„å­—æ®µ\n  for (let id in datasetNew) {\n    let data = datasetNew[id]\n    if (data.hasOwnProperty('applicationCategory')) {\n      datasetNew[id]['author'] = data['applicationCategory'] || '-'\n    }\n  }\n\n  // ä½¿ç”¨authorä½œä¸ºåˆ†ç±»\n  for (let id in datasetNew) {\n    let data = datasetNew[id]\n    // console.log(data.author)\n    if (!categories.includes(data.author)) categories.push(data.author)\n    if (!levels.includes(data.mainIndex)) levels.push(data.mainIndex)\n    Array.from(data.tags, t => {\n      if (!tags[t.keyword]) tags[t.keyword] = 0\n      tags[t.keyword] += t.weight\n    })\n  }\n  let tagsList = []\n  for (const keyword in tags) {\n    tagsList.push({\n      weight: tags[keyword],\n      keyword\n    })\n  }\n  tags = tagsList.sort((a, b) => b.weight - a.weight)\n  // console.log(tags)\n\n  for (let id in datasetNew) {\n    let data = datasetNew[id]\n\n    // èŽ·å¾—å›¾ç‰‡çš„base64\n    data.image = await getImgBase64(data.image)\n\n    nodes.push({\n      id,\n      title: data.title,\n      value: 0,\n      mainIndex: data.mainIndex,\n      category: data.author,\n      tags: data.tags,\n      image: data.image,\n      targetCategories: {}\n    })\n    // ç»Ÿè®¡åˆ†ç±»ä¸‹é¢çš„æ•°é‡\n    if (!categoriesCount[data.author]) categoriesCount[data.author] = 0\n    categoriesCount[data.author]++\n  }\n\n  for (let id in datasetNew) {\n    let data = datasetNew[id]\n    Array.from(data.relate, r => {\n      let t = r.url.replace(/.*s\\?/gi, '')\n      let tid, tauthor\n      //     console.log(t);\n      for (let m in datasetNew) {\n        let n = datasetNew[m].url.replace(/.*s\\?/gi, '')\n        if (t == n) {\n          tid = m\n          tauthor = datasetNew[m].author\n        }\n      }\n      if (tid) {\n        links.push({ source: id, target: tid, sourceCategory: data.author })\n        // console.log(id == tid);\n        // è®¡ç®—èŠ‚ç‚¹æƒé‡ï¼Œlinkè¶Šå¤šï¼ŒèŠ‚ç‚¹è¶Šå¤§\n        Array.from(nodes, n => {\n          if (n.id == tid) {\n            n.value++\n            if (!n.targetCategories[data.author])\n              n.targetCategories[data.author] = []\n            n.targetCategories[data.author].push(data.title)\n          }\n        })\n      }\n    })\n  }\n\n  // æŽ’åº\n  categories = Array.from(categories, c => {\n    return {\n      name: c,\n      score: categoriesCount[c]\n    }\n  }).sort((a, b) => b.score - a.score)\n  categories = Array.from(categories, c => c.name)\n  // categories = categories.sort((a, b) => a.localeCompare(b));\n\n  links = links.sort((a, b) => a.sourceCategory.localeCompare(b.sourceCategory))\n\n  nodes = nodes.sort((a, b) => a.category.localeCompare(b.category))\n\n  levels = levels.sort((a, b) => a - b)\n\n  return { links, nodes, categories, tags, categoriesCount, levels }\n}\n\nfunction displayTags (tagsAll) {\n  let topN = Lab.ui.createTags(\n      Array.from(tagsAll.slice(0, 10), t => t.keyword)\n    ),\n    bottomN = Lab.ui.createTags(\n      Array.from(\n        tagsAll.slice(tagsAll.length - 10, tagsAll.length),\n        t => t.keyword\n      )\n    ),\n    otherN = Lab.ui.createTags(\n      Array.from(tagsAll.slice(10, tagsAll.length - 10), t => t.keyword)\n    )\n  // console.log(topN)\n  let data = [\n    {\n      active: true,\n      title: 'TOP10',\n      data: Array.from(topN.children, c => c.outerHTML)\n    }\n  ]\n  if (bottomN.children.length > 0)\n    data.push({\n      active: false,\n      title: 'BOTTOMN',\n      data: Array.from(bottomN.children, c => c.outerHTML)\n    })\n  if (otherN.children.length > 0)\n    data.push({\n      active: false,\n      title: 'å…¶ä»–',\n      data: Array.from(otherN.children, c => c.outerHTML)\n    })\n\n  cards.innerHTML = ''\n  let div = Lab.ui.createAccordion(data)\n  cards.add(div)\n}\n\n// æå–æ–‡ç« ç‰¹å¾\nfunction extractArticalFeature (d) {\n  var dts = {}\n  Array.from(\n    Lab.nlp.jieba.extract((d.title + ' ' + d.description).toLowerCase(), 10),\n    t => (dts[t.keyword] = t.weight)\n  )\n  // console.log(dts);\n  dts = Array.from(\n    Lab.nlp.jieba.extract(\n      d.text ? d.text.toLowerCase() : d.description.toLowerCase(),\n      30\n    ),\n    t => {\n      if (dts[t.keyword]) return t\n    }\n  ).filter(f => f)\n  return dts\n}\n\nfunction initGraph () {\n  let c = Lab.ui.createGroup('container')\n  c.style = `position: fixed;\n    bottom: 0;\n    right: 0;\n    outline: gray solid 1px;\n    height: 300px;\n    width: 300px;\n    background: #fff;`\n  let m = Lab.ui.createGroup('container')\n  m.style = `height: 100%;\n    width: 100%;`\n  // let script = document.createElement('script');\n  // script.type = \"text/javascript\";\n  // script.src = \"https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js\";\n  // c.add(script);\n  mainDiv.add(c)\n  c.add(m)\n\n  let btns = Lab.ui.createGroup('column')\n  c.add(btns)\n  btns.style = `position: absolute;\n    top: 0;`\n\n  let btn = Lab.ui.createIcon(\n    'copy',\n    async () => {\n      let im = await Lab.ui.createImage(\n        myChart.getDataURL({\n          type: 'jpeg',\n          pixelRatio: 2,\n          backgroundColor: '#fff',\n          excludeComponents: ['toolbox', 'legend', 'title']\n        })\n      )\n      cards.add(im)\n    },\n    false\n  )\n  btns.add(btn)\n\n  let scaleBtn = Lab.ui.createIcon(\n    'light',\n    async () => {\n      if (c.style.width === '300px') {\n        c.style.width = '100%'\n        c.style.height = '100%'\n        c.style.top = '0'\n      } else {\n        c.style.width = '300px'\n        c.style.height = '300px'\n        c.style.top = 'auto'\n        c.style.bottom = '0'\n      }\n\n      myChart.resize()\n    },\n    false\n  )\n  btns.add(scaleBtn)\n\n  let toggleBtn = Lab.ui.createIcon(\n    'play',\n    async () => {\n      _GRAPHE_LABEL++\n      if (_GRAPHE_LABEL > 3) _GRAPHE_LABEL = 0\n      myChart.resize()\n    },\n    false\n  )\n  btns.add(toggleBtn)\n\n  // æ”¹å˜å¸ƒå±€ç±»åž‹\n  let layoutBtn = Lab.ui.createIcon(\n    'fan',\n    async () => {\n      if (_GRAPHE_LAYOUT === 'circular') {\n        _GRAPHE_LAYOUT = 'force'\n      } else {\n        _GRAPHE_LAYOUT = 'circular'\n      }\n      resetGraph()\n      let data = await createGraph()\n      displayGraph(data)\n    },\n    false\n  )\n  btns.add(layoutBtn)\n\n  // æ”¹å˜åˆ†ç±»\n  let cBtn = Lab.ui.createIcon(\n    'thumbtack',\n    async () => {\n      if (_GRAPHE_C_BY_L === true) {\n        _GRAPHE_C_BY_L = false\n      } else {\n        _GRAPHE_C_BY_L = true\n      }\n      resetGraph()\n      let data = await createGraph()\n      displayGraph(data)\n    },\n    false\n  )\n  btns.add(cBtn)\n\n  resetGraph(m)\n}\n\n// é‡è®¾\nfunction resetGraph (dom) {\n  if (myChart) {\n    if (!dom) dom = myChart.getDom()\n    myChart.dispose()\n  }\n\n  let option = {\n    title: {\n      text: '',\n      subtext: '',\n      top: 'bottom',\n      left: 'right'\n    },\n    tooltip: {\n      triggerOn: 'click',\n      formatter: e => {\n        return `${e.data.categoryName} _ ${e.data.value} \n                <br> ðŸ”¥ ${e.name}\n                <br> ${(() => {\n                  let text = ''\n                  for (const ct in e.data.targetCategories) {\n                    text += `ðŸ’¡ ${ct} <br>${e.data.targetCategories[ct].join(\n                      '<br>'\n                    )}<br>`\n                  }\n                  return text\n                })()}`\n      }\n    },\n    color: _GRAPHE_COLORS,\n    // legend: [{\n    //     data: graph.categories.map(function (a) {\n    //         return a.name\n    //     })\n    // }],\n    zoom: 0.8,\n    animationDurationUpdate: 1500,\n    animationEasingUpdate: 'quinticInOut',\n    emphasis: {\n      focus: 'adjacency'\n      //blurScope: 'coordinateSystem'\n    },\n    series: [\n      {\n        name: '',\n        type: 'graph',\n        layout: _GRAPHE_LAYOUT,\n        circular: {\n          rotateLabel: true\n        },\n        data: [],\n        links: [],\n        categories: [],\n        roam: true,\n        label: {\n          position: 'right',\n          fontSize: 10,\n          formatter: function (b) {\n            // console.log(b)\n            //b.data.categoryName\n            //b.data.tags[0].keyword\n            let t = b.data.tags[0] ? b.data.tags[0].keyword : ''\n\n            //b.name\n            if (_GRAPHE_LABEL === 0) return b.data.categoryName\n            if (_GRAPHE_LABEL === 1) return t\n            if (_GRAPHE_LABEL === 2) return ''\n            return b.name\n          }\n        },\n        lineStyle: {\n          color: 'source',\n          curveness: 0.3\n        },\n        force: {\n          repulsion: 100\n        },\n        left: 10,\n        top: 10,\n        right: 10,\n        bottom: 10\n      }\n    ]\n  }\n\n  if (dom) myChart = echarts.init(dom, null, { renderer: 'canvas' })\n  //myChart.setOption(option);\n\n  if (dom && option && typeof option === 'object') {\n    myChart.setOption(option)\n  }\n}\n\nfunction displayGraph (graph = {}) {\n  // var myChart = echarts.init(dom);\n  // myChart.showLoading();\n  // setTimeout(() => myChart.hideLoading(), 1000);\n  if (_GRAPHE_C_BY_L == true) {\n    graph.categories = Array.from(graph.levels, (c, i) => {\n      return {\n        name: `ç›¸å…³æ€§${c}`,\n        icon: 'circle'\n      }\n    })\n  } else {\n    graph.categories = Array.from(graph.categories, (c, i) => {\n      return {\n        name: c,\n        icon: 'circle'\n      }\n    })\n  }\n\n  graph.nodes.forEach(function (node) {\n    node.name = node.title\n    node.label = {\n      show: true\n    }\n    node.symbolSize = Math.max(20, node.value * 2)\n    node.symbol = `image://${node.image}`\n\n    node.categoryName = node.category\n    if (_GRAPHE_C_BY_L == true) {\n      node.category = node.mainIndex\n    } else {\n      node.category = Array.from(graph.categories, (c, i) => {\n        if (c.name == node.categoryName) return i\n      }).filter(f => f != undefined)[0]\n    }\n  })\n\n  // å¡«å…¥æ•°æ®\n  if (myChart)\n    myChart.setOption({\n      layout: _GRAPHE_LAYOUT,\n      // colors:[\"#003366\", \"#006699\", \"#4cabce\", \"#e5323e\"],\n      legend: [\n        {\n          type: 'scroll',\n          left: '80%',\n          right: 12,\n          top: 24,\n          height: '80%',\n          orient: 'vertical',\n          data: graph.categories,\n          itemStyle: {\n            borderWidth: 2\n          }\n        }\n      ],\n      series: [\n        {\n          data: graph.nodes,\n          links: graph.links,\n          categories: graph.categories\n        }\n      ]\n    })\n\n  return\n}\n\nfunction clearDataset () {\n  dataset = {}\n  db.set('dataset', {})\n  cards.innerHTML = ''\n  tag.innerText = `æ”¶é›† ${Object.keys(dataset).length}`\n}\n\nfunction selectForCreate () {\n  selectModel.show()\n  selectModel.querySelector('.content').innerHTML = ''\n  selectModel.querySelector('.content').style = `height: 80vh;overflow: scroll;`\n  // selectModel.querySelector('.content').setAttribute('contenteditable', true);\n\n  var datas = []\n  for (let id in dataset) {\n    datas.push(dataset[id])\n  }\n  datas = datas.sort((a, b) => b.mainIndex)\n\n  let tags = Lab.ui.createTags(\n    Array.from(datas, d => {\n      return {\n        id: d.id,\n        label: d.title\n      }\n    })\n  )\n  Array.from(tags.querySelectorAll('.label'), i =>\n    i.addEventListener('click', e => {\n      // console.log(e);\n      e.target.classList.toggle('red')\n    })\n  )\n  selectModel.add(tags)\n  // selectBtn.setAttribute('data-click', '2');\n}\n\n// metahuman\nfunction updateMetaHuman (metaHumanObj) {\n  // let metaHumanObj = {\n  //     avatar: htmlDiv.querySelector('.meta-human-avatar').src,\n  //     name: htmlDiv.querySelector('.meta-human-name').innerText,\n  //     dialogue: htmlDiv.querySelector('.meta-human-dialogue').innerText\n  // };\n\n  let avatarId = Lab.base.hash(metaHumanObj.avatar)\n  metaHumanAvatarsStore.set(avatarId, {\n    base64: metaHumanObj.avatar,\n    id: avatarId\n  })\n\n  let data = {\n    name: metaHumanObj.name,\n    // avatar: metaHumanObj.avatar,\n    avatarId,\n    dialogue: metaHumanObj.dialogue\n  }\n\n  let id = Lab.base.hash(data)\n\n  if (!metaHuman[id]) {\n    metaHuman[id] = {\n      id,\n      ...data,\n      avatar: metaHumanObj.avatar\n    }\n    metaHumanStore.set(id, {\n      id,\n      ...data\n    })\n  }\n}\n\n// // GUI\n// function createResultPannel(htmlDiv){\n//     let copyBtn = Lab.ui.createButton('æ‹·è´', e => {\n//         // console.log(htmlDiv)\n//         Lab.clipboard.write(htmlDiv.innerHTML, 'html');\n//     }, false);\n//     return copyBtn\n\n// }\n\nasync function loadAppStore () {\n  let container = Lab.ui.createGroup()\n  let title = Lab.ui.createHeader(2, 'ä»ŽAPP')\n  container.add(title)\n\n  let appStore = new Lab.AppStore()\n  let ids = await appStore.getIds()\n  let dom = Lab.ui.createSelect(\n    'APP',\n    'APP',\n    Array.from(ids, k => {\n      return { value: k.id, text: k.name }\n    })\n  )\n  container.add(dom)\n  container.add(Lab.ui.createDivider())\n\n  container.getValue = async () => {\n    let id = dom.getValue()\n    return await appStore.load(id)\n  }\n  // console.log(dom)\n\n  let selectBtn = Lab.ui.createButton('ç¡®å®š', async () => {\n    // selectModel.clear();\n    // let ds=nextForCreate(selectModel);\n    // selectModel.add(ds);\n    // // let runBtn = Lab.ui.createButton('ç”Ÿæˆ', runForCreate, false);\n    // // selectModel.add(runBtn, 'header');\n    // selectModel.show();\n    let data = await container.getValue()\n    if (data.id === '46dadd69e2d7d3484ad99dae9a970b1799ccb3f8') {\n      // product-huntä¿¡æ¯æ•´ç†\n      let d = Lab.base.shuffle([...data.data])\n      let avatar = await getImgBase64(d[0].imgurl)\n      metaHumanDiv.update({\n        name: d[0].title,\n        avatar: avatar,\n        dialogue: d[0].description + '\\n' + d[0].url\n      })\n    } else if (data.id === '35eb0e192e4e006778b4ca0f8d85028d592638b2') {\n      // æ–‡æœ¬åŠ¨å›¾åˆæˆ\n      let avatar = await getImgBase64(data.data)\n      metaHumanDiv.update({\n        name: data.name,\n        avatar: avatar,\n        dialogue: ''\n      })\n    } else if (data.id === '4c28836a5728d77c47b02b4f755543b0b0389172') {\n      // å›¾ç‰‡å·¥å…·\n      let avatar = await getImgBase64(data.data)\n      metaHumanDiv.update({\n        name: data.name,\n        avatar: avatar,\n        dialogue: ''\n      })\n    }\n  })\n  container.add(selectBtn)\n\n  return container\n}\n\nfunction createSpiderInput () {\n  let container = Lab.ui.createGroup()\n  let title = Lab.ui.createHeader(2, 'ç½‘é¡µ')\n  container.add(title)\n\n  let selectModel = Lab.ui.createModel('é€‰æ‹©')\n  container.add(selectModel)\n\n  let selectBtn = Lab.ui.createButton('é€‰æ‹©', () => {\n    selectModel.clear()\n    let ds = nextForCreate(selectModel)\n    selectModel.add(ds)\n    // let runBtn = Lab.ui.createButton('ç”Ÿæˆ', runForCreate, false);\n    // selectModel.add(runBtn, 'header');\n    selectModel.show()\n  })\n  let spiderBtn = Lab.ui.createButton('ç²˜è´´URLèŽ·å–æ–‡ç« ', pasteAndSpider, false)\n\n  container.add(selectBtn)\n  container.add(spiderBtn)\n\n  return container\n}\n\nfunction createMetaHumanInput () {\n  let container = Lab.ui.createGroup()\n  let humanSelectModel = Lab.ui.createModel('é€‰æ‹©')\n  container.add(humanSelectModel)\n\n  let title = Lab.ui.createHeader(2, 'äººç‰©')\n  container.add(title)\n\n  let num = Lab.ui.createBaseText(Object.keys(metaHuman).length)\n  container.add(num)\n  container.updateCount = n => {\n    num.innerText = n\n    // console.log(num)\n  }\n\n  let histroy = Lab.ui.createIcon('plus', async () => {\n    let items = {}\n    for (const id in metaHuman) {\n      let h = metaHuman[id]\n      if (!items[h.name]) {\n        items[h.name] = {\n          avatars: {},\n          dialogues: []\n        }\n      }\n      items[h.name].avatars[h.avatarId] = h.avatar\n      //å‚æ•°æ‰©å±•\n      items[h.name].dialogues.push(h.dialogue)\n    }\n    // å¦‚æžœæ— æ•°æ®ï¼Œåˆ™ä¸éœ€è¦å¼¹çª—\n    if (Object.keys(items).length === 0) return Lab.ui.toast('æš‚æ— ')\n\n    let parentElement = Lab.ui.createGroup()\n    for (const name in items) {\n      let div = Lab.ui.createGroup()\n\n      div.add(Lab.ui.createHeader(2, name))\n      let avatarImgurls = []\n      for (const id in items[name].avatars) {\n        if (items[name].avatars[id])\n          avatarImgurls.push(\n            `<img src=\"${items[name].avatars[id]}\" style='width:44px;height:auto'/>`\n          )\n      }\n      let imgs = Lab.ui.createList(avatarImgurls)\n      for (const im of imgs.children) {\n        im.classList.add('label')\n        im.classList.add('ui')\n        im.setAttribute(\n          'data-item',\n          JSON.stringify({\n            imgurl: im.querySelector('img').src,\n            name\n          })\n        )\n        im.addEventListener('click', () => {\n          im.classList.toggle('blue')\n          humanSelectModel.hide()\n          let h = JSON.parse(im.getAttribute('data-item'))\n          // console.log(h)\n          container.update({\n            name: h.name,\n            avatar: h.imgurl,\n            dialogue: h.text\n          })\n        })\n      }\n      div.add(imgs)\n      let dialogues = Lab.ui.createList(items[name].dialogues)\n      for (const d of dialogues.children) {\n        d.classList.add('label')\n        d.classList.add('ui')\n        d.setAttribute(\n          'data-item',\n          JSON.stringify({\n            name,\n            text: d.innerText\n          })\n        )\n        d.addEventListener('click', () => {\n            d.classList.toggle('blue');\n            humanSelectModel.hide()\n            let h = JSON.parse(d.getAttribute('data-item'))\n            // console.log(h)\n            container.update({\n              name: h.name,\n              avatar: h.imgurl,\n              dialogue: h.text\n            })\n        })\n      }\n      div.add(dialogues)\n      //   div.add(Lab.ui.createFeed(items[name].data))\n      div.add(Lab.ui.createDivider())\n      parentElement.add(div)\n    }\n\n    // Array.from(parentElement.querySelectorAll('.blue'), item => {\n    //   item.addEventListener('click', e => {\n\n    //   })\n    // })\n\n    humanSelectModel.clear()\n    humanSelectModel.add(parentElement)\n    humanSelectModel.show()\n  })\n  container.add(histroy)\n  container.add(Lab.ui.createDivider())\n\n  let mHuman = {\n    avatar: null,\n    name: '',\n    dialogue: '',\n    type: 1\n  }\n\n  let inputUrl = Lab.ui.createImageAndPreview()\n  inputUrl.addEventListener('click', () => imgSelect.show())\n\n  const doImg = async base64 => {\n    if (base64 && base64.match('image/')) {\n      mHuman.avatar = base64\n      // console.log(base64.match('image/gif'))\n      if (isSmartCrop.getValue()) {\n        if (base64.match('image/gif')) {\n          base64 = await doGifCrop(base64)\n        } else {\n          base64 = await doImageOneCrop(base64)\n        }\n        inputUrl.setValue([base64])\n      } else {\n        inputUrl.setValue([base64])\n      }\n    }\n  }\n  let imgSelect = Lab.ui.createImageSelectModel(doImg)\n  // let imgSelect = createImageSelect(doImg);\n  container.add(imgSelect)\n  container.add(inputUrl)\n  container.add(Lab.ui.createDivider())\n\n  // smartCrop\n  let isSmartCrop = Lab.ui.createToggle({\n    name: 'æ˜¯å¦æ™ºèƒ½è£åˆ‡',\n    label: 'æ˜¯å¦æ™ºèƒ½è£åˆ‡',\n    checked: true\n  })\n  container.add(isSmartCrop)\n  container.add(Lab.ui.createDivider())\n\n  // å•å›¾\n  // let isSingleImage = Lab.ui.createToggle({\n  //     name: 'æ˜¯å¦å•å›¾',\n  //     label: 'æ˜¯å¦å•å›¾',\n  //     checked:false\n  // });\n  let radio = Lab.ui.createRadio('ç±»åž‹', [\n    {\n      name: 'oneImage',\n      label: 'å•å›¾'\n    },\n    {\n      name: 'left',\n      label: 'å·¦ä¾§å¯¹ç™½',\n      checked: true\n    },\n    {\n      name: 'right',\n      label: 'å³ä¾§å¯¹ç™½'\n    },\n    { name: 'talkClound', label: 'ç¾¤èŠ' }\n  ])\n  container.add(radio)\n  // $(radio).checkbox()\n  container.add(Lab.ui.createDivider())\n\n  let inputName = Lab.ui.createInput('text', 'æ˜µç§°')\n  container.add(inputName)\n  container.add(Lab.ui.createDivider())\n\n  let inputDialogue = Lab.ui.createTextareaInput('å¯¹ç™½')\n\n  container.add(inputDialogue)\n  container.add(Lab.ui.createDivider())\n\n  // let isRight = Lab.ui.createToggle({\n  //     name: 'å³å¯¹é½',\n  //     label: 'å³å¯¹é½'\n  // }, vs => {\n  //     mHuman.type = vs[0] ? 2 : 1;\n  // });\n  // container.add(isRight);\n  // container.add(Lab.ui.createDivider());\n\n  let btn = Lab.ui.createButton('ç”Ÿæˆ', async () => {\n    console.log(radio.getValue())\n    let type = radio.getValue()\n    if (type === 'left' || type === 'right') {\n      mHuman.avatar = inputUrl.getValue()\n      mHuman.name = inputName.getValue()\n      mHuman.dialogue = inputDialogue.getValue()\n      mHuman.type = type === 'right' ? 2 : 1\n      // console.log(mHuman)\n      updateMetaHuman(mHuman)\n      await createBaseHtml(\n        mHuman.avatar,\n        mHuman.type,\n        mHuman.name,\n        mHuman.dialogue\n      )\n      num.innerText = Object.keys(metaHuman).length\n    } else if (type === 'oneImage') {\n      let img = inputUrl.getValue()\n      let title = inputName.getValue()\n      let text = inputDialogue.getValue()\n      let data = {\n        img,\n        title,\n        text\n      }\n      await createBaseHtml(img, 0, title, text)\n      // console.log(data);\n    } else if (type === 'talkClound') {\n      let img = inputUrl.getValue()\n      let title = inputName.getValue()\n      let text = inputDialogue.getValue()\n      await createBaseHtml(img, 3, title, text)\n      console.log('talkClound', text)\n    }\n  })\n  container.add(btn)\n\n  // æ‰©å……æ–¹æ³•\n  container.update = async obj => {\n    if (obj) {\n        console.log(obj);\n      if (obj.name) inputName.setValue([obj.name])\n      if (obj.avatar) {\n        await doImg(obj.avatar)\n        // inputUrl.setValue([obj.avatar]);\n      }\n      if (obj.dialogue) inputDialogue.setValue([obj.dialogue])\n    }\n  }\n  return container\n}\n\n// ç»“æžœæŽ§åˆ¶\nfunction createResultBtns () {\n  let container = Lab.ui.createGroup()\n  let title = Lab.ui.createHeader(2, 'è¾“å‡º')\n  container.add(title)\n  let copyBtn = Lab.ui.createButton(\n    'æ‹·è´',\n    e => {\n      // console.log(htmlDiv)\n      Lab.clipboard.write(rightDiv.innerHTML, 'html')\n    },\n    false\n  )\n  container.add(copyBtn)\n  let clearBtn = Lab.ui.createButton(\n    'æ¸…ç©º',\n    e => {\n      // console.log(htmlDiv)\n      rightDiv.innerHTML = ''\n    },\n    false\n  )\n  container.add(clearBtn)\n  return container\n}\n\nasync function doGifCrop (base64) {\n  //window.im = base64;\n  let g = new Lab.GIF()\n  let { frames, fps } = await g.parseGIF(base64)\n  for (let i = 0; i < frames.length; i++) {\n    let frame = await Lab.Image.smartCrop(frames[i], 80, 80)\n    g.add(frame, fps)\n  }\n  let url = await g.render()\n  return url\n}\n\nasync function doImageOneCrop (base64) {\n  let im = await Lab.Image.createImage(base64)\n  let canvas = await Lab.Image.smartCrop(im, 80, 80)\n  return canvas.toDataURL()\n}\n\nfunction createImageSelect (callback) {\n  let pannel = Lab.ui.createModel('é€‰æ‹©å›¾ç‰‡')\n  // console.log(type)\n  let imgBase64\n  let pasteBtn = Lab.ui.createButton(\n    'ä»Žå‰ªåˆ‡æ¿å¤åˆ¶å›¾ç‰‡',\n    () => {\n      let im = Lab.clipboard.read('img')\n      if (im) {\n        imgBase64 = im.toDataURL()\n        pannel.hide()\n        if (callback) callback(imgBase64)\n      }\n    },\n    false\n  )\n  pannel.add(pasteBtn)\n\n  let pasteURLBtn = Lab.ui.createButton(\n    'ä»Žå‰ªåˆ‡æ¿å¤åˆ¶å›¾ç‰‡é“¾æŽ¥',\n    async () => {\n      let url = Lab.clipboard.read('text')\n      if (url) {\n        let im = await Lab.Image.getNativeImageFromWebview2(url)\n        if (im) {\n          imgBase64 = im\n          pannel.hide()\n          if (callback) callback(imgBase64)\n        }\n      }\n    },\n    false\n  )\n  pannel.add(pasteURLBtn)\n\n  let readFileBtn = Lab.ui.createButton(\n    'ä»Žæœ¬åœ°',\n    async () => {\n      let filePaths = Lab.ui.getFilePath(1, 'ä»Žæœ¬åœ°')\n      if (filePaths && filePaths[0]) {\n        let im = await Lab.Image.getNativeImageFromWebview2(filePaths[0])\n        if (im) {\n          imgBase64 = im\n          pannel.hide()\n          if (callback) callback(imgBase64)\n        }\n      }\n    },\n    false\n  )\n  pannel.add(readFileBtn)\n  return pannel\n}\n\nfunction createOneImageLayout (type = 0) {\n  let pannel = Lab.ui.createModel('ç”Ÿæˆå•å›¾')\n  // console.log(type)\n  let pasteBtn = Lab.ui.createButton(\n    'ä»Žå‰ªåˆ‡æ¿å¤åˆ¶å›¾ç‰‡',\n    () => {\n      let im = Lab.clipboard.read('img')\n      if (im) {\n        im = im.toDataURL()\n        createBaseHtml(im, type)\n        pannel.hide()\n        pannel.remove()\n      }\n    },\n    false\n  )\n  pannel.add(pasteBtn)\n\n  let pasteURLBtn = Lab.ui.createButton(\n    'ä»Žå‰ªåˆ‡æ¿å¤åˆ¶å›¾ç‰‡é“¾æŽ¥',\n    async () => {\n      let url = Lab.clipboard.read('text')\n      if (url) {\n        let im = await Lab.Image.getNativeImageFromWebview2(url)\n        if (im) {\n          createBaseHtml(im, type)\n          pannel.hide()\n          pannel.remove()\n        }\n      }\n    },\n    false\n  )\n  pannel.add(pasteURLBtn)\n\n  let readFileBtn = Lab.ui.createButton(\n    'ä»Žæœ¬åœ°',\n    async () => {\n      let filePaths = Lab.ui.getFilePath(1, 'ä»Žæœ¬åœ°')\n      //    console.log(filePaths)\n      if (filePaths && filePaths[0]) {\n        let im = await Lab.Image.getNativeImageFromWebview2(filePaths[0])\n        if (im) {\n          createBaseHtml(im, type)\n          pannel.hide()\n          pannel.remove()\n        }\n      }\n    },\n    false\n  )\n  pannel.add(readFileBtn)\n\n  Lab.ui.add(pannel)\n  pannel.show()\n}\n\nasync function createBaseHtml (im, type, name = 'æ˜µç§°', dialogue = 'å¯¹ç™½') {\n  let html\n  if (im) {\n    if (type == 0) {\n      html = await oneImageLayout(name, im, dialogue)\n    } else if (type == 1) {\n      html = oneImageLayout2(name, im, dialogue)\n    } else if (type == 2) {\n      html = oneImageLayout2(name, im, dialogue, false)\n    }\n  }\n  if (type == 3) {\n    dialogue = dialogue.split('\\n').filter(t => t)\n    html = talkMore(im, dialogue)\n  }\n\n  return createCardByHtml(html)\n}\n\nasync function getImgBase64 (imgurl) {\n  if (!imgurl) return imgurl\n  if (imgurl && imgurl.match('data:image')) return imgurl\n  // èŽ·å¾—å›¾ç‰‡çš„base64\n  let base64 = await db.get(imgurl)\n  if (!base64) {\n    base64 = await Lab.Image.getNativeImageFromWebview2(imgurl)\n    db.set(imgurl, base64)\n  }\n  return base64\n}\n",
  "code_length": 397,
  "size": [
    722,
    771
  ],
  "extname": "designlabplugin",
  "version": "0.10",
  "package_version": "0.1.2",
  "package_id": "8255f6cf550e81a6c7f3ad3ca18c92229fab703c",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.0.20",
    "@ffprobe-installer/ffprobe": "^1.1.0",
    "@fortawesome/fontawesome-free": "^5.15.3",
    "@hapi/hapi": "^20.1.2",
    "@kilokilo/three-bmfont-text": "^3.1.0",
    "@mediapipe/camera_utils": "^0.3.1632432234",
    "@mediapipe/drawing_utils": "^0.3.1620248257",
    "@mediapipe/holistic": "^0.5.1635989137",
    "@node-rs/jieba": "^1.3.1",
    "@paddlejs-models/humanseg": "0.0.5",
    "@pixiv/three-vrm": "^0.6.7",
    "@tensorflow-models/body-pix": "^2.1.0",
    "@tensorflow-models/deeplab": "^0.2.1",
    "@tensorflow-models/face-landmarks-detection": "0.0.1",
    "@tensorflow-models/knn-classifier": "^1.2.2",
    "@tensorflow-models/mobilenet": "^2.1.0",
    "@tensorflow-models/posenet": "^2.2.2",
    "@tensorflow/tfjs": "^3.3.0",
    "@tensorflow/tfjs-backend-wasm": "^3.3.0",
    "about-window": "^1.14.0",
    "animejs": "^3.2.1",
    "babylonjs": "^4.2.0",
    "babylonjs-gui": "^4.2.0",
    "babylonjs-loaders": "^4.2.0",
    "color": "^3.1.3",
    "dat.gui": "^0.7.7",
    "debounce": "^1.2.1",
    "electron-json-storage": "^4.4.0",
    "electron-squirrel-startup": "^1.0.0",
    "emoji-picker-element": "^1.6.0",
    "emoji-regex": "^9.2.2",
    "espree": "^7.3.1",
    "exceljs": "^4.2.1",
    "face-api.js": "^0.22.2",
    "fluent-ffmpeg": "^2.1.2",
    "fomantic-ui": "^2.8.7",
    "gif.js": "^0.2.0",
    "gifuct-js": "^2.1.1",
    "horajs": "^0.1.3",
    "idb-kv-store": "^4.5.0",
    "internal-ip": "^6.2.0",
    "jimp": "^0.16.1",
    "kalidokit": "^1.0.5",
    "lowdb": "^1.0.0",
    "make-cert": "^1.2.0",
    "marked": "^1.2.9",
    "md5": "^2.3.0",
    "mime-types": "^2.1.34",
    "mkcert": "^1.4.0",
    "ml": "^6.0.0",
    "natural": "^5.0.3",
    "ngraph.path": "^1.3.1",
    "nouislider": "^14.7.0",
    "object-hash": "^2.1.1",
    "open-simplex-noise": "^2.5.0",
    "opencvjs-dist": "^4.4.0",
    "osc-js": "^2.1.2",
    "pdfjs-dist": "^2.6.347",
    "peer": "^0.6.1",
    "peerjs": "^1.3.2",
    "pixelit": "https://github.com/giventofly/pixelit.git",
    "qrcode": "^1.5.0",
    "recordrtc": "^5.6.2",
    "regl": "^2.1.0",
    "smartcrop": "^2.0.3",
    "socket.io": "^4.0.0",
    "socket.io-client": "^4.0.0",
    "three": "^0.134.0",
    "timeago.js": "^4.0.2",
    "unsplash-js": "^7.0.12",
    "wordcloud": "^1.2.2",
    "yoga-layout-wasm": "^1.9.3-alpha.7",
    "zdog": "^1.1.2"
  },
  "author": "shadow",
  "create_time": 1643083348938
}