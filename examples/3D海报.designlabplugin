{
  "id": "42703739c2d2719530cdd6bb1146f2794d44b70d",
  "poster": "data:image/png;base64,",
  "title": "3D海报",
  "knowledge": {
    "course": "- ",
    "readme": "3D海报",
    "author": "shadow",
    "version": "0.4"
  },
  "code": "var td = new Lab.TD([\n  'OrbitControls',\n  'EffectComposer',\n  'stats',\n  'GLTFLoader',\n  'FontLoader',\n  'TextGeometry',\n  'TransformControls'\n])\n\n//Hello AI world!\nfunction gui() {\n  td.load.then(() => {\n    let div = Lab.ui.createGroup()\n    div.id = 'kinetic-text'\n    Lab.ui.add(div)\n\n    const kineticText = new KineticText('#kinetic-text', false)\n    kineticText.init()\n    window.kineticText = kineticText\n  })\n}\nwindow.colors = ['#FF69B4', '#786eff', '#FF00FF', '#F8F8FF', '#B0C4DE', '#00BFFF', '#AFEEEE', '#00FFFF', '#00FA9A', '#7FFF00', '#ADFF2F', '#FFFF00', '#FFD700', '#FFE4B5', '#FFDAB9', '#FFA07A', '#FF4500', '#F5F5F5'];\n\nwindow.poster = async function (title = 'MiX REALITY - 2022') {\n  let texts = [];\n  kineticText.params.headTitleColor = \"#786eff\"\n  kineticText.params.headTitle = ''\n  kineticText.params.fps = 5\n  kineticText.params.duration = 1000\n  // let title = 'Mix REALITY - META';\n  kineticText.helper.material.opacity = 0\n  await kineticText.createKineticText(title)\n\n  kineticText.mesh.scale.set(0.5, 0.5, 0.5)\n  let tc = kineticText.mesh.clone()\n  tc.scale.set(3, 3, 3)\n  kineticText.scene.add(tc)\n\n  tc = kineticText.mesh.clone()\n  tc.scale.set(1.1, 1.1, 1.1)\n  tc.position.set(10, 20, 13)\n  kineticText.scene.add(tc)\n\n  tc = kineticText.mesh.clone()\n  tc.scale.set(1.1, 1.1, 1.1)\n  tc.position.set(-20, -8, 15)\n  kineticText.scene.add(tc)\n  let d = new Date()\n  let stamp = await kineticText.createName('design-ai-lab : ' + (d.getFullYear() + '/' + (d.getMonth() + 1) + '/' + d.getDate() + ' ' + d.getTime()), [-5.3, 9.5, 22, 0.4], 0.4);\n  let end = await kineticText.createName('def create(): ... ', [-6, -12, 20, 0.4], 0.4);\n  texts.push(stamp)\n  texts.push(end)\n\n  let obj = {\n    '# - - -': [-6, 9, 20, 0.5],\n    'XAcademy TEA-Community Mixlab': [-6, 9.8, 20, 0.6],\n    '2022/01/09 13:30 - 17:00': [-6, -8, 20, 0.4],\n    '2022/01/16 13:00 - 19:00': [-6, -9, 20, 0.4],\n    '|||': [6, -12, 20, 0.5]\n  }\n\n  obj[title] = [-6, -7, 20, 1]\n\n  for (const key in obj) {\n    obj[key] = await kineticText.createName(key, obj[key], obj[key][3])\n    texts.push(obj[key])\n  }\n  kineticText.camera.position.z = 37\n\n  const createNameForM = (n, color = 'white') => {\n    let c = Lab.ui.createTextCanvas2(n, { fontSize: 44, color, fontFamily: 'fantasy', fontWeight: 1000 })\n    let geometry = new THREE.PlaneGeometry(0.7 * c.width / c.height, 0.7);\n    let texture = THREE.ImageUtils.loadTexture(c.toDataURL());\n    let material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });\n    let plane = new THREE.Mesh(geometry, material);\n    plane.position.set(-6 + 0.5 * 0.7 * c.width / c.height, -10.5, 20)\n    kineticText.scene.add(plane);\n    return plane\n  }\n\n\n  let name = createNameForM('shadow - VIP通行证')\n  texts.push(name)\n\n  var changeName = async (n, color) => {\n    name.removeFromParent()\n    name = createNameForM(n, color)\n    window.downloadName = n;\n    texts[texts.length - 1] = name;\n    let cs = new Array(1).fill(color);\n    for (let index = 0; index < texts.length; index++) {\n      cs.push(Lab.base.shuffle(window.colors)[0])\n    };\n\n    Array.from(texts, t => {\n      if (t) {\n        let c = Lab.base.shuffle(cs)[0];\n        if (c) t.material.color.set(c);\n      }\n    })\n  }\n  // window.texts = texts\n  return changeName\n}\n\nwindow.posterExportGIF = async () => {\n  let n = await poster()\n  n('野性狮子 VIP通行证', Lab.base.shuffle(colors)[0])\n  kineticText.params.fps = 5\n  kineticText.params.duration = 1000\n  kineticText.createGif()\n}\n\nwindow.posterExportMP4 = async () => {\n  let n = await poster()\n  n('野性狮子 VIP通行证', Lab.base.shuffle(colors)[0])\n  kineticText.params.fps = 12\n  kineticText.params.duration = 15000\n  kineticText.createVideo()\n}\n\n\nwindow.poster2 = async function (title = '- HAPPY NEW YEAR -') {\n  kineticText.helper.material.opacity = 0\n  await kineticText.createKineticText(title)\n  kineticText.mesh.scale.set(0.5, 0.5, 0.5)\n  let tc = kineticText.mesh.clone()\n  tc.scale.set(3, 3, 3)\n  kineticText.scene.add(tc)\n\n  tc = kineticText.mesh.clone()\n  tc.scale.set(1.1, 1.1, 1.1)\n  tc.position.set(10, 20, 13)\n  kineticText.scene.add(tc)\n\n  tc = kineticText.mesh.clone()\n  tc.scale.set(1.1, 1.1, 1.1)\n  tc.position.set(-20, -8, 15)\n  kineticText.scene.add(tc)\n\n  let obj = {\n    '# - - -': [-5.5, 9, 20, 0.5],\n    'Mixlab - shadow :': [-6, 10, 20, 0.5],\n    'ML00 - ML1000 - ML1800': [-6, -9, 20, 0.4],\n    'ibrand MixTime AI-lab': [-6, -10, 20, 0.4],\n    '|||': [6, -12, 20, 0.5]\n  }\n\n  obj[title] = [-6, -7, 20, 1]\n\n  for (const key in obj) {\n    obj[key] = await kineticText.createName(key, obj[key], obj[key][3])\n  }\n  kineticText.camera.position.z = 37\n  let name = await kineticText.createName('@all', [-6, -8, 20, 0.5], 0.5)\n  var changeName = async n => {\n    name.removeFromParent()\n    name = await kineticText.createName(n, [-6, -8, 20, 0.5], 0.5)\n  }\n  kineticText.params.headTitle = ''\n  kineticText.params.fps = 5\n  kineticText.params.duration = 1000\n  return changeName\n}\n\nvar createGeometry = require('@kilokilo/three-bmfont-text')\nvar MSDFShader = require('@kilokilo/three-bmfont-text/shaders/msdf')\nvar parseBmfontXml = require('parse-bmfont-xml')\n\nvar font = parseBmfontXml(`<font>\n    <info face=\"OpenSans-SemiBold\" size=\"42\" bold=\"0\" italic=\"0\" charset=\"\" unicode=\"1\" stretchH=\"100\" smooth=\"1\" aa=\"1\" padding=\"0,0,0,0\" spacing=\"0,0\" />\n    <common lineHeight=\"45\" base=\"34\" scaleW=\"2048\" scaleH=\"2048\" pages=\"1\" packed=\"0\" alphaChnl=\"0\" redChnl=\"0\" greenChnl=\"0\" blueChnl=\"0\" />\n    <pages>\n      <page id=\"0\" file=\"OpenSans-SemiBold.png\" />\n    </pages>\n    <distanceField fieldType=\"msdf\" distanceRange=\"4\" />\n    <chars count=\"95\">\n      <char id=\"87\" index=\"58\" char=\"W\" width=\"43\" height=\"34\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"40\" chnl=\"15\" x=\"0\" y=\"0\" page=\"0\" />\n      <char id=\"64\" index=\"35\" char=\"@\" width=\"37\" height=\"38\" xoffset=\"0\" yoffset=\"4\" xadvance=\"38\" chnl=\"15\" x=\"44\" y=\"0\" page=\"0\" />\n      <char id=\"81\" index=\"52\" char=\"Q\" width=\"32\" height=\"42\" xoffset=\"0\" yoffset=\"4\" xadvance=\"33\" chnl=\"15\" x=\"0\" y=\"35\" page=\"0\" />\n      <char id=\"37\" index=\"8\" char=\"%\" width=\"37\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"36\" chnl=\"15\" x=\"82\" y=\"0\" page=\"0\" />\n      <char id=\"77\" index=\"48\" char=\"M\" width=\"35\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"39\" chnl=\"15\" x=\"120\" y=\"0\" page=\"0\" />\n      <char id=\"38\" index=\"9\" char=\"&amp;\" width=\"33\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"31\" chnl=\"15\" x=\"156\" y=\"0\" page=\"0\" />\n      <char id=\"79\" index=\"50\" char=\"O\" width=\"32\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"33\" chnl=\"15\" x=\"120\" y=\"35\" page=\"0\" />\n      <char id=\"65\" index=\"36\" char=\"A\" width=\"32\" height=\"34\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"28\" chnl=\"15\" x=\"82\" y=\"36\" page=\"0\" />\n      <char id=\"88\" index=\"59\" char=\"X\" width=\"30\" height=\"34\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"26\" chnl=\"15\" x=\"33\" y=\"39\" page=\"0\" />\n      <char id=\"86\" index=\"57\" char=\"V\" width=\"30\" height=\"34\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"26\" chnl=\"15\" x=\"190\" y=\"0\" page=\"0\" />\n      <char id=\"71\" index=\"42\" char=\"G\" width=\"29\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"30\" chnl=\"15\" x=\"221\" y=\"0\" page=\"0\" />\n      <char id=\"109\" index=\"80\" char=\"m\" width=\"37\" height=\"27\" xoffset=\"1\" yoffset=\"11\" xadvance=\"40\" chnl=\"15\" x=\"251\" y=\"0\" page=\"0\" />\n      <char id=\"121\" index=\"92\" char=\"y\" width=\"27\" height=\"37\" xoffset=\"-2\" yoffset=\"11\" xadvance=\"23\" chnl=\"15\" x=\"190\" y=\"35\" page=\"0\" />\n      <char id=\"119\" index=\"90\" char=\"w\" width=\"37\" height=\"27\" xoffset=\"-2\" yoffset=\"11\" xadvance=\"34\" chnl=\"15\" x=\"64\" y=\"71\" page=\"0\" />\n      <char id=\"35\" index=\"6\" char=\"#\" width=\"29\" height=\"34\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"27\" chnl=\"15\" x=\"33\" y=\"74\" page=\"0\" />\n      <char id=\"89\" index=\"60\" char=\"Y\" width=\"29\" height=\"34\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"25\" chnl=\"15\" x=\"0\" y=\"78\" page=\"0\" />\n      <char id=\"78\" index=\"49\" char=\"N\" width=\"29\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"33\" chnl=\"15\" x=\"153\" y=\"36\" page=\"0\" />\n      <char id=\"103\" index=\"74\" char=\"g\" width=\"26\" height=\"37\" xoffset=\"-2\" yoffset=\"11\" xadvance=\"23\" chnl=\"15\" x=\"102\" y=\"71\" page=\"0\" />\n      <char id=\"68\" index=\"39\" char=\"D\" width=\"28\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"31\" chnl=\"15\" x=\"63\" y=\"99\" page=\"0\" />\n      <char id=\"85\" index=\"56\" char=\"U\" width=\"28\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"31\" chnl=\"15\" x=\"30\" y=\"109\" page=\"0\" />\n      <char id=\"72\" index=\"43\" char=\"H\" width=\"28\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"32\" chnl=\"15\" x=\"0\" y=\"113\" page=\"0\" />\n      <char id=\"67\" index=\"38\" char=\"C\" width=\"27\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"27\" chnl=\"15\" x=\"129\" y=\"71\" page=\"0\" />\n      <char id=\"112\" index=\"83\" char=\"p\" width=\"25\" height=\"37\" xoffset=\"1\" yoffset=\"11\" xadvance=\"26\" chnl=\"15\" x=\"157\" y=\"71\" page=\"0\" />\n      <char id=\"113\" index=\"84\" char=\"q\" width=\"25\" height=\"37\" xoffset=\"0\" yoffset=\"11\" xadvance=\"26\" chnl=\"15\" x=\"129\" y=\"107\" page=\"0\" />\n      <char id=\"84\" index=\"55\" char=\"T\" width=\"27\" height=\"34\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"92\" y=\"109\" page=\"0\" />\n      <char id=\"75\" index=\"46\" char=\"K\" width=\"27\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"27\" chnl=\"15\" x=\"59\" y=\"134\" page=\"0\" />\n      <char id=\"36\" index=\"7\" char=\"$\" width=\"24\" height=\"38\" xoffset=\"0\" yoffset=\"2\" xadvance=\"24\" chnl=\"15\" x=\"29\" y=\"144\" page=\"0\" />\n      <char id=\"98\" index=\"69\" char=\"b\" width=\"25\" height=\"36\" xoffset=\"1\" yoffset=\"2\" xadvance=\"26\" chnl=\"15\" x=\"0\" y=\"148\" page=\"0\" />\n      <char id=\"100\" index=\"71\" char=\"d\" width=\"25\" height=\"36\" xoffset=\"0\" yoffset=\"2\" xadvance=\"26\" chnl=\"15\" x=\"87\" y=\"144\" page=\"0\" />\n      <char id=\"82\" index=\"53\" char=\"R\" width=\"26\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"27\" chnl=\"15\" x=\"54\" y=\"169\" page=\"0\" />\n      <char id=\"52\" index=\"23\" char=\"4\" width=\"26\" height=\"34\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"26\" y=\"183\" page=\"0\" />\n      <char id=\"104\" index=\"75\" char=\"h\" width=\"24\" height=\"36\" xoffset=\"1\" yoffset=\"2\" xadvance=\"27\" chnl=\"15\" x=\"0\" y=\"185\" page=\"0\" />\n      <char id=\"107\" index=\"78\" char=\"k\" width=\"24\" height=\"36\" xoffset=\"1\" yoffset=\"2\" xadvance=\"24\" chnl=\"15\" x=\"289\" y=\"0\" page=\"0\" />\n      <char id=\"66\" index=\"37\" char=\"B\" width=\"25\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"28\" chnl=\"15\" x=\"251\" y=\"28\" page=\"0\" />\n      <char id=\"90\" index=\"61\" char=\"Z\" width=\"25\" height=\"34\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"218\" y=\"36\" page=\"0\" />\n      <char id=\"55\" index=\"26\" char=\"7\" width=\"25\" height=\"34\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"314\" y=\"0\" page=\"0\" />\n      <char id=\"51\" index=\"22\" char=\"3\" width=\"24\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"340\" y=\"0\" page=\"0\" />\n      <char id=\"57\" index=\"28\" char=\"9\" width=\"24\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"314\" y=\"35\" page=\"0\" />\n      <char id=\"56\" index=\"27\" char=\"8\" width=\"24\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"277\" y=\"37\" page=\"0\" />\n      <char id=\"54\" index=\"25\" char=\"6\" width=\"24\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"244\" y=\"63\" page=\"0\" />\n      <char id=\"48\" index=\"19\" char=\"0\" width=\"24\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"218\" y=\"71\" page=\"0\" />\n      <char id=\"80\" index=\"51\" char=\"P\" width=\"24\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"26\" chnl=\"15\" x=\"183\" y=\"73\" page=\"0\" />\n      <char id=\"50\" index=\"21\" char=\"2\" width=\"24\" height=\"34\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"365\" y=\"0\" page=\"0\" />\n      <char id=\"83\" index=\"54\" char=\"S\" width=\"23\" height=\"35\" xoffset=\"0\" yoffset=\"4\" xadvance=\"23\" chnl=\"15\" x=\"390\" y=\"0\" page=\"0\" />\n      <char id=\"53\" index=\"24\" char=\"5\" width=\"23\" height=\"34\" xoffset=\"0\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"365\" y=\"35\" page=\"0\" />\n      <char id=\"63\" index=\"34\" char=\"?\" width=\"22\" height=\"35\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"19\" chnl=\"15\" x=\"339\" y=\"36\" page=\"0\" />\n      <char id=\"76\" index=\"47\" char=\"L\" width=\"22\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"23\" chnl=\"15\" x=\"302\" y=\"71\" page=\"0\" />\n      <char id=\"123\" index=\"94\" char=\"{\" width=\"18\" height=\"41\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"16\" chnl=\"15\" x=\"269\" y=\"73\" page=\"0\" />\n      <char id=\"125\" index=\"96\" char=\"}\" width=\"18\" height=\"41\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"16\" chnl=\"15\" x=\"243\" y=\"99\" page=\"0\" />\n      <char id=\"102\" index=\"73\" char=\"f\" width=\"20\" height=\"36\" xoffset=\"-1\" yoffset=\"2\" xadvance=\"15\" chnl=\"15\" x=\"208\" y=\"107\" page=\"0\" />\n      <char id=\"69\" index=\"40\" char=\"E\" width=\"21\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"23\" chnl=\"15\" x=\"183\" y=\"108\" page=\"0\" />\n      <char id=\"70\" index=\"41\" char=\"F\" width=\"21\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"22\" chnl=\"15\" x=\"155\" y=\"109\" page=\"0\" />\n      <char id=\"118\" index=\"89\" char=\"v\" width=\"26\" height=\"27\" xoffset=\"-2\" yoffset=\"11\" xadvance=\"22\" chnl=\"15\" x=\"177\" y=\"143\" page=\"0\" />\n      <char id=\"120\" index=\"91\" char=\"x\" width=\"26\" height=\"27\" xoffset=\"-1\" yoffset=\"11\" xadvance=\"23\" chnl=\"15\" x=\"113\" y=\"145\" page=\"0\" />\n      <char id=\"111\" index=\"82\" char=\"o\" width=\"25\" height=\"28\" xoffset=\"0\" yoffset=\"11\" xadvance=\"26\" chnl=\"15\" x=\"140\" y=\"145\" page=\"0\" />\n      <char id=\"92\" index=\"63\" char=\"\\\\\" width=\"20\" height=\"34\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"16\" chnl=\"15\" x=\"113\" y=\"173\" page=\"0\" />\n      <char id=\"47\" index=\"18\" char=\"/\" width=\"20\" height=\"34\" xoffset=\"-2\" yoffset=\"4\" xadvance=\"16\" chnl=\"15\" x=\"81\" y=\"181\" page=\"0\" />\n      <char id=\"106\" index=\"77\" char=\"j\" width=\"15\" height=\"45\" xoffset=\"-4\" yoffset=\"3\" xadvance=\"12\" chnl=\"15\" x=\"53\" y=\"204\" page=\"0\" />\n      <char id=\"74\" index=\"45\" char=\"J\" width=\"16\" height=\"42\" xoffset=\"-5\" yoffset=\"4\" xadvance=\"13\" chnl=\"15\" x=\"25\" y=\"218\" page=\"0\" />\n      <char id=\"101\" index=\"72\" char=\"e\" width=\"24\" height=\"28\" xoffset=\"0\" yoffset=\"11\" xadvance=\"24\" chnl=\"15\" x=\"0\" y=\"222\" page=\"0\" />\n      <char id=\"110\" index=\"81\" char=\"n\" width=\"24\" height=\"27\" xoffset=\"1\" yoffset=\"11\" xadvance=\"27\" chnl=\"15\" x=\"0\" y=\"251\" page=\"0\" />\n      <char id=\"117\" index=\"88\" char=\"u\" width=\"24\" height=\"27\" xoffset=\"1\" yoffset=\"11\" xadvance=\"27\" chnl=\"15\" x=\"414\" y=\"0\" page=\"0\" />\n      <char id=\"97\" index=\"68\" char=\"a\" width=\"23\" height=\"28\" xoffset=\"0\" yoffset=\"11\" xadvance=\"24\" chnl=\"15\" x=\"439\" y=\"0\" page=\"0\" />\n      <char id=\"116\" index=\"87\" char=\"t\" width=\"19\" height=\"32\" xoffset=\"-1\" yoffset=\"6\" xadvance=\"17\" chnl=\"15\" x=\"414\" y=\"28\" page=\"0\" />\n      <char id=\"60\" index=\"31\" char=\"&lt;\" width=\"24\" height=\"25\" xoffset=\"0\" yoffset=\"8\" xadvance=\"24\" chnl=\"15\" x=\"389\" y=\"36\" page=\"0\" />\n      <char id=\"62\" index=\"33\" char=\">\" width=\"24\" height=\"25\" xoffset=\"0\" yoffset=\"8\" xadvance=\"24\" chnl=\"15\" x=\"463\" y=\"0\" page=\"0\" />\n      <char id=\"115\" index=\"86\" char=\"s\" width=\"21\" height=\"28\" xoffset=\"0\" yoffset=\"11\" xadvance=\"20\" chnl=\"15\" x=\"488\" y=\"0\" page=\"0\" />\n      <char id=\"99\" index=\"70\" char=\"c\" width=\"21\" height=\"28\" xoffset=\"0\" yoffset=\"11\" xadvance=\"21\" chnl=\"15\" x=\"463\" y=\"26\" page=\"0\" />\n      <char id=\"49\" index=\"20\" char=\"1\" width=\"17\" height=\"34\" xoffset=\"1\" yoffset=\"4\" xadvance=\"24\" chnl=\"15\" x=\"434\" y=\"29\" page=\"0\" />\n      <char id=\"43\" index=\"14\" char=\"+\" width=\"24\" height=\"24\" xoffset=\"0\" yoffset=\"9\" xadvance=\"24\" chnl=\"15\" x=\"389\" y=\"62\" page=\"0\" />\n      <char id=\"94\" index=\"65\" char=\"^\" width=\"25\" height=\"23\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"23\" chnl=\"15\" x=\"362\" y=\"70\" page=\"0\" />\n      <char id=\"41\" index=\"12\" char=\")\" width=\"14\" height=\"41\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"13\" chnl=\"15\" x=\"414\" y=\"61\" page=\"0\" />\n      <char id=\"40\" index=\"11\" char=\"(\" width=\"14\" height=\"41\" xoffset=\"0\" yoffset=\"4\" xadvance=\"13\" chnl=\"15\" x=\"388\" y=\"87\" page=\"0\" />\n      <char id=\"93\" index=\"64\" char=\"]\" width=\"14\" height=\"41\" xoffset=\"-1\" yoffset=\"4\" xadvance=\"14\" chnl=\"15\" x=\"325\" y=\"72\" page=\"0\" />\n      <char id=\"91\" index=\"62\" char=\"[\" width=\"14\" height=\"41\" xoffset=\"1\" yoffset=\"4\" xadvance=\"14\" chnl=\"15\" x=\"340\" y=\"72\" page=\"0\" />\n      <char id=\"122\" index=\"93\" char=\"z\" width=\"21\" height=\"27\" xoffset=\"-1\" yoffset=\"11\" xadvance=\"20\" chnl=\"15\" x=\"355\" y=\"94\" page=\"0\" />\n      <char id=\"42\" index=\"13\" char=\"*\" width=\"24\" height=\"23\" xoffset=\"0\" yoffset=\"2\" xadvance=\"23\" chnl=\"15\" x=\"288\" y=\"106\" page=\"0\" />\n      <char id=\"114\" index=\"85\" char=\"r\" width=\"18\" height=\"27\" xoffset=\"1\" yoffset=\"11\" xadvance=\"18\" chnl=\"15\" x=\"262\" y=\"115\" page=\"0\" />\n      <char id=\"61\" index=\"32\" char=\"=\" width=\"24\" height=\"16\" xoffset=\"0\" yoffset=\"13\" xadvance=\"24\" chnl=\"15\" x=\"229\" y=\"141\" page=\"0\" />\n      <char id=\"124\" index=\"95\" char=\"|\" width=\"8\" height=\"46\" xoffset=\"8\" yoffset=\"2\" xadvance=\"23\" chnl=\"15\" x=\"166\" y=\"144\" page=\"0\" />\n      <char id=\"59\" index=\"30\" char=\";\" width=\"11\" height=\"33\" xoffset=\"-1\" yoffset=\"11\" xadvance=\"12\" chnl=\"15\" x=\"302\" y=\"37\" page=\"0\" />\n      <char id=\"33\" index=\"4\" char=\"!\" width=\"10\" height=\"35\" xoffset=\"1\" yoffset=\"4\" xadvance=\"12\" chnl=\"15\" x=\"102\" y=\"181\" page=\"0\" />\n      <char id=\"108\" index=\"79\" char=\"l\" width=\"9\" height=\"36\" xoffset=\"1\" yoffset=\"2\" xadvance=\"12\" chnl=\"15\" x=\"42\" y=\"218\" page=\"0\" />\n      <char id=\"105\" index=\"76\" char=\"i\" width=\"9\" height=\"35\" xoffset=\"1\" yoffset=\"3\" xadvance=\"12\" chnl=\"15\" x=\"452\" y=\"29\" page=\"0\" />\n      <char id=\"73\" index=\"918\" char=\"I\" width=\"9\" height=\"34\" xoffset=\"2\" yoffset=\"4\" xadvance=\"13\" chnl=\"15\" x=\"403\" y=\"87\" page=\"0\" />\n      <char id=\"58\" index=\"29\" char=\":\" width=\"10\" height=\"28\" xoffset=\"1\" yoffset=\"11\" xadvance=\"12\" chnl=\"15\" x=\"377\" y=\"94\" page=\"0\" />\n      <char id=\"34\" index=\"5\" char=\"&quot;\" width=\"17\" height=\"15\" xoffset=\"1\" yoffset=\"4\" xadvance=\"18\" chnl=\"15\" x=\"64\" y=\"39\" page=\"0\" />\n      <char id=\"126\" index=\"97\" char=\"~\" width=\"24\" height=\"10\" xoffset=\"0\" yoffset=\"16\" xadvance=\"24\" chnl=\"15\" x=\"204\" y=\"144\" page=\"0\" />\n      <char id=\"96\" index=\"67\" char=\"\\`\" width=\"14\" height=\"11\" xoffset=\"5\" yoffset=\"2\" xadvance=\"25\" chnl=\"15\" x=\"64\" y=\"55\" page=\"0\"/>\n      <char id=\"95\" index=\"66\" char=\"_\" width=\"22\" height=\"7\" xoffset=\"-2\" yoffset=\"38\" xadvance=\"18\" chnl=\"15\" x=\"429\" y=\"64\" page=\"0\" />\n      <char id=\"44\" index=\"15\" char=\",\" width=\"11\" height=\"14\" xoffset=\"-1\" yoffset=\"29\" xadvance=\"11\" chnl=\"15\" x=\"69\" y=\"204\" page=\"0\" />\n      <char id=\"39\" index=\"10\" char=\"'\" width=\"9\" height=\"15\" xoffset=\"1\" yoffset=\"4\" xadvance=\"10\" chnl=\"15\" x=\"208\" y=\"73\" page=\"0\" />\n      <char id=\"45\" index=\"16\" char=\"-\" width=\"15\" height=\"8\" xoffset=\"-1\" yoffset=\"21\" xadvance=\"14\" chnl=\"15\" x=\"81\" y=\"216\" page=\"0\" />\n      <char id=\"46\" index=\"17\" char=\".\" width=\"10\" height=\"10\" xoffset=\"1\" yoffset=\"28\" xadvance=\"12\" chnl=\"15\" x=\"313\" y=\"106\" page=\"0\" />\n      <char id=\"32\" index=\"3\" char=\" \" width=\"0\" height=\"0\" xoffset=\"-2\" yoffset=\"34\" xadvance=\"11\" chnl=\"15\" x=\"153\" y=\"35\" page=\"0\" />\n    </chars>\n    <kernings count=\"0\" />\n  </font>`)\n\n// import ky from \"https://cdn.skypack.dev/kyouka@1.2.2\";\n\nvar calcAspect = () => window.innerWidth / window.innerHeight\n\nvar fontAtlas = '../assets/flowfont.png'\n\nvar kineticTextTorusKnotVertexShader = `\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main(){\n    vec4 modelPosition=modelMatrix*vec4(position,1.);\n    vec4 viewPosition=viewMatrix*modelPosition;\n    vec4 projectedPosition=projectionMatrix*viewPosition;\n    gl_Position=projectedPosition;\n    \n    vUv=uv;\n    vPosition=position;\n}\n`\n\nvar kineticTextTorusKnotFragmentShader = `\nuniform sampler2D uTexture;\nuniform float uTime;\nuniform float uVelocity;\nuniform float uShadow;\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvec3 invert(vec3 n){\n    return 1.-n;\n}\n\nvoid main(){\n    vec2 repeat=vec2(12.,3.);\n    vec2 repeatedUv=vUv*repeat;\n    vec2 displacement=vec2(uTime*uVelocity,0.);\n    vec2 uv=fract(repeatedUv+displacement);\n    vec3 texture=texture2D(uTexture,uv).rgb;\n    // texture*=vec3(uv.x,uv.y,1.);\n    float shadow=clamp(vPosition.z/uShadow,0.,1.);// farther darker (to 0).\n    vec3 color=vec3(texture*shadow);\n    gl_FragColor=vec4(color,1.);\n}\n`\n\nvar kineticTextSphereVertexShader = `\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main(){\n    vec4 modelPosition=modelMatrix*vec4(position,1.);\n    vec4 viewPosition=viewMatrix*modelPosition;\n    vec4 projectedPosition=projectionMatrix*viewPosition;\n    gl_Position=projectedPosition;\n    \n    vUv=uv;\n    vPosition=position;\n}\n`\n\nvar kineticTextSphereFragmentShader = `\nuniform sampler2D uTexture;\nuniform float uTime;\nuniform float uVelocity;\nuniform float uShadow;\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvec3 invert(vec3 n){\n    return 1.-n;\n}\n\nvoid main(){\n    vec2 repeat=vec2(12.,12.);\n    vec2 repeatedUv=vUv*repeat;\n    vec2 displacement=vec2(sin(vUv.y)*5.,uTime*uVelocity);\n    vec2 uv=fract(repeatedUv+displacement);\n    vec3 texture=texture2D(uTexture,uv).rgb;\n    // texture*=vec3(uv.x,uv.y,1.);\n    float shadow=vPosition.z/uShadow;\n    vec3 color=vec3(texture*shadow);\n    gl_FragColor=vec4(color,1.);\n}\n`\n\nvar kineticTextPlaneVertexShader = `\nuniform float uTime;\nuniform float uVelocity;\nuniform float uFrequency;\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying float vWave;\n\nvoid main(){\n    vec3 pos=position;\n    float displacement=sin((pos.x-pos.y)*uFrequency-uTime*uVelocity);\n    pos.z+=displacement;\n    vec4 modelPosition=modelMatrix*vec4(pos,1.);\n    vec4 viewPosition=viewMatrix*modelPosition;\n    vec4 projectedPosition=projectionMatrix*viewPosition;\n    gl_Position=projectedPosition;\n    \n    vUv=uv;\n    vPosition=pos;\n    vWave=pos.z;\n}\n`\n\nvar kineticTextPlaneFragmentShader = `\nuniform sampler2D uTexture;\nuniform float uTime;\nuniform float uVelocity;\nuniform float uShadow;\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying float vWave;\n\nvec3 invert(vec3 n){\n    return 1.-n;\n}\n\n// map函数：将本身的范围转换为另一个范围\n// https://gist.github.com/companje/29408948f1e8be54dd5733a74ca49bb9\n// https://stackoverflow.com/questions/17134839/how-does-the-map-function-in-processing-work\nfloat map(float value,float min1,float max1,float min2,float max2){\n    return min2+(value-min1)*(max2-min2)/(max1-min1);\n}\n\nvoid main(){\n    vec2 repeat=vec2(4.,16.);\n    vec2 repeatedUv=vUv*repeat;\n    vec2 uv=fract(repeatedUv);\n    vec3 texture=texture2D(uTexture,uv).rgb;\n    // texture*=vec3(uv.x,uv.y,1.);\n    float wave=vWave;\n    wave=map(wave,-1.,1.,0.,.1);\n    float shadow=1.-wave;\n    vec3 color=vec3(texture*shadow);\n    gl_FragColor=vec4(color,1.);\n}\n`\n\nvar kineticTextTorusVertexShader = `\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main(){\n    vec4 modelPosition=modelMatrix*vec4(position,1.);\n    vec4 viewPosition=viewMatrix*modelPosition;\n    vec4 projectedPosition=projectionMatrix*viewPosition;\n    gl_Position=projectedPosition;\n    \n    vUv=uv;\n    vPosition=position;\n}\n`\n\nvar kineticTextTorusFragmentShader = `\nuniform sampler2D uTexture;\nuniform float uTime;\nuniform float uVelocity;\nuniform float uShadow;\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvec3 invert(vec3 n){\n    return 1.-n;\n}\n\nvoid main(){\n    vec2 repeat=vec2(6.,6.);\n    vec2 repeatedUv=vUv*repeat;\n    vec2 displacement=vec2(0.,uTime*uVelocity);\n    vec2 uv=fract(repeatedUv+displacement);\n    vec3 texture=texture2D(uTexture,uv).rgb;\n    // texture*=vec3(uv.x,uv.y,1.);\n    float shadow=vPosition.z/uShadow;\n    vec3 color=vec3(texture*shadow);\n    gl_FragColor=vec4(color,1.);\n}\n`\n\nvar kineticTextCylinderVertexShader = `\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main(){\n    vec4 modelPosition=modelMatrix*vec4(position,1.);\n    vec4 viewPosition=viewMatrix*modelPosition;\n    vec4 projectedPosition=projectionMatrix*viewPosition;\n    gl_Position=projectedPosition;\n    \n    vUv=uv;\n    vPosition=position;\n}\n`\n\nvar kineticTextCylinderFragmentShader = `\nuniform sampler2D uTexture;\nuniform float uTime;\nuniform float uVelocity;\nuniform float uShadow;\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvec3 invert(vec3 n){\n    return 1.-n;\n}\n\nvoid main(){\n    vec2 repeat=vec2(12.,12.);\n    vec2 repeatedUv=vUv*repeat;\n    vec2 displacement=vec2(uTime*uVelocity+vUv.y,0.);\n    vec2 uv=fract(repeatedUv+displacement);\n    vec3 texture=texture2D(uTexture,uv).rgb;\n    // texture*=vec3(uv.x,uv.y,1.);\n    float shadow=vPosition.z/uShadow;\n    vec3 color=vec3(texture*shadow);\n    gl_FragColor=vec4(color,1.);\n}\n`\n\nclass Base {\n  constructor(sel, debug = false) {\n    this.debug = debug\n    this.container = document.querySelector(sel)\n    this.perspectiveCameraParams = {\n      fov: 75,\n      near: 0.1,\n      far: 500\n    }\n    this.orthographicCameraParams = {\n      zoom: 2,\n      near: -100,\n      far: 3000\n    }\n    this.cameraPosition = new THREE.Vector3(0, 3, 200)\n    this.lookAtPosition = new THREE.Vector3(0, 0, 0)\n    this.rendererParams = {\n      outputEncoding: THREE.LinearEncoding,\n      config: {\n        alpha: true,\n        antialias: true,\n        preserveDrawingBuffer: true\n      }\n    }\n    this.mousePos = new THREE.Vector2(0, 0)\n  }\n  // 初始化\n  init() {\n    this.createScene()\n    this.createPerspectiveCamera()\n    this.createRenderer()\n    this.createMesh({})\n    this.createLight()\n    this.createOrbitControls()\n    this.addListeners()\n    this.setLoop()\n  }\n  // 创建场景\n  createScene() {\n    const scene = new THREE.Scene()\n    if (this.debug) {\n      scene.add(new THREE.AxesHelper())\n      const stats = Stats()\n      Lab.ui.add(stats.dom)\n      this.stats = stats\n    }\n    // scene.background='gray';\n    this.scene = scene\n  }\n  createHelp() {\n    this.helper = new THREE.GridHelper(2000, 100)\n    this.helper.position.y = 0\n    this.helper.material.opacity = 0.8\n    this.helper.material.transparent = true\n    this.scene.add(this.helper)\n  }\n  createTransformControl() {\n    // let transformControl = new THREE.TransformControls(\n    //   this.camera,\n    //   this.renderer.domElement\n    // )\n    // transformControl.addEventListener('change', this.render)\n    // transformControl.addEventListener('dragging-changed', event => {\n    //   this.controls.enabled = !event.value\n    // })\n    // transformControl.addEventListener('objectChange', function () {\n    //   console.log('objectChange')\n    // })\n    // this.scene.add(transformControl)\n    // this.transformControl = transformControl\n    // const pointer = new THREE.Vector2()\n    // const onUpPosition = new THREE.Vector2()\n    // const onDownPosition = new THREE.Vector2()\n    // this.renderer.domElement.addEventListener('pointerdown', onPointerDown)\n    // this.renderer.domElement.addEventListener('pointerup', onPointerUp)\n    // this.renderer.domElement.addEventListener('pointermove', onPointerMove)\n    // function onPointerDown (event) {\n    //   onDownPosition.x = event.clientX\n    //   onDownPosition.y = event.clientY\n    // }\n    // function onPointerUp (event) {\n    //   onUpPosition.x = event.clientX\n    //   onUpPosition.y = event.clientY\n    //   if (onDownPosition.distanceTo(onUpPosition) === 0)\n    //     transformControl.detach()\n    // }\n    // let that = this\n    // function onPointerMove (event) {\n    //   pointer.x = (event.clientX / that.renderer.domElement.clientWidth) * 2 - 1\n    //   pointer.y =\n    //     -(event.clientY / that.renderer.domElement.clientHeight) * 2 + 1\n    //   const raycaster = new THREE.Raycaster()\n    //   raycaster.setFromCamera(pointer, that.camera)\n    //   // console.log(raycaster.intersectObjects(that.backgroundBox, false))\n    //   if (that.headTitle) {\n    //     const intersects = raycaster.intersectObjects(that.headTitle, false)\n    //     console.log(intersects)\n    //     if (intersects.length > 0) {\n    //       const object = intersects[0].object\n    //       console.log(object)\n    //       if (object !== transformControl.object) {\n    //         transformControl.attach(object)\n    //       }\n    //     }\n    //   }\n    // }\n  }\n  // 创建透视相机\n  createPerspectiveCamera() {\n    const { perspectiveCameraParams, cameraPosition, lookAtPosition } = this\n    const { fov, near, far } = perspectiveCameraParams\n    const aspect = calcAspect()\n    const camera = new THREE.PerspectiveCamera(fov, aspect, near, far)\n    camera.position.copy(cameraPosition)\n    camera.lookAt(lookAtPosition)\n    this.camera = camera\n  }\n  // 创建正交相机\n  createOrthographicCamera() {\n    const { orthographicCameraParams, cameraPosition, lookAtPosition } = this\n    const { left, right, top, bottom, near, far } = orthographicCameraParams\n    const camera = new THREE.OrthographicCamera(\n      left,\n      right,\n      top,\n      bottom,\n      near,\n      far\n    )\n    camera.position.copy(cameraPosition)\n    camera.lookAt(lookAtPosition)\n    this.camera = camera\n  }\n  // 更新正交相机参数\n  updateOrthographicCameraParams() {\n    const { container } = this\n    const { zoom, near, far } = this.orthographicCameraParams\n    const aspect = calcAspect()\n    this.orthographicCameraParams = {\n      left: -zoom * aspect,\n      right: zoom * aspect,\n      top: zoom,\n      bottom: -zoom,\n      near,\n      far,\n      zoom\n    }\n  }\n  // 创建渲染\n  createRenderer(useWebGL1 = false) {\n    const { rendererParams } = this\n    const { outputEncoding, config } = rendererParams\n    const renderer = !useWebGL1\n      ? new THREE.WebGLRenderer(config)\n      : new THREE.WebGL1Renderer(config)\n    renderer.setSize(window.innerWidth, window.innerHeight)\n    renderer.outputEncoding = outputEncoding\n    this.resizeRendererToDisplaySize()\n    this.container?.appendChild(renderer.domElement)\n    this.renderer = renderer\n\n    this.renderer.setClearColor(0x000000, 0)\n    this.renderer.setPixelRatio(window.devicePixelRatio)\n    this.renderer.shadowMap.enabled = true\n\n    this.renderer.domElement.style.position = 'fixed'\n    this.renderer.domElement.style.top = 0\n    this.renderer.domElement.style.left = 0\n  }\n  // 允许投影\n  enableShadow() {\n    this.renderer.shadowMap.enabled = true\n  }\n  // 调整渲染器尺寸\n  resizeRendererToDisplaySize() {\n    const { renderer } = this\n    if (!renderer) {\n      return\n    }\n    const canvas = renderer.domElement\n    const pixelRatio = window.devicePixelRatio\n    const { clientWidth, clientHeight } = canvas\n    const width = (clientWidth * pixelRatio) | 0\n    const height = (clientHeight * pixelRatio) | 0\n    const isResizeNeeded = canvas.width !== width || canvas.height !== height\n    if (isResizeNeeded) {\n      renderer.setSize(width, height, false)\n    }\n    return isResizeNeeded\n  }\n  // 创建网格\n  createMesh(meshObject, container = this.scene) {\n    const {\n      geometry = new THREE.BoxGeometry(1, 1, 1),\n      material = new THREE.MeshStandardMaterial({\n        color: new THREE.Color('#d9dfc8')\n      }),\n      position = new THREE.Vector3(0, 0, 0)\n    } = meshObject\n    const mesh = new THREE.Mesh(geometry, material)\n    mesh.position.copy(position)\n    container.add(mesh)\n    return mesh\n  }\n  // 创建光源\n  createLight() {\n    const dirLight = new THREE.DirectionalLight(new THREE.Color('#ffffff'), 0.5)\n    dirLight.position.set(0, 50, 0)\n    this.scene.add(dirLight)\n    const ambiLight = new THREE.AmbientLight(new THREE.Color('#ffffff'), 0.4)\n    this.scene.add(ambiLight)\n  }\n  // 创建轨道控制\n  createOrbitControls() {\n    const controls = new THREE.OrbitControls(\n      this.camera,\n      this.renderer.domElement\n    )\n    const { lookAtPosition } = this\n    controls.target.copy(lookAtPosition)\n    controls.update()\n    this.controls = controls\n  }\n  // 监听事件\n  addListeners() {\n    this.onResize()\n  }\n  // 监听画面缩放\n  onResize() {\n    window.addEventListener('resize', e => {\n      if (this.camera instanceof THREE.PerspectiveCamera) {\n        const aspect = calcAspect()\n        const camera = this.camera\n        camera.aspect = aspect\n        camera.updateProjectionMatrix()\n      } else if (this.camera instanceof THREE.OrthographicCamera) {\n        this.updateOrthographicCameraParams()\n        const camera = this.camera\n        const {\n          left,\n          right,\n          top,\n          bottom,\n          near,\n          far\n        } = this.orthographicCameraParams\n        camera.left = left\n        camera.right = right\n        camera.top = top\n        camera.bottom = bottom\n        camera.near = near\n        camera.far = far\n        camera.updateProjectionMatrix()\n      }\n\n      this.renderer.setSize(window.innerWidth, window.innerHeight)\n    })\n  }\n  // 动画\n  update() {\n    console.log('animation')\n  }\n  // 渲染\n  setLoop() {\n    this.renderer.setAnimationLoop(() => {\n      this.resizeRendererToDisplaySize()\n      this.update()\n      if (this.controls) {\n        this.controls.update()\n      }\n      if (this.stats) {\n        this.stats.update()\n      }\n      if (this.composer) {\n        this.composer.render()\n      } else {\n        this.renderer.render(this.scene, this.camera)\n      }\n    })\n  }\n  // 创建文本\n  createText(\n    text = '',\n    config,\n    material = new THREE.MeshStandardMaterial({\n      color: '#ffffff'\n    })\n  ) {\n    const geo = new THREE.TextGeometry(text, config)\n    const mesh = new THREE.Mesh(geo, material)\n    return mesh\n  }\n  // 创建音效源\n  createAudioSource() {\n    const listener = new THREE.AudioListener()\n    this.camera.add(listener)\n    const sound = new THREE.Audio(listener)\n    this.sound = sound\n  }\n  // 加载音效\n  loadAudio(url) {\n    const loader = new THREE.AudioLoader()\n    return new Promise(resolve => {\n      loader.load(url, buffer => {\n        this.sound.setBuffer(buffer)\n        resolve(buffer)\n      })\n    })\n  }\n  // 加载模型\n  loadModel(url) {\n    const loader = new THREE.GLTFLoader()\n    return new Promise((resolve, reject) => {\n      loader.load(\n        url,\n        gltf => {\n          const model = gltf.scene\n          resolve(model)\n        },\n        undefined,\n        err => {\n          console.log(err)\n          reject()\n        }\n      )\n    })\n  }\n\n  //\n\n  loadModelObj(url) {\n    const loader = new THREE.OBJLoader()\n    return new Promise((resolve, reject) => {\n      loader.load(\n        url,\n        obj => {\n          resolve(obj)\n        },\n        undefined,\n        err => {\n          console.log(err)\n          reject()\n        }\n      )\n    })\n  }\n\n  // 加载字体\n  loadFont(url) {\n    const loader = new THREE.FontLoader()\n    return new Promise(resolve => {\n      loader.load(url, font => {\n        resolve(font)\n      })\n    })\n  }\n  // 创建点选模型\n  createRaycaster() {\n    this.raycaster = new THREE.Raycaster()\n    this.trackMousePos()\n  }\n  // 追踪鼠标位置\n  trackMousePos() {\n    window.addEventListener('mousemove', e => {\n      this.setMousePos(e)\n    })\n    window.addEventListener('mouseout', () => {\n      this.clearMousePos()\n    })\n    window.addEventListener('mouseleave', () => {\n      this.clearMousePos()\n    })\n    window.addEventListener(\n      'touchstart',\n      e => {\n        this.setMousePos(e.touches[0])\n      },\n      { passive: false }\n    )\n    window.addEventListener('touchmove', e => {\n      this.setMousePos(e.touches[0])\n    })\n    window.addEventListener('touchend', () => {\n      this.clearMousePos()\n    })\n  }\n  // 设置鼠标位置\n  setMousePos(e) {\n    const { x, y } = getNormalizedMousePos(e)\n    this.mousePos.x = x\n    this.mousePos.y = y\n  }\n  // 清空鼠标位置\n  clearMousePos() {\n    this.mousePos.x = -100000\n    this.mousePos.y = -100000\n  }\n  // 获取点击物\n  getInterSects() {\n    this.raycaster.setFromCamera(this.mousePos, this.camera)\n    const intersects = this.raycaster.intersectObjects(\n      this.scene.children,\n      true\n    )\n    return intersects\n  }\n  // 选中点击物时\n  onChooseIntersect(target) {\n    const intersects = this.getInterSects()\n    const intersect = intersects[0]\n    if (!intersect || !intersect.face) {\n      return null\n    }\n    const { object } = intersect\n    return target === object ? intersect : null\n  }\n}\n\nclass KineticText extends Base {\n  constructor(sel, debug) {\n    super(sel, debug)\n    this.cameraPosition = new THREE.Vector3(0, 0, 40)\n    this.clock = new THREE.Clock()\n    this.meshConfig = {\n      torusKnot: {\n        vertexShader: kineticTextTorusKnotVertexShader,\n        fragmentShader: kineticTextTorusKnotFragmentShader,\n        geometry: new THREE.TorusKnotGeometry(9, 3, 768, 3, 4, 3)\n      },\n      sphere: {\n        vertexShader: kineticTextSphereVertexShader,\n        fragmentShader: kineticTextSphereFragmentShader,\n        geometry: new THREE.SphereGeometry(15, 64, 64)\n      },\n      plane: {\n        vertexShader: kineticTextPlaneVertexShader,\n        fragmentShader: kineticTextPlaneFragmentShader,\n        geometry: new THREE.PlaneGeometry(30, 30, 64, 64)\n      },\n      torus: {\n        vertexShader: kineticTextTorusVertexShader,\n        fragmentShader: kineticTextTorusFragmentShader,\n        geometry: new THREE.TorusGeometry(12, 4, 20, 45)\n      },\n      cylinder: {\n        vertexShader: kineticTextCylinderVertexShader,\n        fragmentShader: kineticTextCylinderFragmentShader,\n        geometry: new THREE.CylinderGeometry(12, 12, 21, 64, 64)\n      },\n      box: {\n        vertexShader: kineticTextPlaneVertexShader,\n        fragmentShader: kineticTextPlaneFragmentShader,\n        geometry: (() => {\n          const geometry = new THREE.BoxGeometry(2, 2, 2, 32, 32, 32)\n\n          // create an empty array to  hold targets for the attribute we want to morph\n          // morphing positions and normals is supported\n          geometry.morphAttributes.position = []\n\n          // the original positions of the cube's vertices\n          const positionAttribute = geometry.attributes.position\n\n          // for the first morph target we'll move the cube's vertices onto the surface of a sphere\n          const spherePositions = []\n\n          // for the second morph target, we'll twist the cubes vertices\n          const twistPositions = []\n          const direction = new THREE.Vector3(1, 0, 0)\n          const vertex = new THREE.Vector3()\n\n          for (let i = 0; i < positionAttribute.count; i++) {\n            const x = positionAttribute.getX(i)\n            const y = positionAttribute.getY(i)\n            const z = positionAttribute.getZ(i)\n\n            spherePositions.push(\n              x *\n              Math.sqrt(1 - (y * y) / 2 - (z * z) / 2 + (y * y * z * z) / 3),\n              y *\n              Math.sqrt(1 - (z * z) / 2 - (x * x) / 2 + (z * z * x * x) / 3),\n              z * Math.sqrt(1 - (x * x) / 2 - (y * y) / 2 + (x * x * y * y) / 3)\n            )\n\n            // stretch along the x-axis so we can see the twist better\n            vertex.set(x * 2, y, z)\n\n            vertex\n              .applyAxisAngle(direction, (Math.PI * x) / 2)\n              .toArray(twistPositions, twistPositions.length)\n          }\n\n          // add the spherical positions as the first morph target\n          geometry.morphAttributes.position[0] = new THREE.Float32BufferAttribute(\n            spherePositions,\n            3\n          )\n\n          // add the twisted positions as the second morph target\n          geometry.morphAttributes.position[1] = new THREE.Float32BufferAttribute(\n            twistPositions,\n            3\n          )\n\n          return geometry\n        })()\n      }\n    }\n    this.meshNames = Object.keys(this.meshConfig)\n    this.params = {\n      meshName: 'torusKnot',\n      velocity: 0.5,\n      shadow: 5,\n      color: '#000000',\n      backgroundColor: '#000000',\n      frequency: 0.5,\n      text: 'DESIGN-AI-LAB',\n      headTitle: 'by design-ai-lab',\n      headTitleColor: '#00ff00',\n      isHeadTitles: false,\n      headTitleWireframe: false,\n      headTitlePositionX: -25,\n      headTitlePositionY: -23,\n      headTitlePositionZ: 50,\n      cameraZ: 2.5,\n      fps: 12,\n      duration: 5000,\n      backgroundBoxPositionX: 0,\n      backgroundBoxPositionY: 0,\n      backgroundBoxPositionZ: -10\n    }\n\n    this.headTitles = []\n  }\n  // 初始化\n  async init() {\n    this.createScene()\n    this.createPerspectiveCamera()\n    this.createRenderer(true)\n    // console.log(this.params.text)\n    await this.createKineticText(this.params.text)\n    this.createBackgroundBox()\n    this.createLight()\n    this.createOrbitControls()\n    this.createTransformControl()\n    this.createHelp()\n    this.createDebugPanel()\n    this.addListeners()\n    this.setLoop()\n  }\n  // 创建动态文字\n  async createKineticText(text) {\n    //   console.log(text)\n    await this.createFontText(text)\n    this.createRenderTarget()\n    this.createTextContainer()\n  }\n  // 加载字体文本\n  loadFontText(text) {\n    return new Promise(resolve => {\n      const fontGeo = createGeometry({\n        font,\n        text\n      })\n      const loader = new THREE.TextureLoader()\n      loader.load(fontAtlas, texture => {\n        const fontMat = new THREE.RawShaderMaterial(\n          MSDFShader({\n            map: texture,\n            side: THREE.DoubleSide,\n            transparent: true,\n            negate: false,\n            color: 0xffffff\n          })\n        )\n        resolve({ fontGeo, fontMat })\n      })\n    })\n  }\n  // 创建字体文本\n  async createFontText(text) {\n    const { fontGeo, fontMat } = await this.loadFontText(text)\n    const textMesh = this.createMesh({\n      geometry: fontGeo,\n      material: fontMat\n    })\n    textMesh.position.set(-0.965, -0.525, 0)\n    textMesh.rotation.set(Lab.base.deg2rad(180), 0, 0)\n    textMesh.scale.set(0.008, 0.025, 1)\n    this.textMesh = textMesh\n  }\n\n  generateTexture() {\n    const canvas = document.createElement('canvas')\n    canvas.width = 256\n    canvas.height = 256\n\n    const context = canvas.getContext('2d')\n    const image = context.getImageData(0, 0, 256, 256)\n\n    let x = 0,\n      y = 0\n\n    for (let i = 0, j = 0, l = image.data.length; i < l; i += 4, j++) {\n      x = j % 256\n      y = x === 0 ? y + 1 : y\n\n      image.data[i] = 255\n      image.data[i + 1] = 255\n      image.data[i + 2] = 255\n      image.data[i + 3] = Math.floor(x ^ y)\n    }\n\n    context.putImageData(image, 0, 0)\n\n    return canvas\n  }\n\n  createImageOfPNG() {\n    // console.log(headTitle)\n    let c = Lab.Image.createCanvasFromImage(this.renderer.domElement)\n    let ctx = c.getContext('2d')\n    ctx.font = '14px Arial'\n    ctx.fillStyle = 'white'\n    ctx.fillText(this.params.headTitle, 24, c.height - 8)\n    let png = c.toDataURL('image/png')\n\n    return Lab.ui.createDownlad(png)\n  }\n  //\n  async createGif() {\n    let g = new Lab.GIF()\n    let fps = this.params.fps,\n      duration = this.params.duration\n    for (let index = 0; index < (fps * duration) / 1000; index++) {\n      let c = Lab.Image.createCanvasFromImage(this.renderer.domElement)\n      let ctx = c.getContext('2d')\n      ctx.font = '14px Arial'\n      ctx.fillStyle = 'white'\n      if (this.params.headTitle)\n        ctx.fillText(this.params.headTitle, 24, c.height - 8)\n      g.add(c, fps)\n      await Lab.base.sleep(1000 / fps)\n      // console.log(index)\n    }\n    Lab.ui.toast('合成ing')\n    let url = await g.render(false)\n    let filepath = Lab.ui.getFilePath(0);\n    if (filepath && filepath[0]) {\n      // console.log(url)\n      let base64 = await Lab.Image.getNativeImageFromWebview2(url)\n      let b = Lab.Image.base642Buffer(base64);\n      Lab.base.writeFileSync(filepath[0] + '\\.gif', b);\n    }\n    //return Lab.ui.createDownlad(url, window.downloadName)\n  }\n  async createVideo() {\n    let g = new Lab.GIF()\n    let fps = this.params.fps,\n      duration = this.params.duration\n    for (let index = 0; index < (fps * duration) / 1000; index++) {\n      let c = Lab.Image.createCanvasFromImage(this.renderer.domElement)\n      let ctx = c.getContext('2d')\n      ctx.font = '14px Arial'\n      ctx.fillStyle = 'white'\n      if (this.params.headTitle)\n        ctx.fillText(this.params.headTitle, 24, c.height - 8)\n      g.add(c, fps)\n      await Lab.base.sleep(1000 / fps)\n      // console.log(index)\n    }\n    Lab.ui.toast('合成ing')\n    let url = await g.render(false)\n    let filepath = Lab.ui.getFilePath(0);\n    if (filepath && filepath[0]) {\n      // console.log(url)\n      let base64 = await Lab.Image.getNativeImageFromWebview2(url)\n      let b = Lab.Image.base642Buffer(base64);\n      let fp = filepath[0] + '\\\\' + (window.downloadName || 'untitle') + '.gif';\n      let vfp=filepath[0] + '\\\\' + (window.downloadName || 'untitle') + '_n.mp4';\n      Lab.base.writeFileSync(fp, b);\n      let mp4fp=await Lab.video.gif2video(fp);\n      Lab.base.fs.unlinkSync(fp);\n      if(!window.musicPath){\n        window.musicPath=(Lab.ui.getFilePath(1))[0];\n        window.musicPath=await Lab.video.audioCutAuto(window.musicPath,this.params.duration/1000);\n      }\n      await Lab.video.videoAddAudio(mp4fp, window.musicPath, vfp);\n      Lab.base.fs.unlinkSync(mp4fp);\n    }\n    //return Lab.ui.createDownlad(url, window.downloadName)\n  }\n  async createHeadTitle() {\n    // let color=new Lab.Color(this.params.headTitleColor);\n    if (this.headTitle) this.headTitle.removeFromParent()\n\n    let font = await td.loadFont()\n    let geo = td.createTextGeometry(\n      this.params.headTitle,\n      font,\n      4,\n      0.2,\n      4,\n      0.2,\n      0.1\n    )\n    var material = new THREE.MeshBasicMaterial({\n      color: this.params.headTitleColor\n    })\n    this.headTitle = new THREE.Mesh(geo, material)\n    this.headTitle.position.x = -20\n    this.headTitle.position.y = -20\n    this.scene.add(this.headTitle)\n\n    this.headTitle.material.color.set(this.params.headTitleColor)\n    this.headTitle.material.wireframe = this.params.headTitleWireframe\n    // this.headTitle.material.color.setHex(this.params.headTitleColor);\n    this.headTitle.position.x = this.params.headTitlePositionX\n    this.headTitle.position.y = this.params.headTitlePositionY\n    this.headTitle.position.z = this.params.headTitlePositionZ\n\n    this.createHeadTitles()\n  }\n  createHeadTitles(num = 44) {\n    for (const t of this.headTitles) {\n      t.removeFromParent()\n    }\n    this.headTitles = []\n\n    if (this.params.isHeadTitles === false) return\n\n    for (let index = 0; index < num || 0; index++) {\n      let preTitle =\n        this.headTitles[this.headTitles.length - 1] || this.headTitle\n      if (!preTitle) return\n\n      // m.transparent = true\n      // m.opacity -= 0.2\n\n      let title = preTitle.clone()\n      title.position.z -= 400 / num\n      // 材质更新\n      title.material = title.material.clone()\n      title.material.needsUpdate = true\n      title.material.transparent = true\n      title.material.opacity -= 1 / num\n\n      // 颜色变深\n      let nColor = new Lab.Color(\n        Array.from(title.material.color.toArray(), t => t * 255)\n      ).darken(1 / num)\n      nColor = nColor.rgb().array()\n\n      title.material.color.r = nColor[0] / 255\n      title.material.color.g = nColor[1] / 255\n      title.material.color.b = nColor[2] / 255\n\n      this.headTitles.push(title)\n      this.scene.add(title)\n    }\n  }\n  async createName(name, position = [0, 0, 0], fontSize = 4) {\n    let font = await td.loadFont()\n    let geo = td.createTextGeometry(\n      name,\n      font,\n      fontSize,\n      fontSize / 20,\n      fontSize,\n      fontSize / 20,\n      fontSize / 40\n    )\n    var material = new THREE.MeshBasicMaterial({\n      color: this.params.headTitleColor\n    })\n    var text = new THREE.Mesh(geo, material)\n    text.position.set(...position)\n    this.scene.add(text)\n    // text.lookAt(this.camera.position)\n    return text\n  }\n  createBackgroundBox() {\n    // let color=new Lab.Color();\n\n    if (!this.backgroundBox) {\n      var geometry = new THREE.BoxGeometry(240, 240, 1)\n      var material = new THREE.MeshBasicMaterial({\n        color: this.params.backgroundColor\n      })\n      this.backgroundBox = new THREE.Mesh(geometry, material)\n      this.scene.add(this.backgroundBox)\n    }\n\n    this.backgroundBox.material.color.set(this.params.backgroundColor)\n    // this.backgroundBox.material.color.setHex(this.params.backgroundColor);\n    this.backgroundBox.position.x = this.params.backgroundBoxPositionX\n    this.backgroundBox.position.y = this.params.backgroundBoxPositionY\n    this.backgroundBox.position.z = this.params.backgroundBoxPositionZ\n  }\n  // 创建渲染目标\n  createRenderTarget() {\n    const rt = new THREE.WebGLRenderTarget(\n      window.innerWidth,\n      window.innerHeight\n    )\n    this.rt = rt\n    const rtCamera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000)\n    rtCamera.position.z = this.params.cameraZ\n    this.rtCamera = rtCamera\n    const rtScene = new THREE.Scene()\n    rtScene.add(this.textMesh)\n    this.rtScene = rtScene\n  }\n  // 创建字体的容器\n  createTextContainer() {\n    if (this.mesh) {\n      this.scene.remove(this.mesh)\n      this.mesh = null\n      this.material.dispose()\n      this.material = null\n    }\n    this.rtScene.background = new THREE.Color(this.params.color)\n    const meshConfig = this.meshConfig[this.params.meshName]\n    let geometry = meshConfig.geometry\n    const material = new THREE.ShaderMaterial({\n      vertexShader: meshConfig.vertexShader,\n      fragmentShader: meshConfig.fragmentShader,\n      uniforms: {\n        uTime: {\n          value: 0\n        },\n        uVelocity: {\n          value: this.params.velocity\n        },\n        uTexture: {\n          value: this.rt.texture\n        },\n        uShadow: {\n          value: this.params.shadow\n        },\n        uFrequency: {\n          value: this.params.frequency\n        }\n      }\n    })\n    this.material = material\n    const mesh = this.createMesh({\n      geometry,\n      material\n    })\n    this.mesh = mesh\n  }\n  // 动画\n  update() {\n    if (this.rtScene) {\n      this.renderer.setRenderTarget(this.rt)\n      this.renderer.render(this.rtScene, this.rtCamera)\n      this.renderer.setRenderTarget(null)\n    }\n    const elapsedTime = this.clock.getElapsedTime()\n    if (this.material) {\n      this.material.uniforms.uTime.value = elapsedTime\n    }\n  }\n\n  toggleDevTools() {\n    Lab.base.toggleDevTools()\n  }\n\n  // 创建调试面板\n  createDebugPanel() {\n    const gui = Lab.ui.createDatGUI()\n    gui.close()\n    gui.add(this, 'toggleDevTools').name('DevTools')\n\n    gui\n      .add(this.params, 'velocity')\n      .min(0)\n      .max(5)\n      .step(0.01)\n      .onFinishChange(() => {\n        this.createTextContainer()\n      })\n    gui\n      .add(this.params, 'cameraZ')\n      .min(0)\n      .max(5)\n      .step(0.01)\n      .onFinishChange(async () => {\n        await this.createKineticText(this.params.text)\n      })\n    gui.add(this.params, 'meshName', this.meshNames).onFinishChange(() => {\n      this.createTextContainer()\n    })\n    gui.add(this.params, 'text').onFinishChange(async () => {\n      await this.createKineticText(this.params.text)\n    })\n    gui.addColor(this.params, 'color').onFinishChange(() => {\n      this.createTextContainer()\n    })\n\n    //  主标题\n    gui\n      .add(this.params, 'headTitle')\n      .onFinishChange(() => this.createHeadTitle())\n    gui\n      .add(this.params, 'isHeadTitles')\n      .name('Copy')\n      .onFinishChange(() => {\n        this.createHeadTitles()\n      })\n\n    gui\n      .addColor(this.params, 'headTitleColor')\n      .onFinishChange(() => this.createHeadTitle())\n    gui\n      .add(this.params, 'headTitleWireframe')\n      .name('wireframe')\n      .onFinishChange(() => this.createHeadTitle())\n    gui\n      .add(this.params, 'headTitlePositionX')\n      .min(-100)\n      .max(100)\n      .step(1)\n      .onFinishChange(() => this.createHeadTitle())\n    gui\n      .add(this.params, 'headTitlePositionY')\n      .min(-100)\n      .max(100)\n      .step(1)\n      .onFinishChange(() => this.createHeadTitle())\n    gui\n      .add(this.params, 'headTitlePositionZ')\n      .min(-100)\n      .max(100)\n      .step(1)\n      .onFinishChange(() => this.createHeadTitle())\n\n    // 背景\n    gui.add(this, 'createBackgroundBox').name('Add Background')\n    gui\n      .addColor(this.params, 'backgroundColor')\n      .onFinishChange(() => this.createBackgroundBox())\n    gui\n      .add(this.params, 'backgroundBoxPositionX')\n      .min(-100)\n      .max(100)\n      .step(1)\n      .onFinishChange(() => this.createBackgroundBox())\n    gui\n      .add(this.params, 'backgroundBoxPositionY')\n      .min(-100)\n      .max(100)\n      .step(1)\n      .onFinishChange(() => this.createBackgroundBox())\n    gui\n      .add(this.params, 'backgroundBoxPositionZ')\n      .min(-100)\n      .max(100)\n      .step(1)\n      .onFinishChange(() => this.createBackgroundBox())\n\n    gui.add(this, 'createImageOfPNG').name('Export png')\n    // .onFinishChange(() => {\n    //   console.log(this.params)\n    //   this.createImageOfPNG(this.params.headTitle)})\n\n    gui\n      .add(this.params, 'fps')\n      .min(4)\n      .max(32)\n      .step(1)\n\n    gui\n      .add(this.params, 'duration')\n      .min(1000)\n      .max(10000)\n      .step(500)\n\n    gui.add(this, 'createGif').name('Export gif')\n    // .onFinishChange(() => this.createGif(12, 5000))\n  }\n}\n\nwindow.KineticText = KineticText\n",
  "code_length": 75,
  "size": [
    427,
    755
  ],
  "extname": "designlabplugin",
  "version": "0.4",
  "package_version": "0.1.2",
  "package_id": "df22ad54c8e3dee49e71dd4ce9538ee33b2a7d1e",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.0.20",
    "@ffprobe-installer/ffprobe": "^1.1.0",
    "@fortawesome/fontawesome-free": "^5.15.3",
    "@hapi/hapi": "^20.1.2",
    "@kilokilo/three-bmfont-text": "^3.1.0",
    "@mediapipe/camera_utils": "^0.3.1632432234",
    "@mediapipe/drawing_utils": "^0.3.1620248257",
    "@mediapipe/holistic": "^0.5.1635989137",
    "@node-rs/jieba": "^1.3.1",
    "@paddlejs-models/humanseg": "0.0.5",
    "@pixiv/three-vrm": "^0.6.7",
    "@tensorflow-models/body-pix": "^2.1.0",
    "@tensorflow-models/deeplab": "^0.2.1",
    "@tensorflow-models/face-landmarks-detection": "0.0.1",
    "@tensorflow-models/knn-classifier": "^1.2.2",
    "@tensorflow-models/mobilenet": "^2.1.0",
    "@tensorflow-models/posenet": "^2.2.2",
    "@tensorflow/tfjs": "^3.3.0",
    "@tensorflow/tfjs-backend-wasm": "^3.3.0",
    "about-window": "^1.14.0",
    "animejs": "^3.2.1",
    "color": "^3.1.3",
    "dat.gui": "^0.7.7",
    "debounce": "^1.2.1",
    "electron-json-storage": "^4.4.0",
    "electron-squirrel-startup": "^1.0.0",
    "emoji-picker-element": "^1.6.0",
    "emoji-regex": "^9.2.2",
    "espree": "^7.3.1",
    "exceljs": "^4.2.1",
    "face-api.js": "^0.22.2",
    "fluent-ffmpeg": "^2.1.2",
    "fomantic-ui": "^2.8.7",
    "gif.js": "^0.2.0",
    "gifuct-js": "^2.1.1",
    "horajs": "^0.1.3",
    "idb-kv-store": "^4.5.0",
    "internal-ip": "^6.2.0",
    "jimp": "^0.16.1",
    "kalidokit": "^1.0.5",
    "lowdb": "^1.0.0",
    "make-cert": "^1.2.0",
    "marked": "^1.2.9",
    "md5": "^2.3.0",
    "mime-types": "^2.1.30",
    "mkcert": "^1.4.0",
    "ml": "^6.0.0",
    "natural": "^5.0.3",
    "ngraph.path": "^1.3.1",
    "nouislider": "^14.7.0",
    "object-hash": "^2.1.1",
    "opencvjs-dist": "^4.4.0",
    "osc-js": "^2.1.2",
    "pdfjs-dist": "^2.6.347",
    "peer": "^0.6.1",
    "peerjs": "^1.3.2",
    "pixelit": "https://github.com/giventofly/pixelit.git",
    "recordrtc": "^5.6.2",
    "regl": "^2.1.0",
    "smartcrop": "^2.0.3",
    "socket.io": "^4.0.0",
    "socket.io-client": "^4.0.0",
    "three": "^0.134.0",
    "timeago.js": "^4.0.2",
    "unsplash-js": "^7.0.12",
    "wordcloud": "^1.2.2",
    "yoga-layout-wasm": "^1.9.3-alpha.7",
    "zdog": "^1.1.2"
  },
  "author": "shadow",
  "create_time": 1641116983773
}