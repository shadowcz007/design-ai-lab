{
  "id": "f4d41a7e6459d8e51ef4bd20c8e28c6b34b943b5",
  "poster": "data:image/png;base64,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",
  "title": "插画生成",
  "knowledge": {
    "course": "",
    "readme": "插画生成",
    "author": "shadow",
    "version": "0.2.2"
  },
  "code": "// 所有图片\nvar imagesDict = {};\n\nvar _COLOR_NUM = 120, _BG_COLOR = '#eeeeee', _OBJ_TYPE = 1;\n\nvar imgsDiv, gridSpace;\n\nvar colorsAll = [];\n\nfunction gui() {\n    let mainDiv = Lab.ui.createGroup('container');\n    Lab.ui.add(mainDiv);\n\n    let btns = Lab.ui.createGroup('column');\n    btns.style = `margin: 24px;\n    display: flex;\n    justify-content: space-between;`;\n    mainDiv.add(btns);\n\n    let runBtn = Lab.ui.createIcon('play', async () => {\n        let im = Lab.clipboard.read('img');\n        // console.log(im,im&&!im.isEmpty());\n        if (im && !im.isEmpty()) {\n            let base64 = im.toDataURL();\n            let id = Lab.base.md5(base64);\n            if (imagesDict[id]) return city();\n            // Lab.clipboard.clearStore('img');\n            for (let id in imagesDict) {\n                imagesDict[id].remove();\n            };\n            colorsAll = [];\n            await addImg(id, base64);\n            city();\n        } else {\n            city();\n        }\n    }, false);\n    btns.add(runBtn);\n\n    // let clearBtn = Lab.ui.createIcon('clear', () => {\n    //     // 清空缓存\n    //     // Lab.clipboard.clearStore('img');\n    //     for (let id in imagesDict) {\n    //         imagesDict[id].remove();\n    //     };\n    //     colorsAll = [];\n    // }, false);\n    // btns.add(clearBtn);\n\n    let inputColorNum = Lab.ui.createInput('text', '颜色数量', e => {\n        if (e & e[0]) {\n            _COLOR_NUM = Math.max(parseInt(e[0]), 2);\n            run();\n        };\n    });\n    // console.log(inputColorNum)\n    inputColorNum.setValue([_COLOR_NUM]);\n    inputColorNum.style = `margin: 24px;`;\n    mainDiv.add(inputColorNum);\n\n    imgsDiv = Lab.ui.createGroup('column');\n    mainDiv.add(imgsDiv);\n\n    gridSpace = Lab.ui.createGroup('column');\n    gridSpace.style = `display: flex;\n    outline: gray solid 1px;\n    justify-content: center;\n    align-items: center;\n    margin: 44px;`;\n    gridSpace.add(Lab.ui.createBaseCanvas(300, 300));\n    // gridSpace = Lab.ui.createSvg(300, 300);\n    gridSpace.style.outline = '1px solid gray'\n    mainDiv.add(gridSpace);\n\n    let copyBtn = Lab.ui.createIcon('copy', () => {\n        let base64 = gridSpace.children[0].toDataURL();\n        Lab.clipboard.write(base64, 'base64');\n    }, false);\n    btns.add(copyBtn);\n\n    init3D();\n\n};\n\n// 图片\nasync function addImg(id, url) {\n    let img = await Lab.ui.createImage(url);\n    img.style.width = \"88px\";\n    img.style.margin = \"8px\";\n    let card = Lab.ui.createGroup('card');\n    card.style = `display: flex;\n    flex-direction: row;\n    justify-content: center;\n    align-items: center;\n    margin: 4px;\n    background: #eee;\n    padding: 24px;`;\n    let colors = await imgProcess(img);\n    card.add(img);\n    if (colors) card.add(colors);\n    imgsDiv.add(card);\n    imagesDict[id] = card;\n};\n\nfunction run() {\n    imgsDiv.innerHTML = '';\n    imagesDict = {};\n};\n\n\nfunction sortColor(mainColor, palette = []) {\n    let distance = Lab.ML.distanceMatrix([(new Lab.Color(mainColor).hsl()).color, ...Array.from(palette, p => (new Lab.Color(p).hsl()).color)], Lab.ML.Distance.euclidean);\n\n    distance = Array.from(distance[0].slice(1, distance[0].length), (d, index) => {\n        return {\n            score: d,\n            color: palette[index]\n        }\n    }).sort((b, a) => b.score - a.score);\n    distance = Array.from(distance, d => d.color);\n    //    console.log(mainColor,distance);\n    let colors = Array.from([mainColor, ...distance], c => (new Lab.Color(c)).hex());\n    return colors;\n}\n\n\nasync function imgProcess(img) {\n    let color = new Lab.Color();\n    // console.log(img)\n    let mainColor = await color.getColor(img);\n    let palette = await color.getPalette(img, _COLOR_NUM);\n    // console.log(mainColor, palette)\n    if (!(mainColor && palette)) return;\n    let colors = sortColor(mainColor, palette);\n    let div = Lab.ui.createGroup('column');\n    div.style = `display: flex;\n    flex-wrap: wrap;`;\n    div.innerHTML = Array.from(colors, (t, index) => {\n        if (!colorsAll.includes(t)) colorsAll.push(t);\n        return `<div style='margin:${index == 0 ? 0 : 0}px;background-color:${t};width:22px;height:22px'></div>`\n    }).join('');\n    // console.log(palette)\n    Array.from(div.children, c => {\n        c.addEventListener('click', async e => {\n            _BG_COLOR = e.target.style.backgroundColor;\n            Lab.clipboard.write(_BG_COLOR, 'text');\n            Lab.ui.toast('已复制'+_BG_COLOR);\n            await init3D(_BG_COLOR);\n        });\n    });\n    // await init3D(colorsAll);\n    return div;\n}\n\n\nasync function init3D() {\n    let isSpinning = true;\n\n    if (!window.stage) {\n        window.stage = new Lab.Zdog.Illustration({\n            element: gridSpace.children[0],\n            zoom: 1,\n            dragRotate: true,\n            onDragStart: () => isSpinning = false,\n            onDragEnd: () => {\n                isSpinning = true;\n                console.log(stage.rotate);\n            },\n            // onPrerender: function( ctx ) {\n            //     // render axis lines\n            //     ctx.fillStyle = '#EA0';\n            //     // with centered enabled, 0,0 is center of canvas\n            //     ctx.fillRect( -1, -120, 2, 240 );\n            //     ctx.fillRect( -120, -1, 240, 2 );\n            //   }\n        });\n        function animate() {\n            // stage.rotate.y += isSpinning ? 0.03 : 0;\n            // stage.rotate.x += isSpinning ? 0.03 : 0;\n            stage.normalizeRotate();\n            stage.updateRenderGraph();\n            requestAnimationFrame(animate);\n        }\n        animate();\n\n        // window.addEventListener(\n        //     \"mousewheel\",\n        //     function (e) {\n        //         const delta = e.wheelDelta;\n        //         console.log(delta)\n        //         if (delta > 0) {\n        //             stage.zoom += delta * 0.001;\n        //         } else {\n        //             stage.zoom -= -delta * 0.001;\n        //             if (stage.zoom < 0) {\n        //                 stage.zoom = 0;\n        //             }\n        //         }\n        //     },\n        //     false\n        // );\n    };\n\n    // let im = await Lab.Image.smartCrop(img, stage.width, stage.height);\n\n    stage.onPrerender = async ctx => {\n        let c = new Lab.Color(_BG_COLOR);\n        // c = c.darken(0.8);\n        // ctx.style.backgroundColor = c.hex();\n        if (ctx.style) {\n            ctx.style.backgroundImage = `linear-gradient(-90deg, ${c.darken(0.8).hex()}, ${c.darken(1).hex()})`;\n        } else {\n            ctx.fillStyle = c.hex();\n            ctx.fillRect(-stage.width, -stage.height, stage.width * 2, stage.height * 2);\n        };\n\n        // let c = new Lab.Color();\n        // c = await c.getColor(im);\n        // console.log(ctx)\n        // ctx.fillStyle = _BG_COLOR;\n        // ctx.fillRect(-stage.width / 2, -stage.height / 2, stage.width, stage.height);\n        // ctx.drawImage(im, 0, 0, stage.width, stage.height, -stage.width / 2, -stage.height / 2, stage.width, stage.height);\n    };\n\n    stage.children = [];\n\n    // window.stage=stage;\n    let count = 12;\n\n    let row = Math.round(Math.sqrt(count)),\n        column = Math.round(count / row);\n\n    let size = 20, margin = 4;\n\n    let group = [];\n\n    // box\n    Array.from(new Array(count), c => {\n        c = new Lab.Color(_BG_COLOR);\n        // console.log()\n        let obj = createObj(c, size);\n        obj.translate.z = column * size * margin;\n        obj.translate.x = row * size * margin;\n        if (column === 0) {\n            column = Math.round(count / Math.round(Math.sqrt(count)));\n            row--;\n        };\n        column--;\n        group.push(obj);\n    });\n\n    stage.rotate.x = 2.47;\n    stage.rotate.y = 1.05;\n    stage.translate.y = 220;\n\n    group.forEach(c => {\n        let c1 = c.copy();\n        c1.translate.y = size * margin + 120;\n        stage.addChild(c1);\n\n        // let c2 = c.copy();\n        // c2.translate.y = -size * margin;\n        // stage.addChild(c2);\n    });\n\n\n}\n\n\nfunction createObj(c, size) {\n    let dicts = {\n        0: createRect,\n        1: createBox\n    };\n    return dicts[_OBJ_TYPE](c, size);\n}\n\nfunction createRect(c, size) {\n    return new Lab.Zdog.Rect({\n        // addTo: illo,\n        width: size,\n        height: size,\n        stroke: size * 0.1,\n        color: c.darken(0.2).hex(),\n    });\n}\n\nfunction createBox(c, size) {\n    return new Lab.Zdog.Box({\n        // addTo: group,\n        width: size,\n        height: size,\n        depth: size,\n        stroke: c.hex(),\n        color: c.hex(), // default face color\n        rearFace: c.darken(0.5).hex(),\n        leftFace: c.lighten(0.2).hex(),\n        rightFace: c.darken(0.2).hex(),\n        topFace: c.darken(0.3).hex(),\n        bottomFace: c.lighten(0.5).hex(),\n    });\n}\n\n\nfunction parseBox(url, box) {\n    let html = '';\n    box.children.forEach(c => html += c.svgElement.outerHTML);\n    return ` <a href='${url}'>\n   <g>${html}<animate attributeName=\"opacity\" calcMode=\"discrete\" begin=\"touchstart\" dur=\"0.00001s\" fill=\"freeze\" to=\"0.2\"></animate><animate attributeName=\"opacity\" calcMode=\"discrete\" begin=\"touchmove+0.3s\" dur=\"0.00001s\" fill=\"freeze\" to=\"0.8\" additive=\"sum\"></animate></g>\n   </a>`\n};\n\nfunction parseSvg(gs = []) {\n    return `<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n    width=\"${stage.element.getAttribute('width')}\" height=\"${stage.element.getAttribute('height')}\" viewBox=\"${stage.element.getAttribute('viewBox')}\" style=\"background-color:${stage.element.style.backgroundColor};\">\n    ${gs.join('')}\n    </svg>`\n}\n\nfunction createSvgCardForWeixin(urls = []) {\n    let k = parseSvg(Array.from(stage.children, (c, i) => parseBox(urls[i], c)))\n    Lab.clipboard.write(k, 'html')\n}\n\nfunction testLOUti() {\n    stage.children = []; var size = 20;\n    var b = createBox(new Lab.Color('blue'), size);\n    // b.translate.x=-size*2;\n    // b.translate.z=size*4;\n\n\n    b1 = b.copy();\n\n    b2 = b.copy();\n    b2.translate.y = size;\n    b2.translate.x += size * 0.5;\n    b1.addChild(b2);\n\n    b3 = b.copy();\n    b3.translate.y = size * 2;\n    b3.translate.x += size * 0.5 * 2;\n    b1.addChild(b3);\n\n    b4 = b.copy();\n    b4.translate.y += size * 3;\n    b4.translate.x += size * 0.5 * 3;\n    b1.addChild(b4);\n\n    stage.addChild(b1);\n    b12 = b1.copyGraph();\n    b12.translate.z += size * 1.2;\n    b12.rotate.x = 180;\n    b12.rotate.y = 90;\n    stage.addChild(b12);\n}\n\nfunction xBuilding() {\n    stage.rotate = { \"x\": -0.34, \"y\": 0.3, \"z\": 0 };\n    stage.translate = { \"x\": 30, \"y\": -50, \"z\": -50 };\n    stage.scale = { \"x\": 0.5, \"y\": 0.5, \"z\": 0.5 };\n\n    let bgc = new Lab.Color(Lab.base.shuffle(colorsAll)[0]);\n    stage.onPrerender = async ctx => {\n        let c = bgc;\n        // c = c.darken(0.8);\n        // ctx.style.backgroundColor = c.hex();\n        ctx.style.backgroundImage = `linear-gradient(-90deg, ${c.darken(0.2).hex()}, ${c.darken(0.05).hex()})`;\n\n    };\n\n\n    stage.children = [];\n    Zdog = Lab.Zdog;\n    // pc = new Lab.Color(Lab.base.shuffle(colorsAll)[0]);\n\n\n    depth = 600;\n\n    B1 = { x: -50, y: 96 };\n    B2 = { x: -50, y: 0 };\n    B3 = { x: -50, y: -100 };\n    B4 = { x: -4, y: 96 };\n    B5 = { x: -4, y: 0 };\n    B6 = { x: -4, y: -100 };\n    B7 = { x: 46, y: 96 };\n    B8 = { x: 46, y: 0 };\n    B9 = { x: 46, y: -100 };\n\n\n\n    // box = new Zdog.Box({\n    //   addTo: stage,\n    //   width: 12,\n    //   height: 12,\n    //   depth: 12,\n    //   stroke: false,\n    //   color: '#C25', // default face color\n    // });\n    // box.translate=B5;\n\n\n    var rect = new Zdog.Shape({\n        addTo: stage,\n        path: [\n            B1,   // start\n            B2,\n            B5,\n            B4,\n        ],\n        closed: true,\n        fill: true,\n        // stroke: 2,\n        color: bgc.darken(0.6).hex()\n    });\n\n    rect.copyGraph({\n        // overwrite original rect options\n        translate: { y: -100 },\n        // color: Lab.base.shuffle(colorsAll)[0]\n    });\n    rect.copyGraph({\n        // overwrite original rect options\n        translate: { x: 50 },\n        // color: Lab.base.shuffle(colorsAll)[0]\n    });\n    rect.copyGraph({\n        // overwrite original rect options\n        translate: { x: 50, y: -100 },\n        // color: Lab.base.shuffle(colorsAll)[0]\n    });\n\n\n\n    // left \n    var leftRect = new Zdog.Shape({\n        addTo: stage,\n        path: [\n            B1, B3,\n            { ...B3, z: depth },\n            { ...B1, z: depth }\n        ],\n        closed: true,\n        fill: true,\n        stroke: 0,\n        color: bgc.darken(0.35).hex()\n    });\n\n    // leftRect.copyGraph({\n    //     translate: { x: 96 },\n    //     color: pc\n    // });\n\n    // top\n    var topRect = new Zdog.Shape({\n        addTo: stage,\n        path: [\n            B3,   // start\n            B9,\n            { ...B9, z: depth },\n            { ...B3, z: depth },\n        ],\n        closed: true,\n        fill: true,\n        stroke: 0,\n        color: bgc.darken(0.45).hex(),\n        translate: { y: 196 }\n    });\n\n}\n\n\nfunction city() {\n    let Zdog = Lab.Zdog;\n    const blocks = 6;\n    const center = blocks * 20;\n    const weights = [2, 1, 3, 6, 2];\n    let zoom = 0.8;\n\n    _BG_COLOR = Lab.base.shuffle(colorsAll)[0];\n\n    // let roadColor = \"#24231b\";\n    // let grassColor = \"#07331a\";\n    // let grassColor2 = \"#084f27\";\n    // let buildDefaultFaceColor = \"#402994\", buildLeftFaceColor = \"#b676d6\", buildTopFaceColor = \"#a38fbf\", buildBottomFaceColor = \"#663366\";\n    // let buildDefaultFaceColor0 = \"#dd3668\", buildLeftFaceColor0 = \"#eeaa00\", buildRightFaceColor0 = \"#ee6622\", buildTopFaceColor0 = \"#eedd00\";\n    // let treeColor = \"#664517\", treeColor1 = \"#347339\";\n    // let houseFace = \"#EDECEE\", houseLeftFace = \"#BEB8C2\", houseTopFace = \"#948B9A\";\n    // let doorColor = \"#614509\";\n    // let roof1Color = \"#cc2255\", roof2Color = \"#C25\";\n\n    let [roadColor, grassColor, grassColor2, buildDefaultFaceColor,\n        buildLeftFaceColor, buildTopFaceColor, buildBottomFaceColor, buildDefaultFaceColor0,\n        buildLeftFaceColor0, buildRightFaceColor0, buildTopFaceColor0, treeColor, treeColor1,\n        houseFace, houseLeftFace, houseTopFace, doorColor, roof1Color, roof2Color] = colorsAll;\n\n\n    let grassColors = [roadColor, roadColor, grassColor, grassColor2, grassColor];\n\n\n\n    // 随机返回\n    function weightedRandom(w) {\n        let weights = [...w];\n        let i = weights.indexOf(Lab.base.shuffle(weights)[0]);\n        return i;\n    }\n\n    // 获取灯光颜色\n    function createLight() {\n        let colors = ['#fff9c4', '#ffe200', \"yellow\", \"yellow\", \"yellow\", \"yellow\", \"#444\", \"#444\"];\n        return Lab.base.shuffle(colors)[0];\n    }\n\n    // 顶楼\n    function createBuildingTop(box) {\n\n        if (Math.random() > 0.55) {\n            let translate = { x: 0, y: -30, z: 0 };\n            elements.building1(box, translate);\n        } else {\n            if (Math.random() > 0.5) {\n                let d = new Zdog.Box({\n                    addTo: box,\n                    width: 55,\n                    height: 10,\n                    depth: 55,\n                    stroke: 3,\n                    color: buildDefaultFaceColor, // default face color\n                    leftFace: buildLeftFaceColor,\n                    rightFace: buildLeftFaceColor,\n                    topFace: buildTopFaceColor,\n                    bottomFace: buildBottomFaceColor,\n                    translate: {\n                        x: -1,\n                        y: -49,\n                        z: -1\n                    }\n                });\n                d.color = (new Lab.Color(d.color)).lighten(0.2).hex();\n            } else {\n                let d = new Zdog.Box({\n                    addTo: box,\n                    width: 22,\n                    height: 10,\n                    depth: 22,\n                    stroke: 3,\n                    color: buildDefaultFaceColor, // default face color\n                    leftFace: buildLeftFaceColor,\n                    rightFace: buildLeftFaceColor,\n                    topFace: buildTopFaceColor,\n                    bottomFace: buildBottomFaceColor,\n                    translate: {\n                        x: -22,\n                        y: -49,\n                        z: -22\n                    }\n                });\n                d.color = (new Lab.Color(d.color)).lighten(0.2).hex();\n                let d2 = new Zdog.Box({\n                    addTo: box,\n                    width: 22,\n                    height: 10,\n                    depth: 22,\n                    stroke: 3,\n                    color: buildDefaultFaceColor, // default face color\n                    leftFace: buildLeftFaceColor,\n                    rightFace: buildLeftFaceColor,\n                    topFace: buildTopFaceColor,\n                    bottomFace: buildBottomFaceColor,\n                    translate: {\n                        x: 22,\n                        y: -49,\n                        z: 22\n                    }\n                });\n                d2.color = (new Lab.Color(d2.color)).lighten(0.2).hex();\n            }\n        }\n    }\n\n    const elements = {\n        // 生成高层建筑物\n        building1: (attachTo, translate = {}) => {\n            translate.y -= 45;\n\n            const box = new Zdog.Box({\n                addTo: attachTo,\n                width: 70,\n                height: 80,\n                depth: 70,\n                stroke: 3,\n                color: buildDefaultFaceColor0, // default face color\n                leftFace: buildLeftFaceColor0,\n                rightFace: buildRightFaceColor0,\n                topFace: buildTopFaceColor0,\n                bottomFace: buildBottomFaceColor,\n                translate\n            });\n\n            for (let i = 0; i < 4; i++) {\n                const tt = 39 * (i > 1 ? -1 : 1);\n\n                let group1 = new Zdog.Group({\n                    addTo: box,\n                    rotate: i % 2 === 0 ? {} : { y: Math.PI / 2 },\n                    translate: i % 2 === 0 ? { z: tt } : { x: tt }\n                });\n\n                // 开窗\n                let wins = [];\n                for (let j = 0; j < 4; j++) {\n                    wins.push(\n                        new Zdog.Rect({\n                            addTo: group1,\n                            width: 6,\n                            height: 6,\n                            color: createLight(),\n                            stroke: 6,\n                            translate: {\n                                z: 0,\n                                x: 15 * (j < 2 ? 1 : -1),\n                                y: j % 2 === 0 ? -15 : 15\n                            }\n                        })\n                    );\n                };\n            }\n\n\n            createBuildingTop(box);\n\n            return box;\n        },\n        building2: (attachTo, translate = {}) => {\n            translate.y -= 47;\n\n            const box = new Zdog.Box({\n                addTo: attachTo,\n                width: 85,\n                height: 85,\n                depth: 85,\n                stroke: 0,\n                color: buildDefaultFaceColor, // default face color\n                leftFace: buildLeftFaceColor,\n                rightFace: buildLeftFaceColor,\n                topFace: buildTopFaceColor,\n                bottomFace: buildBottomFaceColor,\n                translate\n            });\n\n            for (let i = 0; i < 4; i++) {\n                const tt = 46 * (i > 1 ? -1 : 1);\n\n                let group1 = new Zdog.Group({\n                    addTo: box,\n                    rotate: i % 2 === 0 ? {} : { y: Math.PI / 2 },\n                    translate: i % 2 === 0 ? { z: tt } : { x: tt }\n                });\n\n                let wins = [];\n                let winNum = 5;\n                for (let row = 0; row < 3; row++) {\n                    for (let j = 0; j < winNum; j++) {\n                        wins.push(\n                            new Zdog.Rect({\n                                addTo: group1,\n                                width: 4,\n                                height: 3,\n                                color: createLight(),\n                                stroke: 4,\n                                translate: {\n                                    z: 0,\n                                    x: -25 + 65 * (j / winNum),\n                                    y: -25 + row * 25\n                                }\n                            })\n                        );\n                    }\n                };\n            };\n\n            createBuildingTop(box);\n\n            return box;\n        },\n        tree: (attachTo, translate = {}) => {\n            // translate.y -= 9;\n\n            const height = Math.random() * 20;\n            translate.y -= height / 2;\n            let trunk = new Zdog.Cylinder({\n                addTo: attachTo,\n                diameter: 10,\n                length: 8 + height,\n                color: treeColor,\n                backface: treeColor,\n                rotate: { x: Math.PI / 2 },\n                translate\n                // scale: Math.random() + 0.2,\n            });\n\n            let tree = new Zdog.Cone({\n                addTo: trunk,\n                diameter: 30,\n                length: Math.random() * 20 + 40,\n                stroke: false,\n                color: treeColor1,\n                backface: treeColor1,\n                translate: { z: 1 + height / 2 }\n            });\n\n            return trunk;\n        },\n        // road: (rot) => {},\n        house1: (attachTo, translate = {}) => {\n            translate.y -= 14;\n\n            let box = new Zdog.Box({\n                addTo: attachTo,\n                width: 30,\n                height: 40,\n                depth: 40,\n                stroke: false,\n                color: houseFace,// default face color\n                leftFace: houseLeftFace,\n                rightFace: houseLeftFace,\n                topFace: houseTopFace,\n                bottomFace: houseTopFace,\n                translate,\n                rotate: { y: Math.random() > 0.5 ? Math.PI / 2 : 0 },\n                scale: 0.7\n            });\n\n            const window = new Zdog.Rect({\n                addTo: box,\n                width: 10,\n                height: 10,\n                color: \"#444\",\n                stroke: 3,\n                fill: true,\n                translate: {\n                    z: 22,\n                    x: 0,\n                    y: -2\n                }\n            });\n\n            const door = new Zdog.Rect({\n                addTo: box,\n                width: 14,\n                height: 30,\n                color: doorColor,\n                stroke: 1,\n                fill: true,\n                rotate: { y: Math.PI / 2 },\n                translate: {\n                    z: 0,\n                    x: 19,\n                    y: 4\n                }\n            });\n\n            var rotor = new Zdog.Group({\n                addTo: box,\n                rotate: { y: 0, x: Math.PI / 2, z: Math.PI / 2 },\n                translate: {\n                    z: 0,\n                    x: 62,\n                    y: 20\n                }\n            });\n\n            const path = new Zdog.Rect({\n                addTo: rotor,\n                width: 14,\n                height: 82,\n                color: roadColor,\n                fill: true,\n                stroke: 3\n            });\n\n            // testing invisible object for z-fighting\n            new Zdog.Rect({\n                addTo: rotor,\n                width: 200,\n                height: 200,\n                stroke: 0,\n                visible: false,\n                rotate: {\n                    z: Math.PI / 4\n                },\n                translate: {\n                    z: 100,\n                    x: -62 + 100,\n                    y: -20 + 100\n                }\n            });\n\n\n            const roof1 = new Zdog.Box({\n                addTo: box,\n                width: 6,\n                height: 40,\n                depth: 40,\n                stroke: 3,\n                color: roof1Color, // default face color\n                translate: { y: -28, z: 12 },\n                rotate: { y: Math.PI / 2, x: Math.PI / 3 }\n            });\n\n            const roof2 = new Zdog.Box({\n                addTo: box,\n                width: 6,\n                height: 40,\n                depth: 40,\n                stroke: 3,\n                color: (new Lab.Color(roof1Color)).lighten(0.2).hex(), // default face color\n                translate: { y: -28, z: -12 },\n                rotate: { y: Math.PI / 2, x: -Math.PI / 3 }\n            });\n\n            return box;\n        },\n        // power1: (rot) => {},\n        empty: (attachTo = {}) => {\n            const empty = new Zdog.Shape({\n                addTo: attachTo,\n                stroke: 0,\n                color: \"#636\"\n            });\n\n            return empty;\n        }\n    };\n\n    stage.children = [];\n    const keys = Object.keys(elements);\n    let elementIndex = 2;\n    // console.log(stage)\n\n    stage.translate = {\n        y: -center + 50, z: 0\n    };\n    stage.rotate = {\n        x: -Math.PI / 8,\n        y: Math.PI / 4, z: 0\n    };\n    stage.zoom = zoom;\n    // let stage = new Zdog.Illustration({\n    //     element: stage,\n    //     dragRotate: true,\n    //     rotate: {\n    //         x: -Math.PI / 8,\n    //         y: Math.PI / 4\n    //     },\n    //     translate: {\n    //         y: -center + 50\n    //     },\n    //     centered: true,\n    //     zoom\n    // });\n\n    const blockWidth = 150;\n    const pivot = -window.innerHeight / 7 + center;\n\n    const oneByOne = () => {\n        const x = blockWidth * 3 - (blockWidth * blocks) / blocks - center;\n        const z = blockWidth * 3 - (blockWidth * blocks) / blocks - center;\n\n        let root = elements[keys[elementIndex]](stage, {\n            x,\n            y: pivot,\n            z\n        });\n\n        town.ondblclick = function (e) {\n            root.remove();\n            elementIndex++;\n            if (elementIndex > keys.length - 2) {\n                elementIndex = 0;\n            }\n            root = elements[keys[elementIndex]](stage, {\n                x,\n                y: pivot,\n                z\n            });\n        };\n    };\n\n    const tiles = [];\n    const emptyTranslate = { x: 0, y: 0, z: 0 };\n\n    const sampleCity = () => {\n        for (let i = 0; i < blocks; i++) {\n            for (let j = 0; j < blocks; j++) {\n                // 随机决定此方格是建筑、空地、还是植物？\n                // TODO 高密度住宅区、郊区、城镇等类型\n                const index = weightedRandom(weights);\n                const x = blockWidth * i - (blockWidth * blocks) / blocks - center;\n                const z = blockWidth * j - (blockWidth * blocks) / blocks - center;\n\n                const rotor = new Zdog.Anchor({\n                    addTo: stage,\n                    translate: {\n                        x,\n                        z,\n                        y: pivot\n                    }\n                });\n\n                elements[keys[index]](rotor, { y: 0 });\n\n                const grass = new Zdog.Rect({\n                    addTo: rotor,\n                    width: blockWidth - 5,\n                    height: blockWidth - 5,\n                    color: grassColors[index],\n                    fill: true,\n                    stroke: 4,\n                    rotate: { x: Math.PI / 2 },\n                    translate: {\n                        y: 2\n                    }\n                });\n\n                const roadGrid = new Zdog.Rect({\n                    addTo: rotor,\n                    width: blockWidth - 5,\n                    height: blockWidth - 5,\n                    color: roadColor,\n                    stroke: 10,\n                    rotate: { x: Math.PI / 2 }\n                });\n            }\n        }\n    };\n\n    // function animate() {\n    //     stage.normalizeRotate();\n    //     stage.updateRenderGraph();\n\n    //     requestAnimationFrame(animate);\n    // }\n    // animate();\n\n\n\n    // oneByOne();\n    sampleCity();\n\n}",
  "code_length": 167,
  "size": [
    419,
    798
  ],
  "extname": "designlabplugin",
  "version": "0.2.2",
  "package_version": "0.1.2",
  "package_id": "cded8226092c2921490b94947d014f8989448189",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.0.20",
    "@ffprobe-installer/ffprobe": "^1.1.0",
    "@fortawesome/fontawesome-free": "^5.15.3",
    "@hapi/hapi": "^20.1.2",
    "@node-rs/jieba": "^1.3.1",
    "@paddlejs-models/humanseg": "0.0.5",
    "@tensorflow-models/body-pix": "^2.1.0",
    "@tensorflow-models/deeplab": "^0.2.1",
    "@tensorflow-models/face-landmarks-detection": "0.0.1",
    "@tensorflow-models/knn-classifier": "^1.2.2",
    "@tensorflow-models/mobilenet": "^2.1.0",
    "@tensorflow-models/posenet": "^2.2.2",
    "@tensorflow/tfjs": "^3.3.0",
    "@tensorflow/tfjs-backend-wasm": "^3.3.0",
    "about-window": "^1.14.0",
    "animejs": "^3.2.1",
    "color": "^3.1.3",
    "electron-json-storage": "^4.4.0",
    "electron-squirrel-startup": "^1.0.0",
    "emoji-picker-element": "^1.6.0",
    "emoji-regex": "^9.2.2",
    "espree": "^7.3.1",
    "exceljs": "^4.2.1",
    "face-api.js": "^0.22.2",
    "fluent-ffmpeg": "^2.1.2",
    "fomantic-ui": "^2.8.7",
    "gif.js": "^0.2.0",
    "gifuct-js": "^2.1.1",
    "horajs": "^0.1.3",
    "idb-kv-store": "^4.5.0",
    "internal-ip": "^6.2.0",
    "jimp": "^0.16.1",
    "lowdb": "^1.0.0",
    "make-cert": "^1.2.0",
    "marked": "^1.2.9",
    "md5": "^2.3.0",
    "mime-types": "^2.1.30",
    "mkcert": "^1.4.0",
    "ml": "^6.0.0",
    "natural": "^5.0.3",
    "ngraph.path": "^1.3.1",
    "nouislider": "^14.7.0",
    "object-hash": "^2.1.1",
    "opencvjs-dist": "^4.4.0",
    "osc-js": "^2.1.2",
    "pdfjs-dist": "^2.6.347",
    "peer": "^0.6.1",
    "peerjs": "^1.3.2",
    "pixelit": "https://github.com/giventofly/pixelit.git",
    "recordrtc": "^5.6.2",
    "regl": "^2.1.0",
    "smartcrop": "^2.0.3",
    "socket.io": "^4.0.0",
    "socket.io-client": "^4.0.0",
    "timeago.js": "^4.0.2",
    "unsplash-js": "^7.0.12",
    "wordcloud": "^1.2.2",
    "yoga-layout-wasm": "^1.9.3-alpha.7",
    "zdog": "^1.1.2"
  },
  "author": "shadow",
  "create_time": 1634030808978
}