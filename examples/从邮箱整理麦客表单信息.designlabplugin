{
  "poster": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABICAYAAAA9HjF/AAAED0lEQVR4nO3YzW5bRRTA8f+Zmevr2NdtPoijqqWVWIFE+wKIBRJIdMmCl2DDC7BgyYYdCx4AiadAvAECFiUhfLQWqkiJ82HHsX3tO8PCjpsIhNpYgnJyfpJXdq6t+fuM50ZSSonnFGPEOcfDhw/pdDpsbW3hvWc8HuO958GDB9y4cYP9/X3W1tZIKbG9vc39+/e5devW4u/NM0oJREgxIs+5bmGZ9x2Px3S7XUajEdPplF6vx+bmJlVVMRwOqaqKfr+Pc46yLDk5OSGltHgsQ0QW1xCRpa71wjsXt/zjCb9/+QWu0SAOhxArUoy4Wk4sS9zKCmkyYf2ttylev4tcZoJfJCkl9YFTjACMOo/49dNPGOz8wPiXn9l4511q7S3C+jqHX39F89XX6H37DSfff8crH33Myx98eLkJPlvUlBIxxgvTBE8nKqW02Ir/7nt0Po6IIAIxpvlzcL7bX18rVyIuMFsM56hOB8TBgOzadcYiSJbhVlZwWUa4voovWrhaDfEemK/VZSb4bGH7/T4Hh0c456jVaouIMVZMpxUhBIpmk+NeD4AQAiJCVVU45/DeM5lMmE6n1POckAUGg1NEhCzLFl8g5xzOOSZlSUyJomiyPv9tB/1bdAKYb9GD3R1++/wzfNEiDk8hJVJVXdii43hE+733WXvjzcsFPlv0w6Mjut0D8jxnZ3sb7z0IrK9vsLq6CkCrKDg6PiaEQKfTYTKZcPv2bY6Pj9nb2+POnTs0Gg2892Qh43R4inOOn3Z3KVoF7fYWjx8/5vDggLv37hFjpCiatDc3ifOtS/2B7d8+ZJ3fKs8m8VHnEYLQaDao11fY2NhYbN8igveePK9RliWDwYAne3vs7v7IzZs38d7jRBA3u26WZYQso6oi/V6PXq9H96C7uNb5978KElyIzLPMpAji3PITvL/fxfvAaDQEZnG896SU8D5wrVVweHSEiCOR8PPtdjqdMplMCGG2Fed5jRACg8EA5zyJRPAeEaEsS2KM+BBIMdJqFWy121dngrl47nlWIrLcBDcbDeQlmU/yBgikOL8NYnbAquc5zrvZT74IpKcfVpzMXx8JIcN7x0q9Pru+zA9mCcTND1UxEVOkntcvfI6r4LK71v/+Nsn8s6Vvk/4rV+ofHUuwCVZO/+nkirPAyllg5SywchZYOQusnAVWzgIrZ4GVs8DKWWDlLLByFlg5C6ycBVbOAitngZWzwMpZYOUssHIWWDkLrJwFVs4CK2eBlbPAyllg5SywchZYOQusnAVWzgIrZ4GVs8DKWWDlLLByFlg5C6ycBVbOAitngZWzwMpZYOUssHIWWDkLrJwFVs4CK2eBlbPAyllg5SywchZYOQusnAVWzgIrZ4GVs8DKWWDlLLByfwIWhrwhHP6eOAAAAABJRU5ErkJggg==",
  "knowledge": {
    "course": "- 从qq 邮箱整理\n- 识别标题后星标\n- 翻页按钮、下一封邮件按钮\n- 打开邮件后自动结构化 提取数据\n- 点击收集，可以下载到本地json格式\n- 支持下载为excel文件（ing）\n\n- 可修改为其他麦客表单",
    "readme": "从邮箱整理麦客表单信息",
    "author": "shadow",
    "version": "0.1.2"
  },
  "code": "// 邮件标题里的关键词，可替换成其他\nvar _KEYS = ['表单 社区工作人员', '表单 黑设会', '表单 无界社区成员登记', '表单 Mixlab', '表单 iBrandUp'];\n\n// 标题\nvar _TITLE = 'Mixlab表单收集';\n// 缓存key\nvar _STORE_KEY = 'mixlab-kol';\n\n\nvar mainDiv, text, webview, tag;\n\nvar dataset = {};\nvar db = new Lab.Store(_STORE_KEY);\n\n\nfunction gui() {\n    Lab.ui.p5Show(false);\n\n    mainDiv = Lab.ui.createGroup('container');\n    Lab.ui.add(mainDiv);\n\n    let column = Lab.ui.createGroup('column');\n    mainDiv.add(column);\n\n    createCard(column);\n\n    webview = Lab.ui.createWebview('https://mail.qq.com', false);\n    webview.style = `\n            display:none;\n            width:1020px;\n            height:800px;\n            `;\n    mainDiv.add(webview);\n    setTimeout(() => webview.zoomFactor = 0.5, 1000);\n\n    webview.addEventListener('page-title-updated', doData);\n    // webview.addEventListener('dom-ready', console.log);\n    // webview.addEventListener('load-commit', console.log);\n    // webview.addEventListener('did-finish-load', console.log);\n    // webview.addEventListener('did-frame-finish-load', console.log);\n    // webview.addEventListener('console-message', console.log);\n    webview.addEventListener('update-target-url', doData);\n\n    db.getValues().then(r => {\n        if (r && r[0]) dataset = r[0];\n        tag = Lab.ui.createTag(`收集 ${Object.keys(dataset).length}`);\n        tag.style = `\n        position:fixed;\n        top:12px;\n        right:12px;`\n        mainDiv.add(tag);\n        tag.addEventListener('click', () => Lab.ui.saveJsonDialog(dataset));\n    });\n\n};\n\nfunction createCard(column) {\n    let card = Lab.ui.createGroup('card');\n    column.add(card);\n\n    text = Lab.ui.createBaseText(_TITLE);\n    card.add(text);\n\n    let btn = Lab.ui.createButton('显示', () => {\n        Lab.ui.loading(0);\n        if (webview.style.display === 'none') {\n            webview.style.display = 'inline-flex';\n            btn.innerText = '隐藏';\n        } else {\n            webview.style.display = 'none';\n            btn.innerText = '显示';\n        };\n        setTimeout(() => Lab.ui.loading(100), 3000);\n    }, false);\n    card.add(btn);\n\n    let nextEmailBtn = Lab.ui.createButton('下一封', nextEmail, false);\n    card.add(nextEmailBtn);\n\n    let nextPageBtn = Lab.ui.createButton('下一页', nextPage, false);\n    card.add(nextPageBtn);\n\n}\n\n\nasync function starData() {\n    await webview.executeJavaScript(`Array.from(document.querySelector('#mainFrame').contentDocument.querySelectorAll('tr'), t => {\n        let ks=Array.from(${JSON.stringify(_KEYS)},k=>t.innerText.match(k)).filter(f=>f);\n        console.log(ks)\n        if (ks&&ks.length&&t.children[2]) {\n            let td = t.children[2].querySelectorAll('td');\n            if (td.length && (td[4].title == '标为星标' || td[4].title == '标记星标')) {\n                td[4].click()\n                console.log(td[4].title)\n            }\n        }\n    })`);\n};\n\nasync function nextEmail() {\n    await webview.executeJavaScript(`\n        var nx=document.querySelector('#mainFrame').contentDocument.querySelector('#nextmail');\n        if(nx)nx.click();\n    `);\n}\n\nasync function nextPage() {\n    await webview.executeJavaScript(`\n        var nx=document.querySelector('#mainFrame').contentDocument.querySelector('#nextpage');\n        if(nx)nx.click();\n    `);\n    await starData();\n}\n\nasync function doData() {\n    // await starData();\n    let res = await webview.executeJavaScript(`\n    console.log('12')\n    var f=document.querySelector('#mainFrame');\n\n    var targetText=f&&f.contentDocument.querySelector('.sub_title')?f.contentDocument.querySelector('.sub_title').innerText:'';\n    var ks=Array.from(${JSON.stringify(_KEYS)},k=>targetText.match(k)).filter(f=>f);\n        console.log(ks)\n\n    if(ks&&ks.length){\n        let title=targetText;\n        let createTime=f.contentDocument.querySelector('#local-time-caption').innerText;\n        ks=Array.from(${JSON.stringify(_KEYS)},k=>targetText.match(k)?k:null).filter(f=>f);\n        console.log(title)\n        let data=Array.from(f.contentDocument.querySelector('.mk_mailContent').children[0].children[0].children[0].children[2].querySelectorAll('tr'),(t,i)=>{\n            var ts=t.innerText.split('\\\\t');\n            var vs=ts[1].trim();\n            if(i==0) vs=Array.from(ts[1].split('\\\\n'),v=>v.trim()).filter(f=>f);\n            return {\n                key:ts[0],value:vs\n            }\n        });\n        var res={title,data,type:ks[0],createTime};\n        res;\n    }\n    `);\n    if (res) {\n        res.id = Lab.base.hash(res);\n        // if (!dataset[res.id]) dataset[res.id] = res;\n        dataset[res.id] = res;\n        // console.log(res)\n        db.set(_STORE_KEY, dataset);\n        tag.innerText = `收集 ${Object.keys(dataset).length}`;\n    }\n\n    return res;\n}\n\n\nfunction saveCsv() {\n    var datas = {};\n    for (let id in dataset) {\n        let d = { ...dataset[id] };\n        if (!datas[d.type]) datas[d.type] = { columns: ['申请时间'], rows: [] };\n        d.createTime = new Date(d.createTime.replace(/日.*午|年|月/ig, '/').replace(/\\s/ig, ''));\n        let ds = {};\n        Array.from(d.data, da => {\n            if (!datas[d.type].columns.includes(da.key)) datas[d.type].columns.push(da.key);\n            if(da.value instanceof Array) da.value=da.value.join(\" | \");\n            ds[da.key] = da.value;\n        });\n        ds['申请时间'] = d.createTime;\n        datas[d.type].rows.push(ds);\n        datas[d.type].rows.sort((a, b) => a['申请时间'] - b['申请时间']);\n    };\n\n   let ex= Lab.excel.createFile(datas);\n\n    let filepath=Lab.ui.getFilePath();\n    if(filepath&&filepath[0]){\n        ex.xlsx.writeFile(filepath[0]+'/'+Lab.base.hash(datas)+'.xlsx');\n    }\n\n    return \n}",
  "code_length": 58,
  "size": [
    975,
    608
  ],
  "extname": "designlabplugin",
  "version": "0.1.2",
  "package_version": "0.1.2",
  "package_id": "8ca44960b468f1c14b6ed6a8ab40975b6eff8d5f",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.0.20",
    "@ffprobe-installer/ffprobe": "^1.1.0",
    "@fortawesome/fontawesome-free": "^5.15.3",
    "@hapi/hapi": "^20.1.2",
    "@node-rs/jieba": "^1.1.0",
    "@paddlejs-models/humanseg": "0.0.5",
    "@tensorflow-models/body-pix": "^2.1.0",
    "@tensorflow-models/deeplab": "^0.2.1",
    "@tensorflow-models/face-landmarks-detection": "0.0.1",
    "@tensorflow-models/knn-classifier": "^1.2.2",
    "@tensorflow-models/mobilenet": "^2.1.0",
    "@tensorflow-models/posenet": "^2.2.2",
    "@tensorflow/tfjs": "^3.3.0",
    "@tensorflow/tfjs-backend-wasm": "^3.3.0",
    "@tensorflow/tfjs-converter": "^2.8.6",
    "@tensorflow/tfjs-node": "^3.3.0",
    "about-window": "^1.14.0",
    "blockly": "^4.20201217.0",
    "color": "^3.1.3",
    "colorthief": "^2.3.2",
    "electron-json-storage": "^4.4.0",
    "escodegen": "^2.0.0",
    "espree": "^7.3.1",
    "estraverse": "^5.2.0",
    "exceljs": "^4.2.1",
    "fabric": "^4.3.1",
    "fluent-ffmpeg": "^2.1.2",
    "fomantic-ui": "^2.8.7",
    "gif.js": "^0.2.0",
    "gifuct-js": "^2.1.1",
    "idb-kv-store": "^4.5.0",
    "internal-ip": "^6.2.0",
    "jimp": "^0.16.1",
    "leader-line": "^1.0.5",
    "lowdb": "^1.0.0",
    "make-cert": "^1.2.0",
    "marked": "^1.2.9",
    "md5": "^2.3.0",
    "mime-types": "^2.1.30",
    "mkcert": "^1.4.0",
    "monaco-editor": "^0.21.3",
    "muuri": "^0.9.3",
    "ngraph.path": "^1.3.1",
    "nouislider": "^14.7.0",
    "object-hash": "^2.1.1",
    "opencvjs-dist": "^4.4.0",
    "p5": "^1.3.1",
    "p5.createloop": "^0.2.8",
    "pdfjs-dist": "^2.6.347",
    "peer": "^0.6.1",
    "peerjs": "^1.3.2",
    "recordrtc": "^5.6.2",
    "smartcrop": "^2.0.3",
    "socket.io": "^4.0.0",
    "socket.io-client": "^4.0.0",
    "spatial-db": "0.0.25",
    "sweetalert2": "^10.15.7",
    "timeago.js": "^4.0.2",
    "wordcloud": "^1.2.2",
    "yoga-layout-wasm": "^1.9.3-alpha.7",
    "zdog": "^1.1.2"
  },
  "author": "shadow",
  "create_time": 1624247113151
}